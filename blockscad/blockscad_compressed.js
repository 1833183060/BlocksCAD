// Do not edit this file; automatically generated by blockscad_build.py.
"use strict";
var BlocklyStorage=BlocklyStorage||{},Blockscad=Blockscad||{};Blockscad.Auth=Blockscad.Auth||{};var Blockly=Blockly||{};Blockly.Xml=Blockly.Xml||{};
BlocklyStorage.backupBlocks_=function(){console.log("in backupBlocks");if("localStorage"in window){localStorage.clear();for(var a=Blockly.Xml.workspaceToDom(Blockscad.workspace),c=window.location.href.split("#")[0],d=c+"proj_name",h=c+"current_project",k=Blockscad.workspace.getAllBlocks(),g=0;g<k.length;g++)if("stl_import"==k[g].type){var p=k[g].getField("STL_CONTENTS").getText();if(0<p.length){var m=c+p,w=c+p+"center";if(3E6>Blockscad.csg_commands[p].length){var l=Base64.toBase64(RawDeflate.deflate(Base64.utob(Blockscad.csg_commands[p])));
window.localStorage.setItem(m,l);window.localStorage.setItem(w,Blockscad.csg_center[p])}}}window.localStorage.setItem(c,Blockly.Xml.domToText(a));window.localStorage.setItem(d,$("#project-name").val());window.localStorage.setItem(h,Blockscad.Auth.current_project)}};BlocklyStorage.backupOnUnload=function(){window.addEventListener("unload",BlocklyStorage.backupBlocks_,!1)};
BlocklyStorage.restoreBlocks=function(){var a=window.location.href.split("#")[0],c=a+"proj_name",d=a+"current_project";console.log(window.localStorage);if("localStorage"in window&&window.localStorage[a]){var h=Blockly.Xml.textToDom(window.localStorage[a]);Blockly.Xml.domToWorkspace(Blockscad.workspace,h);for(var h=Blockscad.workspace.getAllBlocks(),k=0;k<h.length;k++)if("stl_import"==h[k].type){var g=h[k].getField("STL_CONTENTS").getText(),p=h[k].getField("STL_FILENAME").getText(),m=h[k].getField("STL_BUTTON");
if(0<g.length){var w=window.localStorage[a+g],l=window.localStorage[a+g+"center"];if(w&&0<w.length)m.setVisible(!1),console.log("csg contents compressed length is:",w.length),m=Base64.btou(RawDeflate.inflate(Base64.fromBase64(w))),console.log("decompressed lengeth is:",m.length),Blockscad.csg_commands[g]=m,Blockscad.csg_filename[g]=p+":::",Blockscad.csg_center[g]=l;else{console.log("couldn't find the stuff in localStorage");h[k].getField("STL_CONTENTS").setText("");h[k].getField("STL_FILENAME").setText("");
g=h[k].getCommentText();g.match(/^RELOAD/)||(g="RELOAD: "+g);h[k].setCommentText(g);m.setText("Reload");h[k].backlight();if(g=h[k].collapsedParents())for(p=0;p<g.length;p++)g[p].backlight();h[k].isCollapsed()||m.setVisible(!0);m=h[k];for(g=null;m;)m.isCollapsed()&&(g=m),m=m.getSurroundParent();g&&g.setCollapsed(!0,!0)}h[k].render()}}a=window.localStorage[c];"undefined"!=a?$("#project-name").val(a):$("#project-name").val("Untitled");d=window.localStorage[d];Blockscad.Auth.currentProject="undefined"!=
d?d:""}};var BSUtils=BSUtils||{};BSUtils.LANGUAGE_NAME={en:"English",es:"Espa\u00f1ol"};BSUtils.LANGUAGE_RTL=["ar","fa","he"];BSUtils.LANGUAGES=void 0;BSUtils.getStringParamFromUrl=function(a,c){var d=window.location.search.match(new RegExp("[?&]"+a+"=([^&]+)"));return d?decodeURIComponent(d[1].replace(/\+/g,"%20")):c};BSUtils.getLang=function(){var a=BSUtils.getStringParamFromUrl("lang","");void 0===BSUtils.LANGUAGE_NAME[a]&&(a="en");return a};BSUtils.LANG=BSUtils.getLang();
BSUtils.isRtl=function(){return-1!=BSUtils.LANGUAGE_RTL.indexOf(BSUtils.LANG)};
BSUtils.init=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);for(var a=[],c,d=0;d<BSUtils.LANGUAGES.length;d++)c=BSUtils.LANGUAGES[d],a.push([BSUtils.LANGUAGE_NAME[c],c]);a.sort(function(a,d){return a[0]>d[0]?1:a[0]<d[0]?-1:0});for(var h=document.getElementById("languageMenu"),d=h.options.length=0;d<a.length;d++){var k=a[d];c=k[k.length-1];k=new Option(k[0],c);c==BSUtils.LANG&&(k.selected=
!0);h.options.add(k)}h.addEventListener("change",BSUtils.changeLanguage,!0);document.getElementById("codeButton")&&BSUtils.bindClick("codeButton",BSUtils.showCode);(a=document.querySelector('meta[name="viewport"]'))&&725>screen.availWidth&&a.setAttribute("content","width=725, initial-scale=.35, user-scalable=no")};
BSUtils.initReadonly=function(){Blockly.inject(document.getElementById("blockly"),{path:"./",readOnly:!0,rtl:BSUtils.isRtl(),scrollbars:!1});var a=BSUtils.getStringParamFromUrl("xml",""),a=Blockly.Xml.textToDom("<xml>"+a+"</xml>");Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)};
BSUtils.loadBlocks=function(a){try{var c=window.sessionStorage.loadOnceBlocks}catch(d){c=null}"BlocklyStorage"in window&&1<window.location.hash.length?BlocklyStorage.retrieveXml(window.location.hash.substring(1)):c?(delete window.sessionStorage.loadOnceBlocks,a=Blockly.Xml.textToDom(c),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):a?(a=Blockly.Xml.textToDom(a),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)};
BSUtils.changeLanguage=function(){if("undefined"!=typeof Blockly&&window.sessionStorage){var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),a=Blockly.Xml.domToText(a);window.sessionStorage.loadOnceBlocks=a}var a=document.getElementById("languageMenu"),a=encodeURIComponent(a.options[a.selectedIndex].value),c=window.location.search,c=1>=c.length?"?lang="+a:c.match(/[?&]lang=[^&]*/)?c.replace(/([?&]lang=)[^&]*/,"$1"+a):c.replace(/\?/,"?lang="+a+"&");window.location=window.location.protocol+"//"+
window.location.host+window.location.pathname+c};BSUtils.isDialogVisible_=!1;BSUtils.dialogOrigin_=null;BSUtils.dialogDispose_=null;
BSUtils.showDialog=function(a,c,d,h,k,g){function p(){BSUtils.isDialogVisible_&&(m.style.visibility="visible",m.style.zIndex=1,w.style.visibility="hidden")}BSUtils.isDialogVisible_&&BSUtils.hideDialog(!1);BSUtils.isDialogVisible_=!0;BSUtils.dialogOrigin_=c;BSUtils.dialogDispose_=g;var m=document.getElementById("dialog");g=document.getElementById("dialogShadow");var w=document.getElementById("dialogBorder"),l;for(l in k)m.style[l]=k[l];h&&(g.style.visibility="visible",g.style.opacity=.3,h=document.createElement("div"),
h.id="dialogHeader",m.appendChild(h),BSUtils.dialogMouseDownWrapper_=Blockly.bindEvent_(h,"mousedown",null,BSUtils.dialogMouseDown_));m.appendChild(a);a.className=a.className.replace("dialogHiddenContent","");d&&c?(BSUtils.matchBorder_(c,!1,.2),BSUtils.matchBorder_(m,!0,.8),window.setTimeout(p,175)):p()};BSUtils.dialogStartX_=0;BSUtils.dialogStartY_=0;
BSUtils.dialogMouseDown_=function(a){BSUtils.dialogUnbindDragEvents_();if(!Blockly.isRightButton(a)){var c=document.getElementById("dialog");BSUtils.dialogStartX_=c.offsetLeft-a.clientX;BSUtils.dialogStartY_=c.offsetTop-a.clientY;BSUtils.dialogMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",null,BSUtils.dialogUnbindDragEvents_);BSUtils.dialogMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",null,BSUtils.dialogMouseMove_);a.stopPropagation()}};
BSUtils.dialogMouseMove_=function(a){var c=document.getElementById("dialog"),d=BSUtils.dialogStartX_+a.clientX;a=BSUtils.dialogStartY_+a.clientY;a=Math.max(a,0);a=Math.min(a,window.innerHeight-c.offsetHeight);d=Math.max(d,0);d=Math.min(d,window.innerWidth-c.offsetWidth);c.style.left=d+"px";c.style.top=a+"px"};
BSUtils.dialogUnbindDragEvents_=function(){BSUtils.dialogMouseUpWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseUpWrapper_),BSUtils.dialogMouseUpWrapper_=null);BSUtils.dialogMouseMoveWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseMoveWrapper_),BSUtils.dialogMouseMoveWrapper_=null)};
BSUtils.hideDialog=function(a){function c(){h.style.visibility="hidden";k.style.visibility="hidden"}if(BSUtils.isDialogVisible_){BSUtils.dialogUnbindDragEvents_();BSUtils.dialogMouseDownWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseDownWrapper_),BSUtils.dialogMouseDownWrapper_=null);BSUtils.isDialogVisible_=!1;BSUtils.dialogDispose_&&BSUtils.dialogDispose_();BSUtils.dialogDispose_=null;var d=!1===a?null:BSUtils.dialogOrigin_;a=document.getElementById("dialog");var h=document.getElementById("dialogShadow"),
k=document.getElementById("dialogBorder");h.style.opacity=0;d?(BSUtils.matchBorder_(a,!1,.8),BSUtils.matchBorder_(d,!0,.2),window.setTimeout(c,175)):c();a.style.visibility="hidden";a.style.zIndex=-1;for((d=document.getElementById("dialogHeader"))&&d.parentNode.removeChild(d);a.firstChild;)d=a.firstChild,d.className+=" dialogHiddenContent",document.body.appendChild(d)}};
BSUtils.matchBorder_=function(a,c,d){function h(){k.style.width=g.width+"px";k.style.height=g.height+"px";k.style.left=g.x+"px";k.style.top=g.y+"px";k.style.opacity=d}if(a){var k=document.getElementById("dialogBorder"),g=BSUtils.getBBox_(a);c?(k.className="dialogAnimate",window.setTimeout(h,1)):(k.className="",h());k.style.visibility="visible"}};
BSUtils.getBBox_=function(a){var c=a.offsetHeight,d=a.offsetWidth,h=0,k=0;do h+=a.offsetLeft,k+=a.offsetTop,a=a.offsetParent;while(a);return{height:c,width:d,x:h,y:k}};
BSUtils.storageAlert=function(a){var c=document.getElementById("containerStorage");c.textContent="";a=a.split("\n");for(var d=0;d<a.length;d++){var h=document.createElement("p");h.appendChild(document.createTextNode(a[d]));c.appendChild(h)}c=document.getElementById("dialogStorage");a=document.getElementById("linkButton");BSUtils.showDialog(c,a,!0,!0,{width:"50%",left:"25%",top:"5em"},BSUtils.stopDialogKeyDown());BSUtils.startDialogKeyDown()};
BSUtils.dialogKeyDown_=function(a){!BSUtils.isDialogVisible_||13!=a.keyCode&&27!=a.keyCode&&32!=a.keyCode||(BSUtils.hideDialog(!0),a.stopPropagation(),a.preventDefault())};BSUtils.startDialogKeyDown=function(){document.body.addEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.stopDialogKeyDown=function(){document.body.removeEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.getMsg=function(a){var c=BSUtils.getMsgOrNull(a);return null===c?"[Unknown message: "+a+"]":c};
BSUtils.getMsgOrNull=function(a){return(a=document.getElementById(a))?(a=a.textContent,a=a.replace(/\\n/g,"\n")):null};BSUtils.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var a=document.getElementsByTagName("button"),c=0,d;d=a[c];c++)d.ontouchend||(d.ontouchend=d.onclick)};window.addEventListener("load",BSUtils.addTouchEvents,!1);
BSUtils.bindClick=function(a,c){"string"==typeof a&&(a=document.getElementById(a));a.addEventListener("click",c,!0);a.addEventListener("touchend",c,!0)};Blockscad=Blockscad||{};Blockscad.Toolbox=Blockscad.Toolbox||{};Blockscad.Auth=Blockscad.Auth||{};BlocklyStorage=BlocklyStorage||{};Blockly=Blockly||{};BSUtils=BSUtils||{};Blockscad.version="1.0.1";Blockscad.offline=!0;var gCurrentFile=null,gProcessor=null,editor=null,gCurrentFiles=[],gMemFs=[],gMemFsCount=0,gMemFsTotal=0,gMemFsChanged=0,gRootFs=[],_includePath="./";Blockscad.drawAxes=1;
Blockscad.init=function(){function a(a,c){var k=a.target.files[0];if(k){var g;c&&(g=k.name.substr(0,k.name.lastIndexOf("("))||k.name,g=g.substr(0,k.name.lastIndexOf("."))||g,g=g.replace(/^\s+|\s+$/g,""));!Blockscad.offline&&c&&(Blockscad.Auth.isLoggedIn&&0<Blockscad.undo.undoStack.length&&(console.log("autosaving!"),Blockscad.Auth.saveBlocksToAccount()),Blockscad.Auth.currentProject="");c&&Blockly.getMainWorkspace().clear();var p={},m=new FileReader;m.onload=function(a){p=a.target.result;a=Blockly.Xml.textToDom(p);
Blockly.Xml.domToWorkspace(Blockscad.workspace,a);Blockly.fireUiEvent(window,"resize");Blockscad.clearStlBlocks()};m.readAsText(k);$("#importLocal")[0].value="";$("#loadLocal")[0].value="";c&&$("#project-name").val(g);$("#projView").hide();$("#editView").show();$("#displayBlocks").click()}else alert("Failed to load file")}Blockscad.initLanguage();BSUtils.isRtl();Blockscad.missingFields=[];Blockscad.csg_commands={};Blockscad.csg_filename={};Blockscad.csg_center=[0,0,0];var c=document.getElementById("main");
window.addEventListener("resize",function(a){a=BSUtils.getBBox_(c);var h=document.getElementById("blocklyDiv");h.style.top=a.y+"px";h.style.left=a.x+"px";h.style.height=a.height-88+"px";h.style.width=a.width+"px";gProcessor&&gProcessor.viewer.rendered_resize(gProcessor.viewerdiv.offsetWidth,gProcessor.viewerdiv.offsetHeight);70>$("#main").height()-$(".resizableDiv").height()&&$(".resizableDiv").height($("#main").height()-70);20>$("#main").width()-$(".resizableDiv").width()&&$(".resizableDiv").width($("#main").width()-
20);$(".resizableDiv").position({of:$("#main"),my:"right top",at:"right top",offset:"-12 -55"})},!1);Blockscad.workspace=Blockly.inject(document.getElementById("blocklyDiv"),{media:"blockly/media/",zoom:{enabled:!0,scaleSpeed:1.1,controls:!0},trashcan:!1,toolbox:Blockscad.Toolbox.adv});Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one);Blockscad.Toolbox.setCatColors();BSUtils.loadBlocks("");"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload();$(".resizableDiv").resizable({handles:"s,w,sw",
resize:function(a,c){var k=$(window).height();gProcessor&&(k=gProcessor.viewerdiv.offsetHeight,gProcessor.viewer.rendered_resize(gProcessor.viewerdiv.offsetWidth,k));20>$("#main").width()-c.size.width&&(c.size.width=$("#main").width()-20);70>$("#main").height()-c.size.height&&(c.size.height=$("#main").height()-70);c.position.left=$(window).width()-(c.size.width+12);c.position.top=55}});Blockly.fireUiEvent(window,"resize");Blockscad.offline||Blockscad.Auth.init();BSUtils.bindClick("trashButton",function(){Blockscad.discard()});
BSUtils.bindClick("renderButton",Blockscad.doRender);BSUtils.bindClick("undoButton",Blockscad.onUndo);BSUtils.bindClick("redoButton",Blockscad.onRedo);$("#axesButton").click(function(){Blockscad.drawAxes=(Blockscad.drawAxes+1)%2;$("#axesButton").toggleClass("btn-pushed");gProcessor.viewer.onDraw()});$("#displayCode").click(function(){var a=document.getElementById("openScadPre"),c=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace);a.textContent=c;"function"==typeof prettyPrintOne&&(c=a.innerHTML,
c=prettyPrintOne(c,"js"),a.innerHTML=c);Blockly.fireUiEvent(window,"resize")});$("#renderButton").prop("disabled",!0);$("#throw-it-away").click(Blockscad.clearProject);$("#main").on("click",".new-project",Blockscad.newProject);Blockscad.readStlFile=function(a){var c=a.target.files[0];c?(a=new FileReader,a.onload=function(a){a=importSTL(a.target.result);var d=a[0];(a=a[1])||(a="blah");for(var p=c.name.substr(0,c.name.lastIndexOf("("))||c.name,p=p.substr(0,c.name.lastIndexOf("."))||p,m=p=p.replace(/^\s+|\s+$/g,
""),w=1,l=0;Blockscad.csg_commands[m]&&!l;)d!=Blockscad.csg_commands[m]?(m=p+"_"+w,w++):l=1;Blockscad.csg_commands[m]=d;Blockscad.csg_filename[m]=l?Blockscad.csg_filename[m]+(c.name+":::"):c.name+":::";Blockscad.csg_center[m]=a;Blockscad.currentInterestingBlock?(p=Blockscad.currentInterestingBlock.getField("STL_FILENAME"),d=Blockscad.currentInterestingBlock.getField("STL_BUTTON"),w=Blockscad.currentInterestingBlock.getField("STL_CONTENTS"),p.setText(c.name),p.setVisible(!0),d.setVisible(!1),w.setText(m),
Blockscad.currentInterestingBlock.setCommentText(c.name+"\ncenter:("+a+")"),Blockscad.currentInterestingBlock=null):(m=Blockly.Xml.textToDom('<xml xmlns="http://www.w3.org/1999/xhtml"><block type="stl_import" id="1" x="10" y="10"><field name="STL_FILENAME">'+c.name+'</field><field name="STL_BUTTON">Browse</field><field name="STL_CONTENTS">'+m+"</field></block></xml>"),m=Blockly.Xml.domToBlock(Blockscad.workspace,m.firstChild),d=m.getField("STL_BUTTON"),d.setVisible(!1),m.setCommentText(c.name+"\ncenter:("+
a+")"),m.render())},a.readAsBinaryString(c),$("#importStl")[0].value="",$("#displayBlocks").click(),$("#renderButton").prop("disabled",!1)):alert("Failed to load file")};$("#file-menu").on("change","#loadLocal",function(c){a(c,!0)});$("#file-menu").on("change","#importLocal",function(c){a(c,!1)});$("#file-menu").on("change","#importStl",function(a){Blockscad.readStlFile(a)});gProcessor=new Blockscad.Processor(document.getElementById("renderDiv"));BSUtils.bindClick("viewReset",Blockscad.resetView);
Blockscad.undo={blockList:[],oldBlockList:[],undoStack:[],redoStack:[],current_xml:null,blockCount:0,yesthis:0,fieldChanging:0,blockIds:[],fieldValues:[],parentIds:[],oldBlockIds:[],oldFieldValues:[],oldParentIds:[],just_did_undo:0};Blockscad.workspace.addUndoListener(Blockscad.workspaceChanged);Blockscad.offline||Blockscad.Auth.checkForUser();$("#help-menu").on("click","#about",function(){$("#about-modal").modal("show")});$("#file-menu").on("click","#saveLocal",Blockscad.saveBlocksLocal);$("#simpleToolbox").on("click",
function(){console.log("switching to simple toolbox");Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.sim),Blockscad.Toolbox.setCatColors(Blockscad.Toolbox.colorScheme.one))});$("#advancedToolbox").on("click",function(){console.log("switching to advanced toolbox");Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.adv),Blockscad.Toolbox.setCatColors(Blockscad.Toolbox.colorScheme.one))});$("#colors_one").on("click",
function(){console.log("switching block color scheme");Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one),Blockscad.Toolbox.setCatColors(),Blockscad.workspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});$("#colors_two").on("click",function(){console.log("switching block color scheme");Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.two),Blockscad.Toolbox.setCatColors(),Blockscad.workspace.clear(),
Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});$(function(){$(".dropdown-menu > li > a.trigger").on("click",function(a){var c=$(this).next(),k=$(this).parent().parent();($(this).hasClass("left-caret")||$(this).hasClass("right-caret"))&&$(this).toggleClass("right-caret left-caret");k.find(".left-caret").not(this).toggleClass("right-caret left-caret");k.find(".sub-menu:visible").not(c).hide();c.toggle();a.stopPropagation()});$(".dropdown-menu > li > a:not(.trigger)").on("click",
function(){var a=$(this).closest(".dropdown");a.find(".left-caret").toggleClass("right-caret left-caret");a.find(".sub-menu:visible").hide()})})};document.write('<script src="blockly/msg/js/'+BSUtils.LANG+'.js">\x3c/script>\n');window.addEventListener("load",Blockscad.init);
Blockscad.clearStlBlocks=function(){for(var a=Blockscad.workspace.getAllBlocks(),c=0;c<a.length;c++)if("stl_import"==a[c].type){var d=a[c].getField("STL_BUTTON");a[c].getField("STL_CONTENTS").setText("");a[c].getField("STL_FILENAME").setText("");var h=a[c].getCommentText();h.match(/^RELOAD/)||(h="RELOAD: "+h);a[c].setCommentText(h);d.setText("Reload");a[c].backlight();if(h=a[c].collapsedParents())for(var k=0;k<h.length;k++)h[k].backlight();a[c].isCollapsed()||d.setVisible(!0);d=a[c];for(h=null;d;)d.isCollapsed()&&
(h=d),d=d.getSurroundParent();h&&h.setCollapsed(!0,!0);a[c].render()}};Blockscad.newProject=function(){0<Blockscad.undo.undoStack.length?!Blockscad.offline&&Blockscad.Auth.isLoggedIn?(console.log("autosaving"),Blockscad.Auth.saveBlocksToAccount(),Blockscad.clearProject()):$("#delete-confirm").modal("show"):Blockscad.clearProject();$("#displayBlocks").click()};
Blockscad.clearProject=function(){Blockscad.offline||(Blockscad.Auth.currentProject="",Blockscad.Auth.currentProjectKey="");Blockscad.workspace.clear();gProcessor.clearViewer();for(Blockscad.workspaceChanged();Blockscad.undo.undoStack.length;)Blockscad.undo.undoStack.pop();for(;Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop();$("#project-name").val("Untitled");$("#projectView").hide();$("#editView").show()};
Blockscad.discard=function(){var a=Blockly.mainWorkspace.getAllBlocks().length;if(2>a||window.confirm("Delete all "+a+" blocks?"))Blockly.mainWorkspace.clear(),window.location.hash=""};Blockscad.resetView=function(){gProcessor&&gProcessor.viewer&&gProcessor.viewer.viewReset()};
Blockscad.mixes2and3D=function(){for(var a=[],a=Blockly.mainWorkspace.getTopBlocks(),c=0,d=0,h=0,k=0,g=0;g<a.length;g++)if(Blockscad.stackIsShape(a[g])){var k=1,p=a[g].category,m;"PRIMITIVE_CSG"==p&&c++;"PRIMITIVE_CAG"==p&&d++;if("TRANSFORM"==p||"SET_OP"==p)m=a[g].getInput("A").connection.check_,1==m.length&&"CSG"==m[0]&&c++,1==m.length&&"CAG"==m[0]&&d++;"LOOP"==p&&(m=a[g].getInput("DO").connection.check_,1==m.length&&"CSG"==m[0]&&c++,1==m.length&&"CAG"==m[0]&&d++);"PROCEDURE"==p&&((m=a[g].myType_)&&
"CSG"==m&&c++,m&&"CAG"==m&&d++);"COLOR"==p&&c++;"EXTRUDE"==p&&c++;"controls_if"==a[g].type&&h++}!k||c+d+h||Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks());return[c&&d,k]};
Blockscad.doRender=function(){$("#error-message").html("");$("#error-message").removeClass("has-error");$("#renderButton").prop("disabled",!0);gProcessor.clearViewer();var a=Blockscad.mixes2and3D();if(0===a[1])$("#error-message").html("Error: Nothing to Render"),$("#error-message").addClass("has-error");else if(a[0])$("#error-message").html("Error: both 2D and 3D objects are present.  There can be only one."),$("#error-message").addClass("has-error");else{Blockscad.missingFields=[];Blockscad.illegalValue=
[];var a=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),c=!1;if(0<Blockscad.missingFields.length)for(var d=0;d<Blockscad.missingFields.length;d++){c=Blockly.mainWorkspace.getBlockById(Blockscad.missingFields[d]);c.unselect();c.backlight();if(c=c.collapsedParents())for(var h=0;h<c.length;h++)c[h].unselect(),c[h].backlight();c=!0}if(0<Blockscad.illegalValue.length){for(d=0;d<Blockscad.illegalValue.length;d++)if(c=Blockly.mainWorkspace.getBlockById(Blockscad.illegalValue[d]),c.unselect(),c.backlight(),
c=c.collapsedParents())for(h=0;h<c.length;h++)c[h].unselect(),c[h].backlight();c=!0}if(c)a="",Blockscad.missingFields.length&&(a+="ERROR: "+Blockscad.missingFields.length+" blocks are missing fields."),Blockscad.missingFields.length&&Blockscad.illegalValue.length&&(a+="<br>"),Blockscad.illegalValue.length&&(a+="ERROR: "+Blockscad.illegalValue.length+" blocks have an illegal negative or zero value"),$("#error-message").html(a),$("#error-message").addClass("has-error");else if(Blockscad.loadTheseFonts=
Blockscad.whichFonts(a),$("#renderButton").html("working"),0<Blockscad.loadTheseFonts.length)for(console.log("I need to load "+Blockscad.loadTheseFonts.length+" fonts."),d=Blockscad.numloaded=0;d<Blockscad.loadTheseFonts.length;d++)Blockscad.loadFontThenRender(d,a);else Blockscad.renderCode(a)}};
Blockscad.renderCode=function(a){var c="",d=!0;try{window.setTimeout(function(){c=openscadOpenJscadParser.parse(a)},0)}catch(h){$("#error-message").html(h),$("#error-message").addClass("has-error"),d=!1}d?window.setTimeout(function(){gProcessor.setBlockscad(c)},0):$("#renderButton").html("Render")};
Blockscad.isRealChange=function(){Blockscad.undo.blockIds=[];Blockscad.undo.parentIds=[];Blockscad.undo.fieldValues=[];Blockscad.undo.isDisabled=[];for(var a=null,a=a=null,c=!1,d=0;d<Blockscad.undo.blockList.length;d++)Blockscad.undo.fieldValues[d]=Blockscad.undo.blockList[d].getAllFieldValues(),Blockscad.undo.blockIds[d]=Blockscad.undo.blockList[d].id,Blockscad.undo.isDisabled[d]=Blockscad.undo.blockList[d].disabled,Blockscad.undo.blockList[d].getParent()?Blockscad.undo.parentIds[d]=Blockscad.undo.blockList[d].getParent().id:
Blockscad.undo.parentIds[d]=null,Blockscad.undo.blockList[d].category&&"UNKNOWN"==Blockscad.undo.blockList[d].category&&Blockscad.undo.blockList[d].getType();if(Blockscad.undo.blockCount>Blockscad.undo.blockList.length)return Blockscad.undo.fieldChanging=0,0!==Blockscad.undo.blockList.length&&(a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList),(a=Blockscad.getBlockFromId(Blockscad.undo.oldParentIds[a],Blockscad.undo.blockList))&&Blockscad.assignBlockTypes([a])),!0;
if(Blockscad.undo.blockCount<Blockscad.undo.blockList.length)return Blockscad.undo.fieldChanging=0,0===Blockscad.undo.oldBlockList.length?Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()):(a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList),Blockscad.assignBlockTypes([Blockscad.undo.blockList[a]])),!0;for(d=0;d<Blockscad.undo.blockIds.length;d++){for(var h=Blockscad.undo.blockIds[d],k=0,a=0;a<Blockscad.undo.blockIds.length;a++)if(h==Blockscad.undo.oldBlockIds[a]){k=
1;if(Blockscad.undo.parentIds[d]!=Blockscad.undo.oldParentIds[a]){Blockscad.enableMathBlocks(Blockscad.undo.blockList[d]);Blockscad.assignBlockTypes([Blockscad.undo.blockList[d]]);for(c=0;d=Blockscad.undo.blockList[c];c++)if(d.id==Blockscad.undo.oldParentIds[a]){Blockscad.assignBlockTypes([Blockscad.undo.blockList[c]]);Blockscad.enableMathBlocks(Blockscad.undo.blockList[c]);break}return!0}if(Blockscad.undo.fieldValues[d]!=Blockscad.undo.oldFieldValues[a])return $("#renderButton").prop("disabled",
!1),Blockscad.undo.fieldChanging!=h?(Blockscad.undo.fieldChanging=h,!0):!1;Blockscad.undo.isDisabled[d]!=Blockscad.undo.oldDisabled[a]&&(c=!0)}if(!k)return!0}return c?!0:!1};
Blockscad.workspaceChanged=function(){Blockscad.undo.yesthis=0;Blockscad.undo.blockList=Blockly.mainWorkspace.getAllBlocks();Blockscad.undo.yesthis=Blockscad.isRealChange();Blockscad.undo.blockCount=Blockscad.undo.blockList.length;Blockscad.undo.oldBlockIds=Blockscad.undo.blockIds;Blockscad.undo.oldParentIds=Blockscad.undo.parentIds;Blockscad.undo.oldFieldValues=Blockscad.undo.fieldValues;Blockscad.undo.oldDisabled=Blockscad.undo.isDisabled;Blockscad.checkMathOrphans();if(Blockscad.undo.yesthis&&
($("#renderButton").prop("disabled",!1),Blockscad.undo.just_did_undo&&Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()),0===Blockscad.undo.just_did_undo)){null!==Blockscad.undo.current_xml&&Blockscad.undo.undoStack.push(Blockscad.undo.current_xml);for(Blockscad.undo.current_xml=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());0<Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop();50<Blockscad.undo.undoStack.length&&Blockscad.undo.undoStack.shift()}Blockscad.undo.current_xml=
Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());Blockscad.undo.oldBlockList=[];for(var a=0;a<Blockscad.undo.blockList.length;a++)Blockscad.undo.oldBlockList.push(Blockly.Xml.blockToDom_(Blockscad.undo.blockList[a]));Blockscad.undo.just_did_undo=0;0<Blockscad.undo.undoStack.length?$("#undoButton").prop("disabled",!1):$("#undoButton").prop("disabled",!0);0<Blockscad.undo.redoStack.length?$("#redoButton").prop("disabled",!1):$("#redoButton").prop("disabled",!0)};
Blockscad.getExtraRootBlock=function(a,c){var d=0;if(a.length>c.length)for(var h=0;h<a.length;h++){for(var k=d=0;k<c.length;k++)if(a[h].getAttribute("id")==c[k].id){d=1;break}if(!d)return h}else for(h=0;h<c.length;h++){for(k=d=0;k<a.length;k++)if(c[h].id==a[k].getAttribute("id")){d=1;break}if(!d)return h}return 0};Blockscad.getBlockFromId=function(a,c){for(var d=0,h;h=c[d];d++)if(h.id==a)return h;return null};
Blockscad.onUndo=function(){0<Blockscad.undo.undoStack.length&&(Blockscad.undo.redoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.undoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};
Blockscad.onRedo=function(){0<Blockscad.undo.redoStack.length&&(Blockscad.undo.undoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.redoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};
Blockscad.checkMathOrphans=function(){for(var a=[],a=Blockly.mainWorkspace.getTopBlocks(),c=0;c<a.length;c++)-1==a[c].type.lastIndexOf("math")&&-1==a[c].type.lastIndexOf("variables_get")&&-1==a[c].type.lastIndexOf("logic")||a[c].setDisabled(!0)};
Blockscad.enableMathBlocks=function(a){a=a.getDescendants();for(var c=0;c<a.length;c++)if(a[c].disabled&&(-1!=a[c].type.lastIndexOf("math")||-1!=a[c].type.lastIndexOf("variables_get")||-1!=a[c].type.lastIndexOf("logic"))){var d;if(d=a[c].getParent())d.disabled||a[c].setDisabled(!1)}};Blockscad.aCallerBlock=function(a,c){for(var d=0;d<c.length;d++)if(a==c[d])return!0;return!1};
Blockscad.findBlockType=function(a,c){for(var d=a.getRootBlock().getDescendants(),h=0,k=0,g=0;g<d.length;g++)if(!Blockscad.aCallerBlock(d[g],c)&&d[g].category){var p=d[g].category;if("PRIMITIVE_CSG"==p||"EXTRUDE"==p||"COLOR"==p){h=1;break}"PRIMITIVE_CAG"==p&&(k=1)}return h?Blockscad.hasExtrudeParent(a)?"CAG":"CSG":k?"CAG":"EITHER"};Blockscad.stackIsShape=function(a){a=a.getDescendants();for(var c=0;c<a.length;c++){var d=a[c];if(("PRIMITIVE_CSG"==d.category||"PRIMITIVE_CAG"==d.category)&&!d.hasDisabledParent())return!0}return!1};
Blockscad.assignBlockTypes=function(a){for(var c=0;c<a.length;c++){for(var d=a[c].getRootBlock().getDescendants(),h=0,k=0,g=0;g<d.length;g++)if(d[g].category){var p=d[g].category;if("PRIMITIVE_CSG"==p||"EXTRUDE"==p||"COLOR"==p){h=1;break}"PRIMITIVE_CAG"==p&&(k=1)}for(g=0;g<d.length;g++)!d[g].category||"TRANSFORM"!=d[g].category&&"SET_OP"!=d[g].category&&"PROCEDURE"!=d[g].category&&"LOOP"!=d[g].category||(p=!d[g].collapsedParents(),h?Blockscad.hasExtrudeParent(d[g])?d[g].setType("CAG",p):d[g].setType("CSG",
p):k?d[g].setType("CAG",p):d[g].setType(["CSG","CAG"],p))}};Blockscad.hasExtrudeParent=function(a){do{if("EXTRUDE"==a.category)return!0;a=a.parentBlock_}while(a);return!1};function putSourceInEditor(a,c){editor.setValue(a);editor.clearSelection();editor.navigateFileStart();previousFilename=c;previousScript=a;gPreviousModificationTime=""}
Blockscad.initLanguage=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);var a=[],c;for(c in BSUtils.LANGUAGE_NAME)a.push([BSUtils.LANGUAGE_NAME[c],c]);a.sort(function(a,c){return a[0]>c[0]?1:a[0]<c[0]?-1:0});for(var d=document.getElementById("languageMenu"),h=d.options.length=0;h<a.length;h++){var k=a[h];c=k[k.length-1];k=new Option(k[0],c);c==BSUtils.LANG&&(k.selected=!0);d.options.add(k)}d.addEventListener("change",
BSUtils.changeLanguage,!0)};Blockscad.saveBlocksLocal=function(){var a=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()),a=Blockly.Xml.domToText(a),a=new Blob([a],{type:"text/plain;charset=utf-8"}),c=$("#project-name").val();c?saveAs(a,c+".xml"):alert("SAVE FAILED.  Please give your project a name, then try again.")};var fileSaver={},saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var c=a.document,d=a.URL||a.webkitURL||a,h=c.createElementNS("http://www.w3.org/1999/xhtml","a"),k=!a.externalHost&&"download"in h,g=a.webkitRequestFileSystem,p=a.requestFileSystem||g||a.mozRequestFileSystem,m=function(c){(a.setImmediate||a.setTimeout)(function(){throw c;},0)},
w=0,l=[],t=function(){for(var a=l.length;a--;){var c=l[a];"string"===typeof c?d.revokeObjectURL(c):c.remove()}l.length=0},q=function(a,c,d){c=[].concat(c);for(var g=c.length;g--;){var h=a["on"+c[g]];if("function"===typeof h)try{h.call(a,d||a)}catch(k){m(k)}}},u=function(d,m){var n=this,u=d.type,r=!1,A,f,t=function(){var b=(a.URL||a.webkitURL||a).createObjectURL(d);l.push(b);return b},x=function(){q(n,["writestart","progress","write","writeend"])},H=function(){if(r||!A)A=t(d);f?f.location.href=A:window.open(A,
"_blank");n.readyState=n.DONE;x()},e=function(b){return function(){if(n.readyState!==n.DONE)return b.apply(this,arguments)}},v={create:!0,exclusive:!1},b;n.readyState=n.INIT;m||(m="download");if(k)A=t(d),c=a.document,h=c.createElementNS("http://www.w3.org/1999/xhtml","a"),h.href=A,h.download=m,u=c.createEvent("MouseEvents"),u.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),h.dispatchEvent(u),n.readyState=n.DONE,x();else{a.chrome&&u&&"application/octet-stream"!==u&&(b=d.slice||d.webkitSlice,
d=b.call(d,0,d.size,"application/octet-stream"),r=!0);g&&"download"!==m&&(m+=".download");if("application/octet-stream"===u||g)f=a;p?(w+=d.size,p(a.TEMPORARY,w,e(function(b){b.root.getDirectory("saved",v,e(function(b){var a=function(){b.getFile(m,v,e(function(b){b.createWriter(e(function(e){e.onwriteend=function(e){f.location.href=b.toURL();l.push(b);n.readyState=n.DONE;q(n,"writeend",e)};e.onerror=function(){var b=e.error;b.code!==b.ABORT_ERR&&H()};["writestart","progress","write","abort"].forEach(function(b){e["on"+
b]=n["on"+b]});e.write(d);n.abort=function(){e.abort();n.readyState=n.DONE};n.readyState=n.WRITING}),H)}),H)};b.getFile(m,{create:!1},e(function(b){b.remove();a()}),e(function(b){b.code===b.NOT_FOUND_ERR?a():H()}))}),H)}),H)):H()}},x=u.prototype,n=function(a,c){return new u(a,c)};x.abort=function(){this.readyState=this.DONE;q(this,"abort")};x.readyState=x.INIT=0;x.WRITING=1;x.DONE=2;x.error=x.onwritestart=x.onprogress=x.onwrite=x.onabort=x.onerror=x.onwriteend=null;a.addEventListener("unload",t,!1);
n.unload=function(){t();a.removeEventListener("unload",t,!1)};return n}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&(module.exports=saveAs);Blockscad=Blockscad||{};Blockscad.fonts={};Blockscad.fontList="/fonts/liberation/LiberationSerif-Bold.ttf /fonts/Roboto/Roboto-Bold.ttf /fonts/nimbus/nimbus-sans-l_bold.ttf /fonts/AverageMono/AverageMonoSimp.ttf /fonts/Open_Sans/OpenSans-ExtraBold.ttf /fonts/Chewy/Chewy.ttf /fonts/bangers/bangers.ttf".split(" ");Blockscad.fontName="Liberation Serif;Roboto;Nimbus Sans;Average Mono;Open Sans;Chewy;Bangers".split(";");Blockscad.loadFonts=function(){for(var a=0;a<Blockscad.fontList.length;a++)Blockscad.loadFont(a)};
Blockscad.loadFont=function(a){opentype.load(Blockscad.fontList[a],function(c,d){if(c)console.log("Could not load font: ",d+":"+c);else return Blockscad.fonts[Blockscad.fontName[a]]=d})};
Blockscad.loadFontThenRender=function(a,c){try{opentype.load(Blockscad.fontList[Blockscad.loadTheseFonts[a]],function(d,k){d?console.log("Could not load font: ",k+":"+d):(Blockscad.fonts[Blockscad.fontName[Blockscad.loadTheseFonts[a]]]=k,Blockscad.numloaded++,Blockscad.numloaded==Blockscad.loadTheseFonts.length&&Blockscad.renderCode(c))})}catch(d){console.log("network error loading font")}};
Blockscad.pathToPoints=function(a,c){var d=[],h=[],k=[],g=2,p,m,w,l,t,q;2<c&&(g=c);10<g&&(g=10);if(a&&a.commands&&0<a.commands.length)for(var u=0,x=[],n=0;n<a.commands.length;n++)switch(a.commands[n].type){case "M":2<k.length&&h.push(k);k=[];d.push([a.commands[n].x,-1*a.commands[n].y]);k.push(u++);x=[a.commands[n].x,-1*a.commands[n].y];break;case "L":d.push([a.commands[n].x,-1*a.commands[n].y]);k.push(u++);x=[a.commands[n].x,-1*a.commands[n].y];break;case "C":p=[a.commands[n].x,-1*a.commands[n].y];
m=[a.commands[n].x1,-1*a.commands[n].y1];w=[a.commands[n].x2,-1*a.commands[n].y2];for(var y=1;y<=g;y++)q=y/g,Math.pow(1-q,3),Math.pow(1-q,2),Math.pow(1-q,1),Math.pow(q,3),l=x[1]*Math.pow(1-q,3)+3*m[1]*Math.pow(1-q,2)*q+3*w[1]*Math.pow(1-q,1)*q*q+p[1]*Math.pow(q,3),d.push([l,t]),k.push(u++);x=p;break;case "Q":p=[a.commands[n].x,-1*a.commands[n].y];m=[a.commands[n].x1,-1*a.commands[n].y1];for(y=1;y<=g;y++)q=y/g,l=x[0]*Math.pow(1-q,2)+2*m[0]*Math.pow(1-q,1)*q+p[0]*Math.pow(q,2),t=x[1]*Math.pow(1-q,2)+
2*m[1]*Math.pow(1-q,1)*q+p[1]*Math.pow(q,2),d.push([l,t]),k.push(u++);x=p;break;case "Z":2<k.length&&(h.push(k),k=[])}3>d.length&&(d=[]);return[d,h]};Blockscad.whichFonts=function(a){for(var c=[],d=0;d<Blockscad.fontList.length;d++)-1<a.indexOf(Blockscad.fontName[d])&&(Blockscad.fonts[Blockscad.fontName[d]]||c.push(d));return c};var GL=function(){function a(e,a,b){b=b||{};this.id=f.createTexture();this.width=e;this.height=a;this.format=b.format||f.RGBA;this.type=b.type||f.UNSIGNED_BYTE;f.bindTexture(f.TEXTURE_2D,this.id);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,b.filter||b.magFilter||f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,b.filter||b.minFilter||f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,b.wrap||b.wrapS||f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,
f.TEXTURE_WRAP_T,b.wrap||b.wrapT||f.CLAMP_TO_EDGE);f.texImage2D(f.TEXTURE_2D,0,this.format,e,a,0,this.format,this.type,null)}function c(){this.unique=[];this.indices=[];this.map={}}function d(e,a){this.buffer=null;this.target=e;this.type=a;this.data=[]}function h(e){e=e||{};this.vertexBuffers={};this.indexBuffers={};this.addVertexBuffer("vertices","gl_Vertex");e.coords&&this.addVertexBuffer("coords","gl_TexCoord");e.normals&&this.addVertexBuffer("normals","gl_Normal");e.colors&&this.addVertexBuffer("colors",
"gl_Color");"triangles"in e&&!e.triangles||this.addIndexBuffer("triangles");e.lines&&this.addIndexBuffer("lines")}function k(e){return new g(2*(e&1)-1,(e&2)-1,(e&4)/2-1)}function g(e,a,b){this.x=e||0;this.y=a||0;this.z=b||0}function p(e,a,b){for(var c;null!==(c=e.exec(a));)b(c)}function m(e,a){function b(b){var e=document.getElementById(b);return e?e.text:b}function c(b,e){var a={},v=/^((\s*\/\/.*\n|\s*#extension.*\n)+)\^*$/.exec(e);e=v?v[1]+b+e.substr(v[1].length):b+e;p(/\bgl_\w+\b/g,b,function(b){b in
a||(e=e.replace(new RegExp("\\b"+b+"\\b","g"),"LIGHTGL"+b),a[b]=!0)});return e}function d(b,e){var a=f.createShader(b);f.shaderSource(a,e);f.compileShader(a);if(!f.getShaderParameter(a,f.COMPILE_STATUS))throw"compile error: "+f.getShaderInfoLog(a);return a}e=b(e);a=b(a);var g=e+a,h={};p(/\b(gl_[^;]*)\b;/g,"uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",
function(b){b=b[1];if(-1!=g.indexOf(b)){var e=b.replace(/[a-z_]/g,"");h[e]="LIGHTGL"+b}});-1!=g.indexOf("ftransform")&&(h.MVPM="LIGHTGLgl_ModelViewProjectionMatrix");this.usedMatrices=h;e=c("uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;vec4 ftransform() {  return gl_ModelViewProjectionMatrix * gl_Vertex;}",
e);a=c("precision highp float;uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",a);this.program=f.createProgram();f.attachShader(this.program,d(f.VERTEX_SHADER,e));f.attachShader(this.program,d(f.FRAGMENT_SHADER,a));f.linkProgram(this.program);if(!f.getProgramParameter(this.program,f.LINK_STATUS))throw"link error: "+
f.getProgramInfoLog(this.program);this.attributes={};this.uniformLocations={};var k={};p(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+a,function(b){k[b[2]]=1});this.isSampler=k}function w(){f.MODELVIEW=Q|1;f.PROJECTION=Q|2;var e=new n,a=new n;f.modelviewMatrix=new n;f.projectionMatrix=new n;var b=[],c=[],d,h;f.matrixMode=function(e){switch(e){case f.MODELVIEW:d="modelviewMatrix";h=b;break;case f.PROJECTION:d="projectionMatrix";h=c;break;default:throw"invalid matrix mode "+e;}};f.loadIdentity=
function(){n.identity(f[d])};f.loadMatrix=function(b){b=b.m;for(var e=f[d].m,a=0;16>a;a++)e[a]=b[a]};f.multMatrix=function(b){f.loadMatrix(n.multiply(f[d],b,a))};f.perspective=function(b,a,v,c){f.multMatrix(n.perspective(b,a,v,c,e))};f.frustum=function(b,a,v,c,d,B){f.multMatrix(n.frustum(b,a,v,c,d,B,e))};f.ortho=function(b,a,v,c,d,B){f.multMatrix(n.ortho(b,a,v,c,d,B,e))};f.scale=function(b,a,v){f.multMatrix(n.scale(b,a,v,e))};f.translate=function(b,a,v){f.multMatrix(n.translate(b,a,v,e))};f.rotate=
function(b,a,v,c){f.multMatrix(n.rotate(b,a,v,c,e))};f.lookAt=function(b,a,v,c,d,B,g,h,D){f.multMatrix(n.lookAt(b,a,v,c,d,B,g,h,D,e))};f.pushMatrix=function(){h.push(Array.prototype.slice.call(f[d].m))};f.popMatrix=function(){var b=h.pop();f[d].m=H?new Float32Array(b):b};f.project=function(b,e,a,v,c,d){v=v||f.modelviewMatrix;c=c||f.projectionMatrix;d=d||f.getParameter(f.VIEWPORT);b=c.transformPoint(v.transformPoint(new g(b,e,a)));return new g(d[0]+d[2]*(.5*b.x+.5),d[1]+d[3]*(.5*b.y+.5),.5*b.z+.5)};
f.unProject=function(b,c,d,B,h,D){B=B||f.modelviewMatrix;h=h||f.projectionMatrix;D=D||f.getParameter(f.VIEWPORT);b=new g((b-D[0])/D[2]*2-1,(c-D[1])/D[3]*2-1,2*d-1);return n.inverse(n.multiply(h,B,e),a).transformPoint(b)};f.matrixMode(f.MODELVIEW)}function l(){var e=new h({coords:!0,colors:!0,triangles:!1}),a=-1,b=[0,0,0,0],c=[1,1,1,1],d=new m("uniform float pointSize;varying vec4 color;varying vec4 coord;void main() {color = gl_Color;coord = gl_TexCoord;gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;gl_PointSize = pointSize;}",
"uniform sampler2D texture;uniform float pointSize;uniform bool useTexture;varying vec4 color;varying vec4 coord;void main() {gl_FragColor = color;if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);}");f.pointSize=function(b){d.uniforms({pointSize:b})};f.begin=function(b){if(-1!=a)throw"mismatched gl.begin() and gl.end() calls";a=b;e.colors=[];e.coords=[];e.vertices=[]};f.color=function(b,e,a,v){c=1==arguments.length?b.toArray().concat(1):[b,e,a,v||1]};f.texCoord=function(e,a){b=1==arguments.length?
e.toArray(2):[e,a]};f.vertex=function(a,v,d){e.colors.push(c);e.coords.push(b);e.vertices.push(1==arguments.length?a.toArray():[a,v,d])};f.end=function(){if(-1==a)throw"mismatched gl.begin() and gl.end() calls";e.compile();d.uniforms({useTexture:!!f.getParameter(f.TEXTURE_BINDING_2D)}).draw(e,a);a=-1}}function t(){function e(){for(var b in F)if(u.call(F,b)&&F[b])return!0;return!1}function a(b){var v={},c;for(c in b)v[c]="function"==typeof b[c]?function(e){return function(){e.apply(b,arguments)}}(b[c]):
b[c];v.original=b;v.x=v.pageX;v.y=v.pageY;for(c=f.canvas;c;c=c.offsetParent)v.x-=c.offsetLeft,v.y-=c.offsetTop;q?(v.deltaX=v.x-l,v.deltaY=v.y-r):(v.deltaX=0,v.deltaY=0,q=!0);l=v.x;r=v.y;v.dragging=e();v.preventDefault=function(){v.original.preventDefault()};v.stopPropagation=function(){v.original.stopPropagation()};return v}function b(b){var e={},a;for(a in b)e[a]="function"==typeof b[a]?function(e){return function(){e.apply(b,arguments)}}(b[a]):b[a];e.original=b;if(0<e.targetTouches.length){a=e.targetTouches[0];
e.x=a.pageX;e.y=a.pageY;for(a=f.canvas;a;a=a.offsetParent)e.x-=a.offsetLeft,e.y-=a.offsetTop;q?(e.deltaX=e.x-l,e.deltaY=e.y-r):(e.deltaX=0,e.deltaY=0,q=!0);l=e.x;r=e.y;e.dragging=!0}e.preventDefault=function(){e.original.preventDefault()};e.stopPropagation=function(){e.original.stopPropagation()};return e}function c(b){f=n;b=a(b);if(f.onmousemove)f.onmousemove(b);b.preventDefault()}function d(b){f=n;F[b.which]=!1;e()||(document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",
d),f.canvas.addEventListener("mousemove",c),f.canvas.addEventListener("mouseup",d));b=a(b);if(f.onmouseup)f.onmouseup(b);b.preventDefault()}function h(b){f=n;b=a(b);if(f.onmousewheel)f.onmousewheel(b);b.preventDefault()}function g(e){f=n;0===e.targetTouches.length&&k(e);e=b(e);if(f.ontouchmove)f.ontouchmove(e);e.preventDefault()}function k(e){document.removeEventListener("touchmove",g);document.removeEventListener("touchend",k);f.canvas.addEventListener("touchmove",g);f.canvas.addEventListener("touchend",
k);f=n;e=b(e);if(f.ontouchend)f.ontouchend(e);e.preventDefault()}function m(){q=!1}function p(){F={};q=!1}var n=f,l=0,r=0,F={},q=!1,u=Object.prototype.hasOwnProperty;f.canvas.addEventListener("mousedown",function(b){f=n;e()||(document.addEventListener("mousemove",c),document.addEventListener("mouseup",d),f.canvas.removeEventListener("mousemove",c),f.canvas.removeEventListener("mouseup",d));F[b.which]=!0;b=a(b);if(f.onmousedown)f.onmousedown(b);b.preventDefault()});f.canvas.addEventListener("mousemove",
c);f.canvas.addEventListener("mouseup",d);f.canvas.addEventListener("mousewheel",h);f.canvas.addEventListener("DOMMouseScroll",h);f.canvas.addEventListener("mouseover",m);f.canvas.addEventListener("mouseout",m);f.canvas.addEventListener("touchstart",function(e){p();document.addEventListener("touchmove",g);document.addEventListener("touchend",k);f.canvas.removeEventListener("touchmove",g);f.canvas.removeEventListener("touchend",k);f=n;e=b(e);if(f.ontouchstart)f.ontouchstart(e);e.preventDefault()});
f.canvas.addEventListener("touchmove",g);f.canvas.addEventListener("touchend",k);document.addEventListener("contextmenu",p)}function q(e){return{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[e]||(65<=e&&90>=e?String.fromCharCode(e):null)}function u(e,a,b){e.addEventListener(a,b)}function x(){(function(e){f.makeCurrent=function(){f=e}})(f);f.animate=function(){function e(){f=c;var d=(new Date).getTime();if(f.onupdate)f.onupdate((d-b)/1E3);
if(f.ondraw)f.ondraw();a(e);b=d}var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(b){setTimeout(b,1E3/60)},b=(new Date).getTime(),c=f;e()};f.fullscreen=function(e){function a(){f.canvas.width=window.innerWidth-c-d;f.canvas.height=window.innerHeight-b-g;f.viewport(0,0,f.canvas.width,f.canvas.height);!e.camera&&"camera"in e||(f.matrixMode(f.PROJECTION),f.loadIdentity(),f.perspective(e.fov||45,f.canvas.width/f.canvas.height,e.near||.1,e.far||
1E3),f.matrixMode(f.MODELVIEW));if(f.onresize)f.onresize();if(f.ondraw)f.ondraw()}e=e||{};var b=e.paddingTop||0,c=e.paddingLeft||0,d=e.paddingRight||0,g=e.paddingBottom||0;if(!document.body)throw"document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)";document.body.appendChild(f.canvas);document.body.style.overflow="hidden";f.canvas.style.position="absolute";f.canvas.style.left=c+"px";f.canvas.style.top=b+"px";window.addEventListener("resize",a);
a()}}function n(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.m=H?new Float32Array(e):e}function y(e,a,b){this.t=arguments.length?e:Number.MAX_VALUE;this.hit=a;this.normal=b}function G(){var e=f.getParameter(f.VIEWPORT),a=f.modelviewMatrix.m,b=new g(a[0],a[4],a[8]),c=new g(a[1],a[5],a[9]),d=new g(a[2],a[6],a[10]),a=new g(a[3],a[7],a[11]);this.eye=new g(-a.dot(b),-a.dot(c),-a.dot(d));b=e[0];c=b+e[2];d=e[1];a=d+e[3];this.ray00=f.unProject(b,
d,1).subtract(this.eye);this.ray10=f.unProject(c,d,1).subtract(this.eye);this.ray01=f.unProject(b,a,1).subtract(this.eye);this.ray11=f.unProject(c,a,1).subtract(this.eye);this.viewport=e}var K,L,r;a.prototype={bind:function(e){f.activeTexture(f.TEXTURE0+(e||0));f.bindTexture(f.TEXTURE_2D,this.id)},unbind:function(e){f.activeTexture(f.TEXTURE0+(e||0));f.bindTexture(f.TEXTURE_2D,null)},drawTo:function(e,a){a=a||{};var b=f.getParameter(f.VIEWPORT);f.viewport(0,0,this.width,this.height);K=K||f.createFramebuffer();
f.bindFramebuffer(f.FRAMEBUFFER,K);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.id,0);if(!1!==a.depth){L=L||f.createRenderbuffer();f.bindRenderbuffer(f.RENDERBUFFER,L);if(this.width!=L.width||this.height!=L.height)L.width=this.width,L.height=this.height,f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_COMPONENT16,this.width,this.height);f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,L)}e();f.bindFramebuffer(f.FRAMEBUFFER,null);f.bindRenderbuffer(f.RENDERBUFFER,
null);f.viewport(b[0],b[1],b[2],b[3])},swapWith:function(e){var a;a=e.id;e.id=this.id;this.id=a;a=e.width;e.width=this.width;this.width=a;a=e.height;e.height=this.height;this.height=a}};a.fromImage=function(e,v){v=v||{};var b=new a(e.width,e.height,v);try{f.texImage2D(f.TEXTURE_2D,0,b.format,b.format,b.type,e)}catch(c){if("file:"==window.location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";
}v.minFilter&&v.minFilter!=f.NEAREST&&v.minFilter!=f.LINEAR&&f.generateMipmap(f.TEXTURE_2D);return b};a.fromURL=function(e,v){r=r||function(){var b=document.createElement("canvas").getContext("2d");b.canvas.width=b.canvas.height=128;for(var e=0;e<b.canvas.height;e+=16)for(var a=0;a<b.canvas.width;a+=16)b.fillStyle=(a^e)&16?"#FFF":"#DDD",b.fillRect(a,e,16,16);return b.canvas}();var b=a.fromImage(r,v),c=new Image,d=f;c.onload=function(){d.makeCurrent();a.fromImage(c,v).swapWith(b)};c.src=e;return b};
c.prototype={add:function(e){var a=JSON.stringify(e);a in this.map||(this.map[a]=this.unique.length,this.unique.push(e));return this.map[a]}};d.prototype={compile:function(e){for(var a=[],b=0;b<this.data.length;b+=1E4)a=Array.prototype.concat.apply(a,this.data.slice(b,b+1E4));b=this.data.length?a.length/this.data.length:0;if(b!=Math.round(b))throw"buffer elements not of consistent size, average size is "+b;this.buffer=this.buffer||f.createBuffer();this.buffer.length=a.length;this.buffer.spacing=b;
f.bindBuffer(this.target,this.buffer);f.bufferData(this.target,new this.type(a),e||f.STATIC_DRAW)}};h.prototype={addVertexBuffer:function(e,a){(this.vertexBuffers[a]=new d(f.ARRAY_BUFFER,Float32Array)).name=e;this[e]=[]},addIndexBuffer:function(e){this.indexBuffers[e]=new d(f.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},compile:function(){for(var e in this.vertexBuffers){var a=this.vertexBuffers[e];a.data=this[a.name];a.compile()}for(var b in this.indexBuffers)a=this.indexBuffers[b],a.data=this[b],
a.compile()},transform:function(e){this.vertices=this.vertices.map(function(b){return e.transformPoint(g.fromArray(b)).toArray()});if(this.normals){var a=e.inverse().transpose();this.normals=this.normals.map(function(b){return a.transformVector(g.fromArray(b)).unit().toArray()})}this.compile();return this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal");for(var e=0;e<this.vertices.length;e++)this.normals[e]=new g;for(e=0;e<this.triangles.length;e++){var a=this.triangles[e],
b=g.fromArray(this.vertices[a[0]]),c=g.fromArray(this.vertices[a[1]]),d=g.fromArray(this.vertices[a[2]]),b=c.subtract(b).cross(d.subtract(b)).unit();this.normals[a[0]]=this.normals[a[0]].add(b);this.normals[a[1]]=this.normals[a[1]].add(b);this.normals[a[2]]=this.normals[a[2]].add(b)}for(e=0;e<this.vertices.length;e++)this.normals[e]=this.normals[e].unit().toArray();this.compile();return this},computeWireframe:function(){for(var e=new c,a=0;a<this.triangles.length;a++)for(var b=this.triangles[a],d=
0;d<b.length;d++){var f=b[d],g=b[(d+1)%b.length];e.add([Math.min(f,g),Math.max(f,g)])}this.lines||this.addIndexBuffer("lines");this.lines=e.unique;this.compile();return this},getAABB:function(){var e={min:new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var a=0;a<this.vertices.length;a++){var b=g.fromArray(this.vertices[a]);e.min=g.min(e.min,b);e.max=g.max(e.max,b)}return e},getBoundingSphere:function(){for(var e=this.getAABB(),e={center:e.min.add(e.max).divide(2),
radius:0},a=0;a<this.vertices.length;a++)e.radius=Math.max(e.radius,g.fromArray(this.vertices[a]).subtract(e.center).length());return e}};h.plane=function(e){e=e||{};var a=new h(e),b=e.detailX||e.detail||1;e=e.detailY||e.detail||1;for(var c=0;c<=e;c++)for(var d=c/e,f=0;f<=b;f++){var g=f/b;a.vertices.push([2*g-1,2*d-1,0]);a.coords&&a.coords.push([g,d]);a.normals&&a.normals.push([0,0,1]);f<b&&c<e&&(g=f+c*(b+1),a.triangles.push([g,g+1,g+b+1]),a.triangles.push([g+b+1,g+1,g+b+2]))}a.compile();return a};
var A=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];h.cube=function(e){e=new h(e);for(var a=0;a<A.length;a++){for(var b=A[a],c=4*a,d=0;4>d;d++)e.vertices.push(k(b[d]).toArray()),e.coords&&e.coords.push([d&1,(d&2)/2]),e.normals&&e.normals.push(b.slice(4,7));e.triangles.push([c,c+1,c+2]);e.triangles.push([c+2,c+1,c+3])}e.compile();return e};h.sphere=function(e){function a(b,e,c){return p?[b,c,e]:[b,e,c]}e=e||{};var b=new h(e),d=new c;e=e.detail||
6;for(var f=0;8>f;f++)for(var m=k(f),p=0<m.x*m.y*m.z,n=[],l=0;l<=e;l++){for(var r=0;l+r<=e;r++){var q=l/e,u=r/e,N=(e-l-r)/e,u={vertex:(new g(q+(q-q*q)/2,u+(u-u*u)/2,N+(N-N*N)/2)).unit().multiply(m).toArray()};b.coords&&(u.coord=0<m.y?[1-q,N]:[N,1-q]);n.push(d.add(u))}if(0<l)for(r=0;l+r<=e;r++)q=(l-1)*(e+1)+(l-1-(l-1)*(l-1))/2+r,u=l*(e+1)+(l-l*l)/2+r,b.triangles.push(a(n[q],n[q+1],n[u])),l+r<e&&b.triangles.push(a(n[u],n[q+1],n[u+1]))}b.vertices=d.unique.map(function(b){return b.vertex});b.coords&&
(b.coords=d.unique.map(function(b){return b.coord}));b.normals&&(b.normals=b.vertices);b.compile();return b};h.load=function(e,a){a=a||{};"coords"in a||(a.coords=!!e.coords);"normals"in a||(a.normals=!!e.normals);"colors"in a||(a.colors=!!e.colors);"triangles"in a||(a.triangles=!!e.triangles);"lines"in a||(a.lines=!!e.lines);var b=new h(a);b.vertices=e.vertices;b.coords&&(b.coords=e.coords);b.normals&&(b.normals=e.normals);b.colors&&(b.colors=e.colors);b.triangles&&(b.triangles=e.triangles);b.lines&&
(b.lines=e.lines);b.compile();return b};g.prototype={negative:function(){return new g(-this.x,-this.y,-this.z)},add:function(e){return e instanceof g?new g(this.x+e.x,this.y+e.y,this.z+e.z):new g(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof g?new g(this.x-e.x,this.y-e.y,this.z-e.z):new g(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof g?new g(this.x*e.x,this.y*e.y,this.z*e.z):new g(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof g?
new g(this.x/e.x,this.y/e.y,this.z/e.z):new g(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new g(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,
this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new g(this.x,this.y,this.z)},init:function(e,a,b){this.x=e;this.y=a;this.z=b;return this}};g.negative=function(e,a){a.x=-e.x;a.y=-e.y;a.z=-e.z;return a};g.add=function(e,a,b){a instanceof g?(b.x=e.x+a.x,b.y=e.y+a.y,b.z=e.z+a.z):(b.x=e.x+a,b.y=e.y+a,b.z=e.z+a);return b};g.subtract=function(a,c,b){c instanceof
g?(b.x=a.x-c.x,b.y=a.y-c.y,b.z=a.z-c.z):(b.x=a.x-c,b.y=a.y-c,b.z=a.z-c);return b};g.multiply=function(a,c,b){c instanceof g?(b.x=a.x*c.x,b.y=a.y*c.y,b.z=a.z*c.z):(b.x=a.x*c,b.y=a.y*c,b.z=a.z*c);return b};g.divide=function(a,c,b){c instanceof g?(b.x=a.x/c.x,b.y=a.y/c.y,b.z=a.z/c.z):(b.x=a.x/c,b.y=a.y/c,b.z=a.z/c);return b};g.cross=function(a,c,b){b.x=a.y*c.z-a.z*c.y;b.y=a.z*c.x-a.x*c.z;b.z=a.x*c.y-a.y*c.x;return b};g.unit=function(a,c){var b=a.length();c.x=a.x/b;c.y=a.y/b;c.z=a.z/b;return c};g.fromAngles=
function(a,c){return new g(Math.cos(a)*Math.cos(c),Math.sin(c),Math.sin(a)*Math.cos(c))};g.randomDirection=function(){return g.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))};g.min=function(a,c){return new g(Math.min(a.x,c.x),Math.min(a.y,c.y),Math.min(a.z,c.z))};g.max=function(a,c){return new g(Math.max(a.x,c.x),Math.max(a.y,c.y),Math.max(a.z,c.z))};g.lerp=function(a,c,b){return c.subtract(a).multiply(b).add(a)};g.fromArray=function(a){return new g(a[0],a[1],a[2])};m.prototype=
{uniforms:function(a){f.useProgram(this.program);for(var c in a){var b=this.uniformLocations[c]||f.getUniformLocation(this.program,c);if(b){this.uniformLocations[c]=b;var d=a[c];d instanceof g?d=[d.x,d.y,d.z]:d instanceof n&&(d=d.m);var h=Object.prototype.toString.call(d);if("[object Array]"==h||"[object Float32Array]"==h)switch(d.length){case 1:f.uniform1fv(b,new Float32Array(d));break;case 2:f.uniform2fv(b,new Float32Array(d));break;case 3:f.uniform3fv(b,new Float32Array(d));break;case 4:f.uniform4fv(b,
new Float32Array(d));break;case 9:f.uniformMatrix3fv(b,!1,new Float32Array([d[0],d[3],d[6],d[1],d[4],d[7],d[2],d[5],d[8]]));break;case 16:f.uniformMatrix4fv(b,!1,new Float32Array([d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14],d[3],d[7],d[11],d[15]]));break;default:throw"don't know how to load uniform \""+c+'" of length '+d.length;}else if(h=Object.prototype.toString.call(d),"[object Number]"==h||"[object Boolean]"==h)(this.isSampler[c]?f.uniform1i:f.uniform1f).call(f,b,d);else throw'attempted to set uniform "'+
c+'" to invalid value '+d;}}return this},draw:function(a,c){this.drawBuffers(a.vertexBuffers,a.indexBuffers[c==f.LINES?"lines":"triangles"],2>arguments.length?f.TRIANGLES:c)},drawBuffers:function(a,c,b){var d=this.usedMatrices,g=f.modelviewMatrix,h=f.projectionMatrix,k=d.MVMI||d.NM?g.inverse():null,m=d.PMI?h.inverse():null,p=d.MVPM||d.MVPMI?h.multiply(g):null,n={};d.MVM&&(n[d.MVM]=g);d.MVMI&&(n[d.MVMI]=k);d.PM&&(n[d.PM]=h);d.PMI&&(n[d.PMI]=m);d.MVPM&&(n[d.MVPM]=p);d.MVPMI&&(n[d.MVPMI]=p.inverse());
d.NM&&(g=k.m,n[d.NM]=[g[0],g[4],g[8],g[1],g[5],g[9],g[2],g[6],g[10]]);this.uniforms(n);var d=0,l;for(l in a)n=a[l],g=this.attributes[l]||f.getAttribLocation(this.program,l.replace(/^(gl_.*)$/,"LIGHTGL$1")),-1!=g&&n.buffer&&(this.attributes[l]=g,f.bindBuffer(f.ARRAY_BUFFER,n.buffer),f.enableVertexAttribArray(g),f.vertexAttribPointer(g,n.buffer.spacing,f.FLOAT,!1,0,0),d=n.buffer.length/n.buffer.spacing);for(l in this.attributes)l in a||f.disableVertexAttribArray(this.attributes[l]);!d||c&&!c.buffer||
(c?(f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.buffer),f.drawElements(b,c.buffer.length,f.UNSIGNED_SHORT,0)):f.drawArrays(b,0,d));return this}};m.fromURL=function(a,c){var b=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);if(200!==b.status)throw"could not load "+a;return b.responseText},d=b(a),b=b(c);return new m(d,b)};m.from=function(a,c){try{return new m(a,c)}catch(b){return m.fromURL(a,c)}};var f,z={create:function(a){a=a||{};var c=a.canvas;c||(c=document.createElement("canvas"),
c.width=a.width||800,c.height=a.height||600);"alpha"in a||(a.alpha=!1);try{f=c.getContext("webgl",a)}catch(b){}try{f=f||c.getContext("experimental-webgl",a)}catch(b){}if(!f)throw"WebGL not supported";w();l();t();x();return f},keys:{},Matrix:n,Indexer:c,Buffer:d,Mesh:h,HitTest:y,Raytracer:G,Shader:m,Texture:a,Vector:g};u(document,"keydown",function(a){if(!a.altKey&&!a.ctrlKey&&!a.metaKey){var c=q(a.keyCode);c&&(z.keys[c]=!0);z.keys[a.keyCode]=!0}});u(document,"keyup",function(a){if(!a.altKey&&!a.ctrlKey&&
!a.metaKey){var c=q(a.keyCode);c&&(z.keys[c]=!1);z.keys[a.keyCode]=!1}});var Q=305397760,H="undefined"!=typeof Float32Array;n.prototype={inverse:function(){return n.inverse(this,new n)},transpose:function(){return n.transpose(this,new n)},multiply:function(a){return n.multiply(this,a,new n)},transformPoint:function(a){var c=this.m;return(new g(c[0]*a.x+c[1]*a.y+c[2]*a.z+c[3],c[4]*a.x+c[5]*a.y+c[6]*a.z+c[7],c[8]*a.x+c[9]*a.y+c[10]*a.z+c[11])).divide(c[12]*a.x+c[13]*a.y+c[14]*a.z+c[15])},transformVector:function(a){var c=
this.m;return new g(c[0]*a.x+c[1]*a.y+c[2]*a.z,c[4]*a.x+c[5]*a.y+c[6]*a.z,c[8]*a.x+c[9]*a.y+c[10]*a.z)}};n.inverse=function(a,c){c=c||new n;var b=a.m,d=c.m;d[0]=b[5]*b[10]*b[15]-b[5]*b[14]*b[11]-b[6]*b[9]*b[15]+b[6]*b[13]*b[11]+b[7]*b[9]*b[14]-b[7]*b[13]*b[10];d[1]=-b[1]*b[10]*b[15]+b[1]*b[14]*b[11]+b[2]*b[9]*b[15]-b[2]*b[13]*b[11]-b[3]*b[9]*b[14]+b[3]*b[13]*b[10];d[2]=b[1]*b[6]*b[15]-b[1]*b[14]*b[7]-b[2]*b[5]*b[15]+b[2]*b[13]*b[7]+b[3]*b[5]*b[14]-b[3]*b[13]*b[6];d[3]=-b[1]*b[6]*b[11]+b[1]*b[10]*
b[7]+b[2]*b[5]*b[11]-b[2]*b[9]*b[7]-b[3]*b[5]*b[10]+b[3]*b[9]*b[6];d[4]=-b[4]*b[10]*b[15]+b[4]*b[14]*b[11]+b[6]*b[8]*b[15]-b[6]*b[12]*b[11]-b[7]*b[8]*b[14]+b[7]*b[12]*b[10];d[5]=b[0]*b[10]*b[15]-b[0]*b[14]*b[11]-b[2]*b[8]*b[15]+b[2]*b[12]*b[11]+b[3]*b[8]*b[14]-b[3]*b[12]*b[10];d[6]=-b[0]*b[6]*b[15]+b[0]*b[14]*b[7]+b[2]*b[4]*b[15]-b[2]*b[12]*b[7]-b[3]*b[4]*b[14]+b[3]*b[12]*b[6];d[7]=b[0]*b[6]*b[11]-b[0]*b[10]*b[7]-b[2]*b[4]*b[11]+b[2]*b[8]*b[7]+b[3]*b[4]*b[10]-b[3]*b[8]*b[6];d[8]=b[4]*b[9]*b[15]-b[4]*
b[13]*b[11]-b[5]*b[8]*b[15]+b[5]*b[12]*b[11]+b[7]*b[8]*b[13]-b[7]*b[12]*b[9];d[9]=-b[0]*b[9]*b[15]+b[0]*b[13]*b[11]+b[1]*b[8]*b[15]-b[1]*b[12]*b[11]-b[3]*b[8]*b[13]+b[3]*b[12]*b[9];d[10]=b[0]*b[5]*b[15]-b[0]*b[13]*b[7]-b[1]*b[4]*b[15]+b[1]*b[12]*b[7]+b[3]*b[4]*b[13]-b[3]*b[12]*b[5];d[11]=-b[0]*b[5]*b[11]+b[0]*b[9]*b[7]+b[1]*b[4]*b[11]-b[1]*b[8]*b[7]-b[3]*b[4]*b[9]+b[3]*b[8]*b[5];d[12]=-b[4]*b[9]*b[14]+b[4]*b[13]*b[10]+b[5]*b[8]*b[14]-b[5]*b[12]*b[10]-b[6]*b[8]*b[13]+b[6]*b[12]*b[9];d[13]=b[0]*b[9]*
b[14]-b[0]*b[13]*b[10]-b[1]*b[8]*b[14]+b[1]*b[12]*b[10]+b[2]*b[8]*b[13]-b[2]*b[12]*b[9];d[14]=-b[0]*b[5]*b[14]+b[0]*b[13]*b[6]+b[1]*b[4]*b[14]-b[1]*b[12]*b[6]-b[2]*b[4]*b[13]+b[2]*b[12]*b[5];d[15]=b[0]*b[5]*b[10]-b[0]*b[9]*b[6]-b[1]*b[4]*b[10]+b[1]*b[8]*b[6]+b[2]*b[4]*b[9]-b[2]*b[8]*b[5];for(var b=b[0]*d[0]+b[1]*d[4]+b[2]*d[8]+b[3]*d[12],f=0;16>f;f++)d[f]/=b;return c};n.transpose=function(a,c){c=c||new n;var b=a.m,d=c.m;d[0]=b[0];d[1]=b[4];d[2]=b[8];d[3]=b[12];d[4]=b[1];d[5]=b[5];d[6]=b[9];d[7]=b[13];
d[8]=b[2];d[9]=b[6];d[10]=b[10];d[11]=b[14];d[12]=b[3];d[13]=b[7];d[14]=b[11];d[15]=b[15];return c};n.multiply=function(a,c,b){b=b||new n;a=a.m;c=c.m;var d=b.m;d[0]=a[0]*c[0]+a[1]*c[4]+a[2]*c[8]+a[3]*c[12];d[1]=a[0]*c[1]+a[1]*c[5]+a[2]*c[9]+a[3]*c[13];d[2]=a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+a[3]*c[14];d[3]=a[0]*c[3]+a[1]*c[7]+a[2]*c[11]+a[3]*c[15];d[4]=a[4]*c[0]+a[5]*c[4]+a[6]*c[8]+a[7]*c[12];d[5]=a[4]*c[1]+a[5]*c[5]+a[6]*c[9]+a[7]*c[13];d[6]=a[4]*c[2]+a[5]*c[6]+a[6]*c[10]+a[7]*c[14];d[7]=a[4]*c[3]+a[5]*
c[7]+a[6]*c[11]+a[7]*c[15];d[8]=a[8]*c[0]+a[9]*c[4]+a[10]*c[8]+a[11]*c[12];d[9]=a[8]*c[1]+a[9]*c[5]+a[10]*c[9]+a[11]*c[13];d[10]=a[8]*c[2]+a[9]*c[6]+a[10]*c[10]+a[11]*c[14];d[11]=a[8]*c[3]+a[9]*c[7]+a[10]*c[11]+a[11]*c[15];d[12]=a[12]*c[0]+a[13]*c[4]+a[14]*c[8]+a[15]*c[12];d[13]=a[12]*c[1]+a[13]*c[5]+a[14]*c[9]+a[15]*c[13];d[14]=a[12]*c[2]+a[13]*c[6]+a[14]*c[10]+a[15]*c[14];d[15]=a[12]*c[3]+a[13]*c[7]+a[14]*c[11]+a[15]*c[15];return b};n.identity=function(a){a=a||new n;var c=a.m;c[0]=c[5]=c[10]=c[15]=
1;c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=c[14]=0;return a};n.perspective=function(a,c,b,d,f){a=Math.tan(a*Math.PI/360)*b;c*=a;return n.frustum(-c,c,-a,a,b,d,f)};n.frustum=function(a,c,b,d,f,g,h){h=h||new n;var k=h.m;k[0]=2*f/(c-a);k[1]=0;k[2]=(c+a)/(c-a);k[3]=0;k[4]=0;k[5]=2*f/(d-b);k[6]=(d+b)/(d-b);k[7]=0;k[8]=0;k[9]=0;k[10]=-(g+f)/(g-f);k[11]=-2*g*f/(g-f);k[12]=0;k[13]=0;k[14]=-1;k[15]=0;return h};n.ortho=function(a,c,b,d,f,g,h){h=h||new n;var k=h.m;k[0]=2/(c-a);k[1]=0;k[2]=0;
k[3]=-(c+a)/(c-a);k[4]=0;k[5]=2/(d-b);k[6]=0;k[7]=-(d+b)/(d-b);k[8]=0;k[9]=0;k[10]=-2/(g-f);k[11]=-(g+f)/(g-f);k[12]=0;k[13]=0;k[14]=0;k[15]=1;return h};n.scale=function(a,c,b,d){d=d||new n;var f=d.m;f[0]=a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=c;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=b;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return d};n.translate=function(a,c,b,d){d=d||new n;var f=d.m;f[0]=1;f[1]=0;f[2]=0;f[3]=a;f[4]=0;f[5]=1;f[6]=0;f[7]=c;f[8]=0;f[9]=0;f[10]=1;f[11]=b;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return d};
n.rotate=function(a,c,b,d,f){if(!a||!c&&!b&&!d)return n.identity(f);f=f||new n;var g=f.m,h=Math.sqrt(c*c+b*b+d*d);a*=Math.PI/180;c/=h;b/=h;d/=h;h=Math.cos(a);a=Math.sin(a);var k=1-h;g[0]=c*c*k+h;g[1]=c*b*k-d*a;g[2]=c*d*k+b*a;g[3]=0;g[4]=b*c*k+d*a;g[5]=b*b*k+h;g[6]=b*d*k-c*a;g[7]=0;g[8]=d*c*k-b*a;g[9]=d*b*k+c*a;g[10]=d*d*k+h;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return f};n.lookAt=function(a,c,b,d,f,h,k,m,p,l){l=l||new n;var r=l.m;a=new g(a,c,b);d=new g(d,f,h);m=new g(k,m,p);k=a.subtract(d).unit();
m=m.cross(k).unit();p=k.cross(m).unit();r[0]=m.x;r[1]=m.y;r[2]=m.z;r[3]=-m.dot(a);r[4]=p.x;r[5]=p.y;r[6]=p.z;r[7]=-p.dot(a);r[8]=k.x;r[9]=k.y;r[10]=k.z;r[11]=-k.dot(a);r[12]=0;r[13]=0;r[14]=0;r[15]=1;return l};y.prototype={mergeWith:function(a){0<a.t&&a.t<this.t&&(this.t=a.t,this.hit=a.hit,this.normal=a.normal)}};G.prototype={getRayForPixel:function(a,c){a=(a-this.viewport[0])/this.viewport[2];c=1-(c-this.viewport[1])/this.viewport[3];var b=g.lerp(this.ray00,this.ray10,a),d=g.lerp(this.ray01,this.ray11,
a);return g.lerp(b,d,c).unit()}};G.hitTestBox=function(a,c,b,d){var f=b.subtract(a).divide(c),h=d.subtract(a).divide(c),k=g.min(f,h),f=g.max(f,h),k=k.max(),f=f.min();return 0<k&&k<f?(a=a.add(c.multiply(k)),b=b.add(1E-6),d=d.subtract(1E-6),new y(k,a,new g((a.x>d.x)-(a.x<b.x),(a.y>d.y)-(a.y<b.y),(a.z>d.z)-(a.z<b.z)))):null};G.hitTestSphere=function(a,c,b,d){var f=a.subtract(b),g=c.dot(c),h=2*c.dot(f),f=f.dot(f)-d*d,f=h*h-4*g*f;return 0<f?(g=(-h-Math.sqrt(f))/(2*g),a=a.add(c.multiply(g)),new y(g,a,a.subtract(b).divide(d))):
null};G.hitTestTriangle=function(a,c,b,d,f){var g=d.subtract(b),h=f.subtract(b);f=g.cross(h).unit();d=f.dot(b.subtract(a))/f.dot(c);if(0<d){a=a.add(c.multiply(d));var k=a.subtract(b);b=h.dot(h);c=h.dot(g);var h=h.dot(k),m=g.dot(g),g=g.dot(k),k=b*m-c*c,m=(m*h-c*g)/k,g=(b*g-c*h)/k;if(0<=m&&0<=g&&1>=m+g)return new y(d,a,f)}return null};return z}();Blockscad=Blockscad||{};Blockscad.Toolbox={};Blockly=Blockly||{};Blockscad.Toolbox.catIDs=[];Blockscad.Toolbox.allcats="HEX_3D_PRIMITIVE HEX_2D_PRIMITIVE HEX_TRANSFORM HEX_SETOP HEX_MATH HEX_LOGIC HEX_LOOP HEX_ADVANCED HEX_VARIABLE HEX_PROCEDURE".split(" ");Blockscad.Toolbox.whichCatsInSimple=[0,2,3,4,5,6,7];Blockscad.Toolbox.colorScheme={};Blockscad.Toolbox.colorScheme.one="#006205 #209303 #26549E #7450E2 #0186E2 #BF6920 #612485 #727272 #8C7149 #900355".split(" ");
Blockscad.Toolbox.colorScheme.two="#885ee3 #82af5a #23901c #377eb8 #ba9969 #afaf13 #a66658 #d761bf #999999 #900355".split(" ");Blockscad.Toolbox.catHex=[];Blockscad.Toolbox.simpCatHex=[];Blockscad.Toolbox.setColorScheme=function(a){for(var c=0;c<Blockscad.Toolbox.allcats.length;c++)Blockscad.Toolbox[Blockscad.Toolbox.allcats[c]]=a[c],Blockscad.Toolbox.catHex[c]=a[c];console.log(Blockscad.Toolbox)};
Blockscad.Toolbox.setCatColors=function(){if(Blockscad.Toolbox.catIDs.length<Blockscad.Toolbox.allcats.length)for(var a=0;a<Blockscad.Toolbox.catIDs.length;a++){var c=document.getElementById(Blockscad.Toolbox.catIDs[a]);c.style.background=Blockscad.Toolbox.catHex[Blockscad.Toolbox.whichCatsInSimple[a]]}else for(a=0;a<Blockscad.Toolbox.catIDs.length;a++)c=document.getElementById(Blockscad.Toolbox.catIDs[a]),c.style.background=Blockscad.Toolbox.catHex[a]};Blockscad.Toolbox.cat_3D='<category name="3D Shapes"><block type="sphere"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="simple_cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cube"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';
Blockscad.Toolbox.cat2D='<category name="2D Shapes"><block type="circle"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="square"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';Blockscad.Toolbox.catTransform='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="simplemirror_new"></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block><block type="linearextrude"><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value><value name="TWIST"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="rotateextrude"><value name="FACES"><block type="math_number"><field name="NUM">5</field></block></value></block></category>';
Blockscad.Toolbox.catTransform_sim='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block></category>';
Blockscad.Toolbox.catSetOps='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block><block type="hull"></block></category>';Blockscad.Toolbox.catSetOps_sim='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block></category>';Blockscad.Toolbox.catMathLogic='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_trig"></block><block type="math_constant_bs"></block><block type="math_number_property"></block><block type="math_round"></block><block type="math_modulo"></block><block type="math_constrain"><value name="LOW"><block type="math_number"><field name="NUM">1</field></block></value><value name="HIGH"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_int"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_float"></block></category><category name="Logic"><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_ternary"></block></category>';
Blockscad.Toolbox.catMathLogic_sim='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block></category>';Blockscad.Toolbox.catLoops='<category name="Loops"><block type="controls_for"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block> </value><value name="TO"><block type="math_number"><field name="NUM">10</field></block></value><value name="BY"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="controls_for_chainhull"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block> </value><value name="TO"><block type="math_number"><field name="NUM">10</field></block></value><value name="BY"><block type="math_number"><field name="NUM">1</field></block></value></block></category>';
Blockscad.Toolbox.catOther='<category name="Advanced"><block type="torus"><value name="RAD1"><block type="math_number"><field name="NUM">4</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">1</field></block></value><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value><value name="FACES"><block type="math_number"><field name="NUM">3</field></block></value></block><block type="bs_text"><value name="SIZE"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="rotateextrudetwist"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value><value name="FACES"><block type="math_number"><field name="NUM">5</field></block></value><value name="TWIST"><block type="math_number"><field name="NUM">360</field></block></value><value name="TSTEPS"><block type="math_number"><field name="NUM">180</field></block></value></block><block type="fancyrotate"><value name="AVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="fancymirror"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="stl_import"></block></category><category name="Variables" custom="VARIABLE"></category><category name="Modules" custom="PROCEDURE"></category></xml>';
Blockscad.Toolbox.adv='<xml id="toolbox" style="display: none">';Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat_3D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat2D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catTransform;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catSetOps;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catMathLogic;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catLoops;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catOther;Blockscad.Toolbox.sim='<xml id="toolbox" style="display: none">';
Blockscad.Toolbox.sim+=Blockscad.Toolbox.cat_3D;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catTransform_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catSetOps_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catMathLogic_sim;(function(a){var c,d,h=null,k,g,p,m,w,l,t,q,u,x,n,y,G,K,L,r=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],e=function(){this.list=this.next=null},v=function(){this.n=this.b=this.e=0;this.t=null},b=function(a,b,c,d,f,g){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var h=Array(this.BMAX+1),k,m,p,n,l,r,q,u=Array(this.BMAX+1),A,w,t,x=new v,z=Array(this.BMAX);n=Array(this.N_MAX);var y,B=Array(this.BMAX+1),C,D,G;G=this.root=null;for(l=0;l<h.length;l++)h[l]=0;for(l=0;l<u.length;l++)u[l]=0;for(l=0;l<z.length;l++)z[l]=null;for(l=0;l<n.length;l++)n[l]=0;for(l=0;l<
B.length;l++)B[l]=0;k=256<b?a[256]:this.BMAX;A=a;w=0;l=b;do h[A[w]]++,w++;while(0<--l);if(h[0]==b)this.root=null,this.status=this.m=0;else{for(r=1;r<=this.BMAX&&0==h[r];r++);q=r;g<r&&(g=r);for(l=this.BMAX;0!=l&&0==h[l];l--);p=l;g>l&&(g=l);for(C=1<<r;r<l;r++,C<<=1)if(0>(C-=h[r])){this.status=2;this.m=g;return}if(0>(C-=h[l]))this.status=2,this.m=g;else{h[l]+=C;B[1]=r=0;A=h;w=1;for(t=2;0<--l;)B[t++]=r+=A[w++];A=a;l=w=0;do 0!=(r=A[w++])&&(n[B[r]++]=l);while(++l<b);b=B[p];B[0]=l=0;A=n;w=0;n=-1;y=u[0]=
0;t=null;for(D=0;q<=p;q++)for(a=h[q];0<a--;){for(;q>y+u[1+n];){y+=u[1+n];n++;D=(D=p-y)>g?g:D;if((m=1<<(r=q-y))>a+1)for(m-=a+1,t=q;++r<D&&!((m<<=1)<=h[++t]);)m-=h[t];y+r>k&&y<k&&(r=k-y);D=1<<r;u[1+n]=r;t=Array(D);for(m=0;m<D;m++)t[m]=new v;G=null==G?this.root=new e:G.next=new e;G.next=null;G.list=t;z[n]=t;0<n&&(B[n]=l,x.b=u[n],x.e=16+r,x.t=t,r=(l&(1<<y)-1)>>y-u[n],z[n-1][r].e=x.e,z[n-1][r].b=x.b,z[n-1][r].n=x.n,z[n-1][r].t=x.t)}x.b=q-y;w>=b?x.e=99:A[w]<c?(x.e=256>A[w]?16:15,x.n=A[w++]):(x.e=f[A[w]-
c],x.n=d[A[w++]-c]);m=1<<q-y;for(r=l>>y;r<D;r+=m)t[r].e=x.e,t[r].b=x.b,t[r].n=x.n,t[r].t=x.t;for(r=1<<q-1;0!=(l&r);r>>=1)l^=r;for(l^=r;(l&(1<<y)-1)!=B[n];)y-=u[n],n--}this.m=u[1];this.status=0!=C&&1!=p?1:0}}},B=function(a){for(;w<a;){var b=m,c;c=K.length==L?-1:K.charCodeAt(L++)&255;m=b|c<<w;w+=8}},D=function(a){return m&r[a]},C=function(a){m>>=a;w-=a},O=function(a,b,e){var f,g,h;if(0==e)return 0;for(h=0;;){B(y);g=x.list[D(y)];for(f=g.e;16<f;){if(99==f)return-1;C(g.b);f-=16;B(f);g=g.t[D(f)];f=g.e}C(g.b);
if(16==f)d&=32767,a[b+h++]=c[d++]=g.n;else{if(15==f)break;B(f);q=g.n+D(f);C(f);B(G);g=n.list[D(G)];for(f=g.e;16<f;){if(99==f)return-1;C(g.b);f-=16;B(f);g=g.t[D(f)];f=g.e}C(g.b);B(f);u=d-g.n-D(f);for(C(f);0<q&&h<e;)q--,u&=32767,d&=32767,a[b+h++]=c[d++]=c[u++]}if(h==e)return e}l=-1;return h},R=function(a,c,d){var e,g,h,k,l,m,r,p=Array(316);for(e=0;e<p.length;e++)p[e]=0;B(5);m=257+D(5);C(5);B(5);r=1+D(5);C(5);B(4);e=4+D(4);C(4);if(286<m||30<r)return-1;for(g=0;g<e;g++)B(3),p[H[g]]=D(3),C(3);for(;19>g;g++)p[H[g]]=
0;y=7;g=new b(p,19,19,null,null,y);if(0!=g.status)return-1;x=g.root;y=g.m;k=m+r;for(e=h=0;e<k;)if(B(y),l=x.list[D(y)],g=l.b,C(g),g=l.n,16>g)p[e++]=h=g;else if(16==g){B(2);g=3+D(2);C(2);if(e+g>k)return-1;for(;0<g--;)p[e++]=h}else{17==g?(B(3),g=3+D(3),C(3)):(B(7),g=11+D(7),C(7));if(e+g>k)return-1;for(;0<g--;)p[e++]=0;h=0}y=9;g=new b(p,m,257,A,f,y);0==y&&(g.status=1);if(0!=g.status&&1==g.status)return-1;x=g.root;y=g.m;for(e=0;e<r;e++)p[e]=p[e+m];G=6;g=new b(p,r,0,z,Q,G);n=g.root;G=g.m;return 0==G&&257<
m||0!=g.status?-1:O(a,c,d)},V=function(a,e,r){var v,F;for(v=0;v<r&&(!t||-1!=l);){if(0<q){if(0!=l)for(;0<q&&v<r;)q--,u&=32767,d&=32767,a[e+v++]=c[d++]=c[u++];else{for(;0<q&&v<r;)q--,d&=32767,B(8),a[e+v++]=c[d++]=D(8),C(8);0==q&&(l=-1)}if(v==r)break}if(-1==l){if(t)break;B(1);0!=D(1)&&(t=!0);C(1);B(2);l=D(2);C(2);x=null;q=0}switch(l){case 0:F=a;var I=e+v,H=r-v,J=void 0,J=w&7;C(J);B(16);J=D(16);C(16);B(16);if(J!=(~m&65535))F=-1;else{C(16);q=J;for(J=0;0<q&&J<H;)q--,d&=32767,B(8),F[I+J++]=c[d++]=D(8),C(8);
0==q&&(l=-1);F=J}break;case 1:if(null!=x)F=O(a,e+v,r-v);else a:{F=a;I=e+v;H=r-v;if(null==h){for(var E=void 0,J=Array(288),E=void 0,E=0;144>E;E++)J[E]=8;for(;256>E;E++)J[E]=9;for(;280>E;E++)J[E]=7;for(;288>E;E++)J[E]=8;g=7;E=new b(J,288,257,A,f,g);if(0!=E.status){alert("HufBuild error: "+E.status);F=-1;break a}h=E.root;g=E.m;for(E=0;30>E;E++)J[E]=5;p=5;E=new b(J,30,0,z,Q,p);if(1<E.status){h=null;alert("HufBuild error: "+E.status);F=-1;break a}k=E.root;p=E.m}x=h;n=k;y=g;G=p;F=O(F,I,H)}break;case 2:F=
null!=x?O(a,e+v,r-v):R(a,e+v,r-v);break;default:F=-1}if(-1==F)return t?0:-1;v+=F}return v};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.inflate=function(a){var b;null==c&&(c=Array(65536));w=m=d=0;l=-1;t=!1;q=u=0;x=null;K=a;L=0;for(var e=Array(1024),f=[];0<(a=V(e,0,e.length));){var g=Array(a);for(b=0;b<a;b++)g[b]=String.fromCharCode(e[b]);f[f.length]=g.join("")}K=null;return f.join("")}})(this);
(function(a){var c,d,h,k,g=null,p,m,w,l,t,q,u,x,n,y,G,K,L,r,A,f,z,Q,H,e,v,b,B,D,C,O,R,V,M,S,T,N,F,I,W,J,E,da,aa,qa,ia,ja,X,ka,ra,ba,ea,Y,ca,la,sa,fa=function(){this.dl=this.fc=0},ta=function(){this.extra_bits=this.static_tree=this.dyn_tree=null;this.max_code=this.max_length=this.elems=this.extra_base=0},U=function(a,b,c,d){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d},La=function(){this.next=null;this.len=0;this.ptr=Array(8192);this.off=0},ua=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,
2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ga=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ma=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],za=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],va=[new U(0,0,0,0),new U(4,4,8,4),new U(4,5,16,8),new U(4,6,32,32),new U(4,4,16,16),new U(8,16,32,32),new U(8,16,128,128),new U(8,32,128,256),new U(32,128,258,1024),new U(32,258,258,4096)],ma=function(a){g[m+p++]=a;if(8192==m+p&&0!=p){var b;null!=c?(a=c,c=c.next):a=new La;a.next=null;a.len=a.off=0;null==
d?d=h=a:h=h.next=a;a.len=p-m;for(b=0;b<a.len;b++)a.ptr[b]=g[m+b];p=m=0}},na=function(a){a&=65535;8190>m+p?(g[m+p++]=a&255,g[m+p++]=a>>>8):(ma(a&255),ma(a>>>8))},oa=function(){G=(G<<5^l[z+3-1]&255)&8191;K=u[32768+G];u[z&32767]=K;u[32768+G]=z},Z=function(a,b){P(b[a].fc,b[a].dl)},Aa=function(a,b,c){return a[b].fc<a[c].fc||a[b].fc==a[c].fc&&E[b]<=E[c]},Ba=function(a,b,c){var d;for(d=0;d<c&&sa<la.length;d++)a[b+d]=la.charCodeAt(sa++)&255;return d},Ca=function(a){var b=v,c=z,d,e=f,g=32506<z?z-32506:0,h=
z+258,k=l[c+e-1],r=l[c+e];f>=D&&(b>>=2);do if(d=a,l[d+e]==r&&l[d+e-1]==k&&l[d]==l[c]&&l[++d]==l[c+1]){c+=2;for(d++;l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&l[++c]==l[++d]&&c<h;);d=258-(h-c);c=h-258;if(d>e){Q=a;e=d;if(258<=d)break;k=l[c+e-1];r=l[c+e]}}while((a=u[a&32767])>g&&0!=--b);return e},wa=function(){var a,b,c=65536-e-z;if(-1==c)c--;else if(65274<=z){for(a=0;32768>a;a++)l[a]=l[a+32768];Q-=32768;z-=32768;y-=32768;for(a=0;8192>
a;a++)b=u[32768+a],u[32768+a]=32768<=b?b-32768:0;for(a=0;32768>a;a++)b=u[a],u[a]=32768<=b?b-32768:0;c+=32768}H||(a=Ba(l,z+e,c),0>=a?H=!0:e+=a)},Na=function(a,c,g){var h;if(!k){if(!H){n=x=0;var q,t;if(0==V[0].dl){S.dyn_tree=C;S.static_tree=R;S.extra_bits=ua;S.extra_base=257;S.elems=286;S.max_length=15;S.max_code=0;T.dyn_tree=O;T.static_tree=V;T.extra_bits=ga;T.extra_base=0;T.elems=30;T.max_length=15;T.max_code=0;N.dyn_tree=M;N.static_tree=null;N.extra_bits=Ma;N.extra_base=0;N.elems=19;N.max_length=
7;for(t=q=N.max_code=0;28>t;t++)for(qa[t]=q,h=0;h<1<<ua[t];h++)da[q++]=t;da[q-1]=t;for(t=q=0;16>t;t++)for(ia[t]=q,h=0;h<1<<ga[t];h++)aa[q++]=t;for(q>>=7;30>t;t++)for(ia[t]=q<<7,h=0;h<1<<ga[t]-7;h++)aa[256+q++]=t;for(h=0;15>=h;h++)F[h]=0;for(h=0;143>=h;)R[h++].dl=8,F[8]++;for(;255>=h;)R[h++].dl=9,F[9]++;for(;279>=h;)R[h++].dl=7,F[7]++;for(;287>=h;)R[h++].dl=8,F[8]++;Da(R,287);for(h=0;30>h;h++)V[h].dl=5,V[h].fc=Ea(h,5);Fa()}for(h=0;8192>h;h++)u[32768+h]=0;b=va[B].max_lazy;D=va[B].good_length;v=va[B].max_chain;
y=z=0;e=Ba(l,0,65536);if(0>=e)H=!0,e=0;else{for(H=!1;262>e&&!H;)wa();for(h=G=0;2>h;h++)G=(G<<5^l[h]&255)&8191}d=null;r=m=p=0;3>=B?(f=2,A=0):(A=2,r=r=0);w=!1}k=!0;if(0==e)return w=!0,0}if((h=Ga(a,c,g))==g)return g;if(w)return h;if(3>=B)for(;0!=e&&null==d;){oa();0!=K&&32506>=z-K&&(A=Ca(K),A>e&&(A=e));if(3<=A)if(t=ha(z-Q,A-3),e-=A,A<=b){A--;do z++,oa();while(0!=--A);z++}else z+=A,A=0,G=l[z]&255,G=(G<<5^l[z+1]&255)&8191;else t=ha(0,l[z]&255),e--,z++;t&&(pa(0),y=z);for(;262>e&&!H;)wa()}else for(;0!=e&&
null==d;){oa();f=A;L=Q;A=2;0!=K&&f<b&&32506>=z-K&&(A=Ca(K),A>e&&(A=e),3==A&&4096<z-Q&&A--);if(3<=f&&A<=f){t=ha(z-1-L,f-3);e-=f-1;f-=2;do z++,oa();while(0!=--f);r=0;A=2;z++;t&&(pa(0),y=z)}else 0!=r?ha(0,l[z-1]&255)&&(pa(0),y=z):r=1,z++,e--;for(;262>e&&!H;)wa()}0==e&&(0!=r&&ha(0,l[z-1]&255),pa(1),w=!0);return h+Ga(a,h+c,g-h)},Ga=function(a,b,e){var f,h,k;for(f=0;null!=d&&f<e;){h=e-f;h>d.len&&(h=d.len);for(k=0;k<h;k++)a[b+f+k]=d.ptr[d.off+k];d.off+=h;d.len-=h;f+=h;0==d.len&&(h=d,d=d.next,h.next=c,c=
h)}if(f==e)return f;if(m<p){h=e-f;h>p-m&&(h=p-m);for(k=0;k<h;k++)a[b+f+k]=g[m+k];m+=h;f+=h;p==m&&(p=m=0)}return f},Fa=function(){var a;for(a=0;286>a;a++)C[a].fc=0;for(a=0;30>a;a++)O[a].fc=0;for(a=0;19>a;a++)M[a].fc=0;C[256].fc=1;ba=X=ka=ra=Y=ca=0;ea=1},xa=function(a,b){for(var c=I[b],d=b<<1;d<=W;){d<W&&Aa(a,I[d+1],I[d])&&d++;if(Aa(a,c,I[d]))break;I[b]=I[d];b=d;d<<=1}I[b]=c},Da=function(a,b){var c=Array(16),d=0,e;for(e=1;15>=e;e++)d=d+F[e-1]<<1,c[e]=d;for(d=0;d<=b;d++)e=a[d].dl,0!=e&&(a[d].fc=Ea(c[e]++,
e))},ya=function(a){var b=a.dyn_tree,c=a.static_tree,d=a.elems,e,f=-1,g=d;W=0;J=573;for(e=0;e<d;e++)0!=b[e].fc?(I[++W]=f=e,E[e]=0):b[e].dl=0;for(;2>W;)e=I[++W]=2>f?++f:0,b[e].fc=1,E[e]=0,Y--,null!=c&&(ca-=c[e].dl);a.max_code=f;for(e=W>>1;1<=e;e--)xa(b,e);do e=I[1],I[1]=I[W--],xa(b,1),c=I[1],I[--J]=e,I[--J]=c,b[g].fc=b[e].fc+b[c].fc,E[g]=E[e]>E[c]+1?E[e]:E[c]+1,b[e].dl=b[c].dl=g,I[1]=g++,xa(b,1);while(2<=W);I[--J]=I[1];g=a.dyn_tree;e=a.extra_bits;var d=a.extra_base,c=a.max_code,h=a.max_length,k=a.static_tree,
r,l,m,n,p=0;for(l=0;15>=l;l++)F[l]=0;g[I[J]].dl=0;for(a=J+1;573>a;a++)r=I[a],l=g[g[r].dl].dl+1,l>h&&(l=h,p++),g[r].dl=l,r>c||(F[l]++,m=0,r>=d&&(m=e[r-d]),n=g[r].fc,Y+=n*(l+m),null!=k&&(ca+=n*(k[r].dl+m)));if(0!=p){do{for(l=h-1;0==F[l];)l--;F[l]--;F[l+1]+=2;F[h]--;p-=2}while(0<p);for(l=h;0!=l;l--)for(r=F[l];0!=r;)e=I[--a],e>c||(g[e].dl!=l&&(Y+=(l-g[e].dl)*g[e].fc,g[e].fc=l),r--)}Da(b,f)},Ha=function(a,b){var c,d=-1,e,f=a[0].dl,g=0,h=7,k=4;0==f&&(h=138,k=3);a[b+1].dl=65535;for(c=0;c<=b;c++)e=f,f=a[c+
1].dl,++g<h&&e==f||(g<k?M[e].fc+=g:0!=e?(e!=d&&M[e].fc++,M[16].fc++):10>=g?M[17].fc++:M[18].fc++,g=0,d=e,0==f?(h=138,k=3):e==f?(h=6,k=3):(h=7,k=4))},Ia=function(a,b){var c,d=-1,e,f=a[0].dl,g=0,h=7,k=4;0==f&&(h=138,k=3);for(c=0;c<=b;c++)if(e=f,f=a[c+1].dl,!(++g<h&&e==f)){if(g<k){do Z(e,M);while(0!=--g)}else 0!=e?(e!=d&&(Z(e,M),g--),Z(16,M),P(g-3,2)):10>=g?(Z(17,M),P(g-3,3)):(Z(18,M),P(g-11,7));g=0;d=e;0==f?(h=138,k=3):e==f?(h=6,k=3):(h=7,k=4)}},pa=function(a){var b,c,d,e;e=z-y;ja[ra]=ba;ya(S);ya(T);
Ha(C,S.max_code);Ha(O,T.max_code);ya(N);for(d=18;3<=d&&0==M[za[d]].dl;d--);Y+=3*(d+1)+14;b=Y+3+7>>3;c=ca+3+7>>3;c<=b&&(b=c);if(e+4<=b&&0<=y)for(P(0+a,3),Ja(),na(e),na(~e),d=0;d<e;d++)ma(l[y+d]);else if(c==b)P(2+a,3),Ka(R,V);else{P(4+a,3);e=S.max_code+1;b=T.max_code+1;d+=1;P(e-257,5);P(b-1,5);P(d-4,4);for(c=0;c<d;c++)P(M[za[c]].dl,3);Ia(C,e-1);Ia(O,b-1);Ka(C,O)}Fa();0!=a&&Ja()},ha=function(a,b){q[X++]=b;0==a?C[b].fc++:(a--,C[da[b]+256+1].fc++,O[(256>a?aa[a]:aa[256+(a>>7)])&255].fc++,t[ka++]=a,ba|=
ea);ea<<=1;0==(X&7)&&(ja[ra++]=ba,ba=0,ea=1);if(2<B&&0==(X&4095)){var c=8*X,d=z-y,e;for(e=0;30>e;e++)c+=O[e].fc*(5+ga[e]);c>>=3;if(ka<parseInt(X/2)&&c<parseInt(d/2))return!0}return 8191==X||8192==ka},Ka=function(a,b){var c,d=0,e=0,f=0,g=0,h,k;if(0!=X){do 0==(d&7)&&(g=ja[f++]),c=q[d++]&255,0==(g&1)?Z(c,a):(h=da[c],Z(h+256+1,a),k=ua[h],0!=k&&(c-=qa[h],P(c,k)),c=t[e++],h=(256>c?aa[c]:aa[256+(c>>7)])&255,Z(h,b),k=ga[h],0!=k&&(c-=ia[h],P(c,k))),g>>=1;while(d<X)}Z(256,a)},P=function(a,b){n>16-b?(x|=a<<
n,na(x),x=a>>16-n,n+=b-16):(x|=a<<n,n+=b)},Ea=function(a,b){var c=0;do c|=a&1,a>>=1,c<<=1;while(0<--b);return c>>1},Ja=function(){8<n?na(x):0<n&&ma(x);n=x=0};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.deflate=function(a,b){var e,f;la=a;sa=0;"undefined"==typeof b&&(b=6);(e=b)?1>e?e=1:9<e&&(e=9):e=6;B=e;H=k=!1;if(null==g){c=d=h=null;g=Array(8192);l=Array(65536);t=Array(8192);q=Array(32832);u=Array(65536);C=Array(573);for(e=0;573>e;e++)C[e]=new fa;O=Array(61);for(e=0;61>e;e++)O[e]=new fa;R=Array(288);
for(e=0;288>e;e++)R[e]=new fa;V=Array(30);for(e=0;30>e;e++)V[e]=new fa;M=Array(39);for(e=0;39>e;e++)M[e]=new fa;S=new ta;T=new ta;N=new ta;F=Array(16);I=Array(573);E=Array(573);da=Array(256);aa=Array(512);qa=Array(29);ia=Array(30);ja=Array(1024)}for(var r=Array(1024),m=[];0<(e=Na(r,0,r.length));){var n=Array(e);for(f=0;f<e;f++)n[f]=String.fromCharCode(r[f]);m[m.length]=n.join("")}la=null;return m.join("")}})(this);
(function(a){if(!a.Base64){var c;"undefined"!==typeof module&&module.exports&&(c=require("buffer").Buffer);var d=function(a){for(var c={},d=0,g=a.length;d<g;d++)c[a.charAt(d)]=d;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),h=String.fromCharCode,k=function(a){if(2>a.length){var c=a.charCodeAt(0);return 128>c?a:2048>c?h(192|c>>>6)+h(128|c&63):h(224|c>>>12&15)+h(128|c>>>6&63)+h(128|c&63)}c=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return h(240|c>>>18&
7)+h(128|c>>>12&63)+h(128|c>>>6&63)+h(128|c&63)},g=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,p=function(a){return a.replace(g,k)},m=function(a){var c=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=c?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>
6&63),1<=c?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},w=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,m)},l=c?function(a){return(new c(a)).toString("base64")}:function(a){return w(p(a))},t=function(a,c){return c?l(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):l(a)},q=/[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}/g,u=function(a){switch(a.length){case 4:return a=
((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-65536,h((a>>>10)+55296)+h((a&1023)+56320);case 3:return h((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return h((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},x=function(a){return a.replace(q,u)},n=function(a){var c=a.length,f=c%4;a=(0<c?d[a.charAt(0)]<<18:0)|(1<c?d[a.charAt(1)]<<12:0)|(2<c?d[a.charAt(2)]<<6:0)|(3<c?d[a.charAt(3)]:0);a=[h(a>>>16),h(a>>>8&255),h(a&255)];a.length-=
[0,0,2,1][f];return a.join("")},y=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,n)},G=c?function(a){return(new c(a,"base64")).toString()}:function(a){return x(y(a))},K=function(a){return G(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};a.Base64={VERSION:"2.1.1",atob:y,btoa:w,fromBase64:K,toBase64:t,utob:p,encode:t,encodeURI:function(a){return t(a,!0)},btou:x,decode:K};if("function"===typeof Object.defineProperty){var L=function(a){return{value:a,enumerable:!1,
writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",L(function(){return K(this)}));Object.defineProperty(String.prototype,"toBase64",L(function(a){return t(this,a)}));Object.defineProperty(String.prototype,"toBase64URI",L(function(){return t(this,!0)}))}}}})(this);function importSTL(a,c){for(var d=!0,h=0;h<a.length;h++)if(0==a[h].charCodeAt(0)){d=!1;break}console.log("STL file is ascii: ",d);return d?importAsciiSTL(a,c):importBinarySTL(a,c)}
function importBinarySTL(a,c){var d=[],h=new BinaryReader(a);h.seek(80);for(var k=h.readUInt32(),g=[1E4,1E4,1E4],p=[-1E4,-1E4,-1E4],m=0;m<k;m++){h.readFloat();h.readFloat();h.readFloat();var w=[];w.push(h.readFloat());w.push(h.readFloat());w.push(h.readFloat());var l=[];l.push(h.readFloat());l.push(h.readFloat());l.push(h.readFloat());var t=[];t.push(h.readFloat());t.push(h.readFloat());t.push(h.readFloat());for(var q=0,u=0;3>u;u++)isNaN(w[u])&&q++,isNaN(l[u])&&q++,isNaN(t[u])&&q++;0<q&&console.log("this many bad vertices: ",
q);h.readUInt16();if(!q)for(d.push(w),d.push(l),d.push(t),u=0;3>u;u++)g[u]=Math.min(g[u],w[u]),g[u]=Math.min(g[u],l[u]),g[u]=Math.min(g[u],t[u]),p[u]=Math.max(p[u],w[u]),p[u]=Math.max(p[u],l[u]),p[u]=Math.max(p[u],t[u])}q&&console.log("WARNING: import errors: expect some missing or bad triangles\n");h=[Math.round(p[0]-(p[0]-g[0])/2),Math.round(p[1]-(p[1]-g[1])/2),Math.round(p[2]-(p[2]-g[2])/2)];return[vt2csg(d),h]}
function importAsciiSTL(a,c){for(var d="",h=[],k=0,g=0,p=[1E4,1E4,1E4],m=[-1E4,-1E4,-1E4],w=a.split("\n"),l=0;l<w.length;l++)if(!w[l].match(/facet/)&&!w[l].match(/endloop/))if(w[l].match(/outer/))var k=g=0,t=[[],[],[]];else if(w[l].match(/vertex/)){w[l]=w[l].replace(/^\s+|\s+$/g,"");var q=w[l].split(" ");t[g].push(parseFloat(q[1]));t[g].push(parseFloat(q[2]));t[g].push(parseFloat(q[3]));isNaN(t[g][0])&&k++;isNaN(t[g][1])&&k++;isNaN(t[g][2])&&k++;0<k&&(console.log("this many bad vertices: ",k),console.log("things are:",
q));if(!k&&3==++g)for(h.push(t[0]),h.push(t[1]),h.push(t[2]),q=0;3>q;q++)p[q]=Math.min(p[q],t[0][q]),p[q]=Math.min(p[q],t[1][q]),p[q]=Math.min(p[q],t[2][q]),m[q]=Math.max(m[q],t[0][q]),m[q]=Math.max(m[q],t[1][q]),m[q]=Math.max(m[q],t[2][q])}k=[Math.round(m[0]-(m[0]-p[0])/2),Math.round(m[1]-(m[1]-p[1])/2),Math.round(m[2]-(m[2]-p[2])/2)];d+=vt2csg(h);return[d,k]}
function vt2csg(a){var c;c="CSG.fromPolygons([";for(var d=0;d<a.length/3;d++){c+="new CSG.Polygon([";for(var h=0;3>h;h++)c+="new CSG.Vertex(new CSG.Vector3D([",c+=a[3*d+h]+"]))",2>h&&(c+=",");c+="])";d<a.length/3-1&&(c+=",")}return c+"])"}var BinaryReader=function(a){this._buffer=a;this._pos=0};
BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(a){this._checkSize(8*
a);var c=this._buffer.substr(this._pos,a);this._pos+=a;return c},seek:function(a){this._pos=a;this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(a,c){var d=a+c+1,h=d>>3;this._checkSize(d);var d=Math.pow(2,c-1)-1,k=this._readBits(a+c,1,h),g=this._readBits(a,c,h),p=0,m=2,w=0;do for(var l=this._readByte(++w,h),t=a%8||8,q=1<<t;q>>=1;)l&q&&(p+=1/m),m*=2;while(a-=t);this._pos+=h;return g==(d<<1)+1?p?NaN:k?-Infinity:Infinity:
(1+-2*k)*(g||p?g?Math.pow(2,g-d)*(1+p):Math.pow(2,-d+1)*p:0)},_decodeInt:function(a,c){var d=this._readBits(0,a,a/8),h=Math.pow(2,a);this._pos+=a/8;return c&&d>=h/2?d-h:d},_shl:function(a,c){for(++c;--c;a=1073741824==((a%=2147483648)&1073741824)?2*a:2*(a-1073741824)+2147483648);return a},_readByte:function(a,c){return this._buffer.charCodeAt(this._pos+c-a-1)&255},_readBits:function(a,c,d){var h=(a+c)%8,k=a%8,g=d-(a>>3)-1;a=d+(-(a+c)>>3);var p=g-a;c=this._readByte(g,d)>>k&(1<<(p?8-k:c))-1;for(p&&h&&
(c+=(this._readByte(a++,d)&(1<<h)-1)<<(p--<<3)-k);p;)c+=this._shl(this._readByte(a++,d),(p--<<3)-k);return c},_checkSize:function(a){Math.ceil(a/8)}};