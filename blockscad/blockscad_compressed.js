// Do not edit this file; automatically generated by blockscad_build.py.
"use strict";
var BlocklyStorage=BlocklyStorage||{},Blockscad=Blockscad||{};Blockscad.Auth=Blockscad.Auth||{};var Blockly=Blockly||{};Blockly.Xml=Blockly.Xml||{};
BlocklyStorage.backupBlocks_=function(){console.log("in backupBlocks");if("localStorage"in window){localStorage.clear();for(var a=Blockly.Xml.workspaceToDom(Blockscad.workspace),b=window.location.href.split("#")[0],e=b+"proj_name",f=b+"current_project",k=b+"current_project_key",h=b+"needToSave",l=Blockscad.workspace.getAllBlocks(),q=0;q<l.length;q++)if("stl_import"==l[q].type){var z=l[q].getField("STL_CONTENTS").getText();if(0<z.length){var p=b+z,u=b+z+"center";if(3E6>Blockscad.csg_commands[z].length){var r=
Base64.toBase64(RawDeflate.deflate(Base64.utob(Blockscad.csg_commands[z])));window.localStorage.setItem(p,r);window.localStorage.setItem(u,Blockscad.csg_center[z])}}}window.localStorage.setItem(b,Blockly.Xml.domToText(a));window.localStorage.setItem(e,$("#project-name").val());window.localStorage.setItem(f,Blockscad.Auth.currentProject);window.localStorage.setItem(k,Blockscad.Auth.currentProjectKey);window.localStorage.setItem(h,Blockscad.undo.needToSave)}};
BlocklyStorage.backupOnUnload=function(){window.addEventListener("unload",BlocklyStorage.backupBlocks_,!1)};
BlocklyStorage.restoreBlocks=function(){var a=window.location.href.split("#")[0],b=a+"proj_name",e=a+"current_project",f=a+"current_project_key",k=a+"needToSave";console.log(window.localStorage);if("localStorage"in window&&window.localStorage[a]){var h=Blockly.Xml.textToDom(window.localStorage[a]);Blockly.Xml.domToWorkspace(Blockscad.workspace,h);for(var h=Blockscad.workspace.getAllBlocks(),l=0;l<h.length;l++)if("stl_import"==h[l].type){var q=h[l].getField("STL_CONTENTS").getText(),z=h[l].getField("STL_FILENAME").getText(),
p=h[l].getField("STL_BUTTON");if(0<q.length){var u=window.localStorage[a+q],r=window.localStorage[a+q+"center"];if(u&&0<u.length)p.setVisible(!1),console.log("csg contents compressed length is:",u.length),p=Base64.btou(RawDeflate.inflate(Base64.fromBase64(u))),console.log("decompressed lengeth is:",p.length),Blockscad.csg_commands[q]=p,Blockscad.csg_filename[q]=z+":::",Blockscad.csg_center[q]=r;else{console.log("couldn't find the stl in localStorage");$("#error-message").html("Warning: Re-load your .STL files");
h[l].getField("STL_CONTENTS").setText("");h[l].getField("STL_FILENAME").setText("");q=h[l].getCommentText();q.match(/^RELOAD/)||(q="RELOAD: "+q);h[l].setCommentText(q);p.setText("Reload");h[l].backlight();if(q=h[l].collapsedParents())for(z=0;z<q.length;z++)q[z].backlight();h[l].isCollapsed()||p.setVisible(!0);p=h[l];for(q=null;p;)p.isCollapsed()&&(q=p),p=p.getSurroundParent();q&&q.setCollapsed(!0,!0)}h[l].render()}}a=window.localStorage[b];"undefined"!=a?$("#project-name").val(a):$("#project-name").val("Untitled");
e=window.localStorage[e];Blockscad.Auth.currentProject="undefined"!=e?e:"";f=window.localStorage[f];"undefined"!=f&&(Blockscad.Auth.currentProjectKey=f);var v=Number(window.localStorage[k]);"undefined"==v||1!=v&&0!=v||setTimeout(function(){Blockscad.undo.needToSave=v},300)}};var BSUtils=BSUtils||{};BSUtils.LANGUAGE_NAME={en:"English",es:"Espa\u00f1ol"};BSUtils.LANGUAGE_RTL=["ar","fa","he"];BSUtils.LANGUAGES=void 0;BSUtils.getStringParamFromUrl=function(a,b){var e=window.location.search.match(new RegExp("[?&]"+a+"=([^&]+)"));return e?decodeURIComponent(e[1].replace(/\+/g,"%20")):b};BSUtils.getLang=function(){var a=BSUtils.getStringParamFromUrl("lang","");void 0===BSUtils.LANGUAGE_NAME[a]&&(a="en");return a};BSUtils.LANG=BSUtils.getLang();
BSUtils.isRtl=function(){return-1!=BSUtils.LANGUAGE_RTL.indexOf(BSUtils.LANG)};
BSUtils.init=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);for(var a=[],b,e=0;e<BSUtils.LANGUAGES.length;e++)b=BSUtils.LANGUAGES[e],a.push([BSUtils.LANGUAGE_NAME[b],b]);a.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0});for(var f=document.getElementById("languageMenu"),e=f.options.length=0;e<a.length;e++){var k=a[e];b=k[k.length-1];k=new Option(k[0],b);b==BSUtils.LANG&&(k.selected=
!0);f.options.add(k)}f.addEventListener("change",BSUtils.changeLanguage,!0);document.getElementById("codeButton")&&BSUtils.bindClick("codeButton",BSUtils.showCode);(a=document.querySelector('meta[name="viewport"]'))&&725>screen.availWidth&&a.setAttribute("content","width=725, initial-scale=.35, user-scalable=no")};
BSUtils.initReadonly=function(){Blockly.inject(document.getElementById("blockly"),{path:"./",readOnly:!0,rtl:BSUtils.isRtl(),scrollbars:!1});var a=BSUtils.getStringParamFromUrl("xml",""),a=Blockly.Xml.textToDom("<xml>"+a+"</xml>");Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)};
BSUtils.loadBlocks=function(a){try{var b=window.sessionStorage.loadOnceBlocks}catch(e){b=null}"BlocklyStorage"in window&&1<window.location.hash.length?BlocklyStorage.retrieveXml(window.location.hash.substring(1)):b?(delete window.sessionStorage.loadOnceBlocks,a=Blockly.Xml.textToDom(b),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):a?(a=Blockly.Xml.textToDom(a),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)};
BSUtils.changeLanguage=function(){if("undefined"!=typeof Blockly&&window.sessionStorage){var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),a=Blockly.Xml.domToText(a);window.sessionStorage.loadOnceBlocks=a}var a=document.getElementById("languageMenu"),a=encodeURIComponent(a.options[a.selectedIndex].value),b=window.location.search,b=1>=b.length?"?lang="+a:b.match(/[?&]lang=[^&]*/)?b.replace(/([?&]lang=)[^&]*/,"$1"+a):b.replace(/\?/,"?lang="+a+"&");window.location=window.location.protocol+"//"+
window.location.host+window.location.pathname+b};BSUtils.isDialogVisible_=!1;BSUtils.dialogOrigin_=null;BSUtils.dialogDispose_=null;
BSUtils.showDialog=function(a,b,e,f,k,h){function l(){BSUtils.isDialogVisible_&&(q.style.visibility="visible",q.style.zIndex=1,z.style.visibility="hidden")}BSUtils.isDialogVisible_&&BSUtils.hideDialog(!1);BSUtils.isDialogVisible_=!0;BSUtils.dialogOrigin_=b;BSUtils.dialogDispose_=h;var q=document.getElementById("dialog");h=document.getElementById("dialogShadow");var z=document.getElementById("dialogBorder"),p;for(p in k)q.style[p]=k[p];f&&(h.style.visibility="visible",h.style.opacity=.3,f=document.createElement("div"),
f.id="dialogHeader",q.appendChild(f),BSUtils.dialogMouseDownWrapper_=Blockly.bindEvent_(f,"mousedown",null,BSUtils.dialogMouseDown_));q.appendChild(a);a.className=a.className.replace("dialogHiddenContent","");e&&b?(BSUtils.matchBorder_(b,!1,.2),BSUtils.matchBorder_(q,!0,.8),window.setTimeout(l,175)):l()};BSUtils.dialogStartX_=0;BSUtils.dialogStartY_=0;
BSUtils.dialogMouseDown_=function(a){BSUtils.dialogUnbindDragEvents_();if(!Blockly.isRightButton(a)){var b=document.getElementById("dialog");BSUtils.dialogStartX_=b.offsetLeft-a.clientX;BSUtils.dialogStartY_=b.offsetTop-a.clientY;BSUtils.dialogMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",null,BSUtils.dialogUnbindDragEvents_);BSUtils.dialogMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",null,BSUtils.dialogMouseMove_);a.stopPropagation()}};
BSUtils.dialogMouseMove_=function(a){var b=document.getElementById("dialog"),e=BSUtils.dialogStartX_+a.clientX;a=BSUtils.dialogStartY_+a.clientY;a=Math.max(a,0);a=Math.min(a,window.innerHeight-b.offsetHeight);e=Math.max(e,0);e=Math.min(e,window.innerWidth-b.offsetWidth);b.style.left=e+"px";b.style.top=a+"px"};
BSUtils.dialogUnbindDragEvents_=function(){BSUtils.dialogMouseUpWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseUpWrapper_),BSUtils.dialogMouseUpWrapper_=null);BSUtils.dialogMouseMoveWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseMoveWrapper_),BSUtils.dialogMouseMoveWrapper_=null)};
BSUtils.hideDialog=function(a){function b(){f.style.visibility="hidden";k.style.visibility="hidden"}if(BSUtils.isDialogVisible_){BSUtils.dialogUnbindDragEvents_();BSUtils.dialogMouseDownWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseDownWrapper_),BSUtils.dialogMouseDownWrapper_=null);BSUtils.isDialogVisible_=!1;BSUtils.dialogDispose_&&BSUtils.dialogDispose_();BSUtils.dialogDispose_=null;var e=!1===a?null:BSUtils.dialogOrigin_;a=document.getElementById("dialog");var f=document.getElementById("dialogShadow"),
k=document.getElementById("dialogBorder");f.style.opacity=0;e?(BSUtils.matchBorder_(a,!1,.8),BSUtils.matchBorder_(e,!0,.2),window.setTimeout(b,175)):b();a.style.visibility="hidden";a.style.zIndex=-1;for((e=document.getElementById("dialogHeader"))&&e.parentNode.removeChild(e);a.firstChild;)e=a.firstChild,e.className+=" dialogHiddenContent",document.body.appendChild(e)}};
BSUtils.matchBorder_=function(a,b,e){function f(){k.style.width=h.width+"px";k.style.height=h.height+"px";k.style.left=h.x+"px";k.style.top=h.y+"px";k.style.opacity=e}if(a){var k=document.getElementById("dialogBorder"),h=BSUtils.getBBox_(a);b?(k.className="dialogAnimate",window.setTimeout(f,1)):(k.className="",f());k.style.visibility="visible"}};
BSUtils.getBBox_=function(a){var b=a.offsetHeight,e=a.offsetWidth,f=0,k=0;do f+=a.offsetLeft,k+=a.offsetTop,a=a.offsetParent;while(a);return{height:b,width:e,x:f,y:k}};
BSUtils.storageAlert=function(a){var b=document.getElementById("containerStorage");b.textContent="";a=a.split("\n");for(var e=0;e<a.length;e++){var f=document.createElement("p");f.appendChild(document.createTextNode(a[e]));b.appendChild(f)}b=document.getElementById("dialogStorage");a=document.getElementById("linkButton");BSUtils.showDialog(b,a,!0,!0,{width:"50%",left:"25%",top:"5em"},BSUtils.stopDialogKeyDown());BSUtils.startDialogKeyDown()};
BSUtils.dialogKeyDown_=function(a){!BSUtils.isDialogVisible_||13!=a.keyCode&&27!=a.keyCode&&32!=a.keyCode||(BSUtils.hideDialog(!0),a.stopPropagation(),a.preventDefault())};BSUtils.startDialogKeyDown=function(){document.body.addEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.stopDialogKeyDown=function(){document.body.removeEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.getMsg=function(a){var b=BSUtils.getMsgOrNull(a);return null===b?"[Unknown message: "+a+"]":b};
BSUtils.getMsgOrNull=function(a){return(a=document.getElementById(a))?(a=a.textContent,a=a.replace(/\\n/g,"\n")):null};BSUtils.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var a=document.getElementsByTagName("button"),b=0,e;e=a[b];b++)e.ontouchend||(e.ontouchend=e.onclick)};window.addEventListener("load",BSUtils.addTouchEvents,!1);
BSUtils.bindClick=function(a,b){"string"==typeof a&&(a=document.getElementById(a));a.addEventListener("click",b,!0);a.addEventListener("touchend",b,!0)};Blockscad=Blockscad||{};Blockscad.Toolbox=Blockscad.Toolbox||{};Blockscad.Auth=Blockscad.Auth||{};BlocklyStorage=BlocklyStorage||{};Blockly=Blockly||{};BSUtils=BSUtils||{};Blockscad.version="1.3.3";Blockscad.offline=!0;Blockscad.gProcessor=null;var _includePath="./";Blockscad.drawAxes=1;
Blockscad.init=function(){Blockscad.initLanguage();Blockscad.inputVersion=Blockscad.version;BSUtils.isRtl();Blockscad.missingFields=[];Blockscad.csg_commands={};Blockscad.csg_filename={};Blockscad.csg_center=[0,0,0];var a=document.getElementById("main");window.addEventListener("resize",function(b){b=BSUtils.getBBox_(a);var e=document.getElementById("blocklyDiv");e.style.top=b.y+"px";e.style.left=b.x+"px";e.style.height=b.height-88+"px";e.style.width=b.width+"px";null!=Blockscad.gProcessor&&Blockscad.gProcessor.viewer&&
Blockscad.gProcessor.viewer.rendered_resize(Blockscad.gProcessor.viewerdiv.offsetWidth,Blockscad.gProcessor.viewerdiv.offsetHeight);70>$("#main").height()-$(".resizableDiv").height()&&$(".resizableDiv").height($("#main").height()-70);20>$("#main").width()-$(".resizableDiv").width()&&$(".resizableDiv").width($("#main").width()-20);$(".resizableDiv").position({of:$("#main"),my:"right top",at:"right top",offset:"-12 -55"})},!1);Blockscad.workspace=Blockly.inject(document.getElementById("blocklyDiv"),
{media:"blockly/media/",zoom:{enabled:!0,scaleSpeed:1.1,controls:!0},trashcan:!1,toolbox:Blockscad.Toolbox.adv});Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one);Blockscad.Toolbox.setCatColors();$("#advancedToolbox").hide();BSUtils.loadBlocks("");"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload();$(".resizableDiv").resizable({handles:"s,w,sw",resize:function(a,e){var f=$(window).height();null!=Blockscad.gProcessor&&(f=Blockscad.gProcessor.viewerdiv.offsetHeight,Blockscad.gProcessor.viewer.rendered_resize(Blockscad.gProcessor.viewerdiv.offsetWidth,
f));20>$("#main").width()-e.size.width&&(e.size.width=$("#main").width()-20);70>$("#main").height()-e.size.height&&(e.size.height=$("#main").height()-70);e.position.left=$(window).width()-(e.size.width+12);e.position.top=55}});Blockly.fireUiEvent(window,"resize");Blockscad.offline||Blockscad.Auth.init();BSUtils.bindClick("trashButton",function(){Blockscad.discard()});BSUtils.bindClick("renderButton",Blockscad.doRender);BSUtils.bindClick("undoButton",Blockscad.onUndo);BSUtils.bindClick("redoButton",
Blockscad.onRedo);$("#axesButton").click(function(){Blockscad.drawAxes=(Blockscad.drawAxes+1)%2;$("#axesButton").toggleClass("btn-pushed");Blockscad.gProcessor.viewer.onDraw()});$("#displayCode").click(function(){var a=document.getElementById("openScadPre"),e=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace);a.textContent=e;"function"==typeof prettyPrintOne&&(e=a.innerHTML,e=prettyPrintOne(e,"js"),a.innerHTML=e);Blockly.fireUiEvent(window,"resize")});$("#main").on("click",".new-project",Blockscad.newProject);
$("#file-menu").on("change","#loadLocal",function(a){Blockscad.loadLocalBlocks(a)});$("#file-menu").on("change","#importLocal",function(a){readSingleFile(a,!1)});$("#file-menu").on("change","#importStl",function(a){Blockscad.readStlFile(a)});Blockscad.picSize=[120,120];Blockscad.picQuality=.85;$("#picButton").click(Blockscad.takePic);$("#rPicButton").click(Blockscad.takeRPic);Blockscad.gProcessor=new Blockscad.Processor(document.getElementById("renderDiv"));BSUtils.bindClick("viewReset",Blockscad.resetView);
Blockscad.undo={blockList:[],oldBlockList:[],undoStack:[],redoStack:[],current_xml:null,blockCount:0,yesthis:0,fieldChanging:0,blockIds:[],fieldValues:[],parentIds:[],oldBlockIds:[],oldFieldValues:[],oldParentIds:[],just_did_undo:0,oldProjectName:"Untitled"};Blockscad.setNoSaveNeeded();Blockscad.workspace.addUndoListener(Blockscad.workspaceChanged);Blockscad.offline||Blockscad.Auth.checkForUser();$("#help-menu").on("click","#about",function(){$("#about-modal").modal("show")});$("#file-menu").on("click",
"#saveLocal",Blockscad.saveBlocksLocal);$("#file-menu").on("click","#saveOpenscad",Blockscad.saveOpenscadLocal);$("#simpleToolbox").on("click",function(){$("#simpleToolbox").hide();$("#advancedToolbox").show();Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.sim),Blockscad.Toolbox.setCatColors())});$("#advancedToolbox").on("click",function(){$("#advancedToolbox").hide();$("#simpleToolbox").show();Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],
Blockscad.workspace.updateToolbox(Blockscad.Toolbox.adv),Blockscad.Toolbox.setCatColors())});$("#colors_one").on("click",function(){Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one),Blockscad.Toolbox.setCatColors(),Blockscad.workspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});$("#colors_two").on("click",function(){Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.two),Blockscad.Toolbox.setCatColors(),
Blockscad.workspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});Blockscad.setColor=function(a,e,f){null!=Blockscad.gProcessor&&Blockscad.gProcessor.viewer&&(Blockscad.gProcessor.viewer.defaultColor=[a/255,e/255,f/255,1],Blockscad.gProcessor.picviewer.defaultColor=[a/255,e/255,f/255,1],Blockscad.gProcessor.hasSolid()&&(Blockscad.gProcessor.viewer.setCsg(Blockscad.gProcessor.currentObject),Blockscad.gProcessor.picviewer.setCsg(Blockscad.gProcessor.currentObject),
Blockscad.gProcessor.thumbnail=Blockscad.gProcessor.picviewer.takePic(Blockscad.picQuality,0)),Blockscad.defaultColor=Math.round(a)+","+Math.round(e)+","+Math.round(f),$("#defColor").spectrum("set","rgb("+Blockscad.defaultColor+")"))};$("#defColor").spectrum({color:"rgb(255,128,255)",showPalette:!0,className:"defaultColor",appendTo:"#renderDiv",hideAfterPaletteSelect:!0,showPaletteOnly:!0,change:function(a){Blockscad.setColor(a._r,a._g,a._b)},palette:[["rgb(255,128,255);","rgb(153,153,153);","rgb(238,0,0);",
"rgb(255,102,0);"],["rgb(255,204,0);","rgb(0,153,0);","rgb(51,102,255);","rgb(204,51,204);"]]});$("#examples_torus").click({msg:"torus.xml"},Blockscad.showExample);$("#examples_box").click({msg:"box.xml"},Blockscad.showExample);$("#examples_linear_extrude").click({msg:"linear_extrude.xml"},Blockscad.showExample);$("#examples_rotate_extrude").click({msg:"rotate_extrude.xml"},Blockscad.showExample);$("#examples_cube_with_cutouts").click({msg:"cube_with_cutouts.xml"},Blockscad.showExample);$("#examples_anthias_fish").click({msg:"anthias_fish.xml"},
Blockscad.showExample);$("#examples_hulled_loop_sun").click({msg:"hulled_loop_sun.xml"},Blockscad.showExample);$("#examples_sine_function_with_loop").click({msg:"sine_function_with_loop.xml"},Blockscad.showExample);$("#examples_trefoil_knot_param_eq").click({msg:"trefoil_knot_param_eq.xml"},Blockscad.showExample);$(function(){$(".dropdown-menu > li > a.trigger").on("click",function(a){var e=$(this).next(),f=$(this).parent().parent();($(this).hasClass("left-caret")||$(this).hasClass("right-caret"))&&
$(this).toggleClass("right-caret left-caret");f.find(".left-caret").not(this).toggleClass("right-caret left-caret");f.find(".sub-menu:visible").not(e).hide();e.toggle();a.stopPropagation()});$(".dropdown-menu > li > a:not(.trigger)").on("click",function(){var a=$(this).closest(".dropdown");a.find(".left-caret").toggleClass("right-caret left-caret");a.find(".sub-menu:visible").hide()})});$("#stl_buttons").hide()};
Blockscad.takeRPic=function(){if(null!=Blockscad.gProcessor){var a=Blockscad.gProcessor.takeRotatingPic(1,13);gifshot.createGIF({images:a,interval:.4,gifWidth:Blockscad.picSize[0],gifHeight:Blockscad.picSize[1],sampleInterval:1},function(a){a.error||Blockscad.savePic(a.image,$("#project-name").val()+".gif")})}};
Blockscad.savePic=function(a,b){if(a){var e=atob(a.split(",")[1]);a.split(",")[0].split(":")[1].split(";");for(var f=new ArrayBuffer(e.length),k=new Uint8Array(f),h=0;h<e.length;h++)k[h]=e.charCodeAt(h);e=new Blob([f],{type:"img/jpeg"});saveAs(e,b)}};Blockscad.takePic=function(){if(Blockscad.gProcessor.picviewer){var a=Blockscad.gProcessor.picviewer.takePic(Blockscad.picQuality,0);a&&Blockscad.savePic(a,$("#project-name").val()+".jpg")}};
Blockscad.loadLocalBlocks=function(a){a.target.files.length&&(Blockscad.undo.needToSave?promptForSave().then(function(b){"cancel"!=b&&("nosave"==b?Blockscad.setNoSaveNeeded():"save"==b&&Blockscad.saveBlocks(),Blockscad.createNewProject(),readSingleFile(a,!0))})["catch"](function(a){console.log("caught an error in new project.  result is:"+a)}):(Blockscad.createNewProject(),readSingleFile(a,!0)))};
function readSingleFile(a,b){var e=a.target.files[0];if(e){var f;b&&(f=e.name.substr(0,e.name.lastIndexOf("("))||e.name,f=f.substr(0,e.name.lastIndexOf("."))||f,f=f.replace(/^\s+|\s+$/g,""));b&&(Blockscad.Auth.currentProject="");b&&Blockly.getMainWorkspace().clear();var k={},h=new FileReader;h.onload=function(a){k=a.target.result;a=Blockly.Xml.textToDom(k);Blockly.Xml.domToWorkspace(Blockscad.workspace,a);Blockly.fireUiEvent(window,"resize");Blockscad.clearStlBlocks()};h.readAsText(e);$("#importLocal")[0].value=
"";$("#loadLocal")[0].value="";b&&$("#project-name").val(f);$("#projView").hide();$("#editView").show();Blockscad.offline||$("#bigsavebutton").show();$("#displayBlocks").click();Blockscad.gProcessor.clearViewer()}}
Blockscad.readStlFile=function(a){var b=a.target.files[0];b?(a=new FileReader,a.onload=function(a){a=importSTL(a.target.result);var f=a[0];(a=a[1])||(a="blah");for(var k=b.name.substr(0,b.name.lastIndexOf("("))||b.name,k=k.substr(0,b.name.lastIndexOf("."))||k,h=k=k.replace(/^\s+|\s+$/g,""),l=1,q=0;Blockscad.csg_commands[h]&&!q;)f!=Blockscad.csg_commands[h]?(h=k+"_"+l,l++):q=1;Blockscad.csg_commands[h]=f;Blockscad.csg_filename[h]=q?Blockscad.csg_filename[h]+(b.name+":::"):b.name+":::";Blockscad.csg_center[h]=
a;Blockscad.currentInterestingBlock?(k=Blockscad.currentInterestingBlock.getField("STL_FILENAME"),f=Blockscad.currentInterestingBlock.getField("STL_BUTTON"),l=Blockscad.currentInterestingBlock.getField("STL_CONTENTS"),k.setText(b.name),k.setVisible(!0),f.setVisible(!1),l.setText(h),Blockscad.currentInterestingBlock.setCommentText(b.name+"\ncenter:("+a+")"),Blockscad.currentInterestingBlock=null):(h=Blockly.Xml.textToDom('<xml xmlns="http://blockscad.einsteinsworkshop.com"><block type="stl_import" id="1" x="10" y="10"><field name="STL_FILENAME">'+
b.name+'</field><field name="STL_BUTTON">Browse</field><field name="STL_CONTENTS">'+h+"</field></block></xml>"),h=Blockly.Xml.domToBlock(Blockscad.workspace,h.firstChild),f=h.getField("STL_BUTTON"),f.setVisible(!1),h.setCommentText(b.name+"\ncenter:("+a+")"),h.render())},a.readAsBinaryString(b),$("#importStl")[0].value="",$("#displayBlocks").click()):alert("Failed to load file")};document.write('<script src="blockly/msg/js/'+BSUtils.LANG+'.js">\x3c/script>\n');window.addEventListener("load",Blockscad.init);
Blockscad.clearStlBlocks=function(){for(var a=Blockscad.workspace.getAllBlocks(),b=0;b<a.length;b++)if("stl_import"==a[b].type){var e=a[b].getField("STL_BUTTON");a[b].getField("STL_CONTENTS").setText("");a[b].getField("STL_FILENAME").setText("");var f=a[b].getCommentText();f.match(/^RELOAD/)||(f="RELOAD: "+f);a[b].setCommentText(f);e.setText("Reload");a[b].backlight();if(f=a[b].collapsedParents())for(var k=0;k<f.length;k++)f[k].backlight();a[b].isCollapsed()||e.setVisible(!0);e=a[b];for(f=null;e;)e.isCollapsed()&&
(f=e),e=e.getSurroundParent();f&&f.setCollapsed(!0,!0);a[b].render();$("#error-message").html("Warning: re-load your STL file block")}};Blockscad.newProject=function(){$("#displayBlocks").click();Blockscad.undo.needToSave?promptForSave().then(function(a){"cancel"!=a&&("nosave"==a?Blockscad.setNoSaveNeeded():"save"==a&&Blockscad.saveBlocks(),Blockscad.createNewProject())})["catch"](function(a){console.log("caught an error in new project.  result is:"+a)}):Blockscad.createNewProject()};
Blockscad.createNewProject=function(){Blockscad.clearProject();Blockscad.workspaceChanged();Blockscad.clearUndo();setTimeout(Blockscad.setNoSaveNeeded,300);$("#displayBlocks").click();Blockscad.offline||$("#bigsavebutton").show()};
function promptForSave(){return new Promise(function(a,b){bootbox.dialog({message:"<h4>Want to save your stuff?</h4>",backdrop:!0,size:"small",buttons:{save:{label:"Save",className:"btn-default btn-lg primary pull-right giant-yes",callback:function(b){a("save")}},dont_save:{label:"Don't Save",className:"btn-default btn-lg primary pull-left",callback:function(b){a("nosave")}}},onEscape:function(){a("cancel")}})})}
Blockscad.saveBlocks=function(){!Blockscad.offline&&Blockscad.Auth.isLoggedIn?Blockscad.Auth.saveBlocksToAccount():Blockscad.saveBlocksLocal()};
Blockscad.showExample=function(a){var b="examples/"+a.data.msg,e=a.data.msg.split(".")[0];Blockscad.undo.needToSave?promptForSave().then(function(a){"cancel"!=a&&("nosave"==a?Blockscad.setNoSaveNeeded():"save"==a&&Blockscad.saveBlocks(),Blockscad.getExample(b,e))})["catch"](function(a){console.log("caught an error in show example 1.  result is:"+a)}):Blockscad.getExample(b,e)};
Blockscad.getExample=function(a,b){$.get(a,function(a){Blockscad.clearProject();Blockscad.workspaceChanged();a=window.ActiveXObject?a.xml:(new XMLSerializer).serializeToString(a);a=Blockly.Xml.textToDom(a);Blockly.Xml.domToWorkspace(Blockscad.workspace,a);Blockly.fireUiEvent(window,"resize");$("#project-name").val(b+" example");setTimeout(Blockscad.setNoSaveNeeded,300)})};Blockscad.setNoSaveNeeded=function(){Blockscad.undo.needToSave=0};
Blockscad.clearProject=function(){Blockscad.offline||(Blockscad.Auth.currentProject="",Blockscad.Auth.currentProjectKey="");Blockscad.workspace.clear();Blockscad.gProcessor.clearViewer();$("#project-name").val("Untitled");$("#projectView").hide();$("#editView").show();$("#bigsavebutton").show()};Blockscad.clearUndo=function(){for(;Blockscad.undo.undoStack.length;)Blockscad.undo.undoStack.pop();for(;Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop()};
Blockscad.discard=function(){var a=Blockly.mainWorkspace.getAllBlocks().length;2>a?(Blockly.mainWorkspace.clear(),window.location.hash=""):bootbox.confirm({size:"small",message:"Delete all "+a+" blocks?",buttons:{confirm:{className:"btn-default confirm-yes"}},callback:function(a){a&&(Blockly.mainWorkspace.clear(),window.location.hash="")}})};
Blockscad.resetView=function(){null!=Blockscad.gProcessor&&(Blockscad.gProcessor.viewer&&Blockscad.gProcessor.viewer.viewReset(),Blockscad.gProcessor.picviewer&&Blockscad.gProcessor.picviewer.viewReset())};
Blockscad.mixes2and3D=function(){for(var a=[],a=Blockly.mainWorkspace.getTopBlocks(),b=0,e=0,f=0,k=0,h=0;h<a.length;h++)if(Blockscad.stackIsShape(a[h])){var k=1,l=a[h].category,q;"PRIMITIVE_CSG"==l&&b++;"PRIMITIVE_CAG"==l&&e++;if("TRANSFORM"==l||"SET_OP"==l)q=a[h].getInput("A").connection.check_,1==q.length&&"CSG"==q[0]&&b++,1==q.length&&"CAG"==q[0]&&e++;"LOOP"==l&&(q=a[h].getInput("DO").connection.check_,1==q.length&&"CSG"==q[0]&&b++,1==q.length&&"CAG"==q[0]&&e++);"COLOR"==l&&b++;"EXTRUDE"==l&&b++;
"controls_if"==a[h].type&&f++}!k||b+e+f||Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks());return[b&&e,k]};
Blockscad.doRender=function(){$("#error-message").html("");$("#error-message").removeClass("has-error");$("#renderButton").prop("disabled",!0);Blockscad.gProcessor.clearViewer();var a=Blockscad.mixes2and3D();if(0===a[1])$("#error-message").html("Error: Nothing to Render"),$("#error-message").addClass("has-error"),$("#renderButton").prop("disabled",!1);else if(a[0])$("#error-message").html("Error: both 2D and 3D objects are present.  There can be only one."),$("#error-message").addClass("has-error"),
$("#renderButton").prop("disabled",!1);else{Blockscad.missingFields=[];Blockscad.illegalValue=[];var a=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),b=!1;if(0<Blockscad.missingFields.length)for(var e=0;e<Blockscad.missingFields.length;e++){b=Blockly.mainWorkspace.getBlockById(Blockscad.missingFields[e]);b.unselect();b.backlight();if(b=b.collapsedParents())for(var f=0;f<b.length;f++)b[f].unselect(),b[f].backlight();b=!0}if(0<Blockscad.illegalValue.length){for(e=0;e<Blockscad.illegalValue.length;e++)if(b=
Blockly.mainWorkspace.getBlockById(Blockscad.illegalValue[e]),b.unselect(),b.backlight(),b=b.collapsedParents())for(f=0;f<b.length;f++)b[f].unselect(),b[f].backlight();b=!0}if(b)a="",Blockscad.missingFields.length&&(a+="ERROR: "+Blockscad.missingFields.length+" blocks are missing fields."),Blockscad.missingFields.length&&Blockscad.illegalValue.length&&(a+="<br>"),Blockscad.illegalValue.length&&(a+="ERROR: "+Blockscad.illegalValue.length+" blocks have an illegal negative or zero value"),$("#error-message").html(a),
$("#error-message").addClass("has-error"),$("#renderButton").prop("disabled",!1);else if(Blockscad.loadTheseFonts=Blockscad.whichFonts(a),$("#renderButton").html("working"),0<Blockscad.loadTheseFonts.length)for(e=Blockscad.numloaded=0;e<Blockscad.loadTheseFonts.length;e++)Blockscad.loadFontThenRender(e,a);else Blockscad.renderCode(a)}};
Blockscad.renderCode=function(a){var b="",e=!0;try{window.setTimeout(function(){b=openscadOpenJscadParser.parse(a)},0)}catch(f){$("#error-message").html(f),$("#error-message").addClass("has-error"),e=!1}e?window.setTimeout(function(){Blockscad.gProcessor.setBlockscad(b)},0):$("#renderButton").html("Render")};
Blockscad.isRealChange=function(){Blockscad.undo.blockIds=[];Blockscad.undo.parentIds=[];Blockscad.undo.fieldValues=[];Blockscad.undo.isDisabled=[];Blockscad.undo.varNames=[];Blockscad.undo.comment=[];Blockscad.undo.projectName=$("#project-name").val();Blockscad.undo.triggerRender=!1;var a=null,b=a=null,b=null,e=!1;Blockscad.undo.projectName!=Blockscad.undo.oldProjectName&&(Blockscad.undo.needToSave=1);for(b=0;b<Blockscad.undo.blockList.length;b++)Blockscad.undo.fieldValues[b]=Blockscad.undo.blockList[b].getAllFieldValues(),
Blockscad.undo.blockIds[b]=Blockscad.undo.blockList[b].id,Blockscad.undo.isDisabled[b]=Blockscad.undo.blockList[b].disabled,Blockscad.undo.comment[b]=Blockscad.undo.blockList[b].getCommentText(),Blockscad.undo.varNames[b]="variables_set"==Blockscad.undo.blockList[b].type||"variables_get"==Blockscad.undo.blockList[b].type?Blockscad.undo.blockList[b].getFieldValue("VAR"):null,Blockscad.undo.blockList[b].getParent()?Blockscad.undo.parentIds[b]=Blockscad.undo.blockList[b].getParent().id:Blockscad.undo.parentIds[b]=
null,Blockscad.undo.blockList[b].category&&"UNKNOWN"==Blockscad.undo.blockList[b].category&&Blockscad.undo.blockList[b].getType();if(Blockscad.undo.blockCount>Blockscad.undo.blockList.length){Blockscad.undo.fieldChanging=0;if(0!==Blockscad.undo.blockList.length){a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList);if(b=Blockscad.getBlockFromId(Blockscad.undo.oldParentIds[a],Blockscad.undo.blockList))Blockscad.assignBlockTypes([b]),"variables_set"==b.type&&Blockscad.assignVarTypes(b);
if(null!=Blockscad.undo.oldVarNames[a])for(a=Blockly.Variables.getInstances(Blockscad.undo.oldVarNames[a],Blockscad.workspace),b=0;a&&b<a.length;b++)"variables_get"==a[b].type&&Blockscad.assignVarTypes(a[b])}Blockscad.undo.needToSave=1;return Blockscad.undo.triggerRender=!0}if(Blockscad.undo.blockCount<Blockscad.undo.blockList.length){Blockscad.undo.fieldChanging=0;if(0===Blockscad.undo.oldBlockList.length)for(Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()),a=Blockly.mainWorkspace.getAllBlocks(),
b=0;b<a.length;b++)"variables_set"==a[b].type&&Blockscad.assignVarTypes(a[b]);else a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList),Blockscad.assignBlockTypes([Blockscad.undo.blockList[a]]),(b=Blockscad.undo.blockList[a].getParent())&&"variables_set"==b.type&&Blockscad.assignVarTypes(b),"variables_set"==Blockscad.undo.blockList[a].type&&Blockscad.assignVarTypes(Blockscad.undo.blockList[a]);Blockscad.undo.needToSave=1;return Blockscad.undo.triggerRender=!0}for(b=
0;b<Blockscad.undo.blockIds.length;b++){for(var f=Blockscad.undo.blockIds[b],k=0,a=0;a<Blockscad.undo.blockIds.length;a++)if(f==Blockscad.undo.oldBlockIds[a]){k=1;if(Blockscad.undo.parentIds[b]!=Blockscad.undo.oldParentIds[a]){Blockscad.undo.needToSave=1;Blockscad.undo.triggerRender=!0;Blockscad.assignBlockTypes([Blockscad.undo.blockList[b]]);(b=Blockscad.undo.blockList[b].getParent())&&"variables_set"==b.type&&Blockscad.assignVarTypes(b);for(b=0;e=Blockscad.undo.blockList[b];b++)if(e.id==Blockscad.undo.oldParentIds[a]){Blockscad.assignBlockTypes([Blockscad.undo.blockList[b]]);
"variables_set"==Blockscad.undo.blockList[b].type&&Blockscad.assignVarTypes(Blockscad.undo.blockList[b]);break}return!0}Blockscad.undo.varNames[b]!=Blockscad.undo.oldVarNames[a]&&(Blockscad.undo.fieldChanging=0,Blockscad.assignVarTypes(Blockscad.undo.blockList[b]),Blockscad.undo.needToSave=1,Blockscad.undo.triggerRender=!0);Blockscad.undo.fieldValues[b]!=Blockscad.undo.oldFieldValues[a]&&($("#renderButton").prop("disabled",!1),Blockscad.undo.fieldChanging=1,Blockscad.undo.needToSave=1);if(Blockscad.undo.fieldChanging&&
Blockscad.undo.editorClosed)return Blockscad.undo.fieldChanging=0,Blockscad.undo.triggerRender=!0;Blockscad.undo.isDisabled[b]!=Blockscad.undo.oldDisabled[a]&&(e=!0,Blockscad.undo.triggerRender=!0);Blockscad.undo.comment[b]!=Blockscad.undo.oldComment[a]&&(Blockscad.undo.needToSave=1)}if(!k)return!0}return e?(Blockscad.undo.needToSave=1,!0):!1};
Blockscad.workspaceChanged=function(){Blockscad.undo.yesthis=0;Blockscad.undo.blockList=Blockly.mainWorkspace.getAllBlocks();Blockscad.undo.yesthis=Blockscad.isRealChange();Blockscad.undo.blockCount=Blockscad.undo.blockList.length;Blockscad.undo.oldBlockIds=Blockscad.undo.blockIds;Blockscad.undo.oldParentIds=Blockscad.undo.parentIds;Blockscad.undo.oldFieldValues=Blockscad.undo.fieldValues;Blockscad.undo.oldDisabled=Blockscad.undo.isDisabled;Blockscad.undo.oldComment=Blockscad.undo.comment;Blockscad.undo.oldProjectName=
Blockscad.undo.projectName;Blockscad.undo.oldVarNames=Blockscad.undo.varNames;if(Blockscad.undo.yesthis&&(Blockscad.undo.needToSave&&0==Blockscad.undo.blockCount&&Blockscad.setNoSaveNeeded(),$("#renderButton").prop("disabled",!1),Blockscad.undo.just_did_undo&&Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()),0===Blockscad.undo.just_did_undo)){null!==Blockscad.undo.current_xml&&Blockscad.undo.undoStack.push(Blockscad.undo.current_xml);for(Blockscad.undo.current_xml=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());0<
Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop();50<Blockscad.undo.undoStack.length&&Blockscad.undo.undoStack.shift()}Blockscad.undo.current_xml=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());Blockscad.undo.oldBlockList=[];for(var a=0;a<Blockscad.undo.blockList.length;a++)Blockscad.undo.oldBlockList.push(Blockly.Xml.blockToDom_(Blockscad.undo.blockList[a]));Blockscad.undo.just_did_undo=0;0<Blockscad.undo.undoStack.length?$("#undoButton").prop("disabled",!1):$("#undoButton").prop("disabled",
!0);0<Blockscad.undo.redoStack.length?$("#redoButton").prop("disabled",!1):$("#redoButton").prop("disabled",!0)};Blockscad.getExtraRootBlock=function(a,b){var e=0;if(a.length>b.length)for(var f=0;f<a.length;f++){for(var k=e=0;k<b.length;k++)if(a[f].getAttribute("id")==b[k].id){e=1;break}if(!e)return f}else for(f=0;f<b.length;f++){for(k=e=0;k<a.length;k++)if(b[f].id==a[k].getAttribute("id")){e=1;break}if(!e)return f}return 0};
Blockscad.getBlockFromId=function(a,b){for(var e=0,f;f=b[e];e++)if(f.id==a)return f;return null};Blockscad.onUndo=function(){0<Blockscad.undo.undoStack.length&&(Blockscad.undo.redoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.undoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};
Blockscad.onRedo=function(){0<Blockscad.undo.redoStack.length&&(Blockscad.undo.undoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.redoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};Blockscad.aCallerBlock=function(a,b){for(var e=0;e<b.length;e++)if(a==b[e])return!0;return!1};
Blockscad.findBlockType=function(a,b){for(var e=a.getRootBlock().getDescendants(),f=0,k=0,h=0;h<e.length;h++)if(!Blockscad.aCallerBlock(e[h],b)&&e[h].category){var l=e[h].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){f=1;break}"PRIMITIVE_CAG"==l&&(k=1)}return f?Blockscad.hasExtrudeParent(a)?"CAG":"CSG":k?"CAG":"EITHER"};Blockscad.stackIsShape=function(a){a=a.getDescendants();for(var b=0;b<a.length;b++){var e=a[b];if(("PRIMITIVE_CSG"==e.category||"PRIMITIVE_CAG"==e.category)&&!e.hasDisabledParent())return!0}return!1};
Blockscad.assignVarTypes=function(a){if("variables_get"==a.type){for(var b=Blockly.Variables.getInstances(a.getFieldValue("VAR"),this.workspace),e=0,f=0;f<b.length;f++){if("variables_set"==b[f].type){a.outputConnection.setCheck(b[f].myType_);e=1;break}if("controls_for"==b[f].type||"controls_for_chainhull"==b[f].type){a.outputConnection.setCheck(null);e=1;break}}e||a.outputConnection.setCheck(null);(a=a.getParent())&&"variables_set"==a.type&&Blockscad.assignVarTypes(a)}else if("variables_set"==a.type)if(b=
a.getChildren(),0==b.length)a.setType(null);else{for(f=e=0;f<b.length;f++)b[f].outputConnection&&(a.setType(b[f].outputConnection.check_),e=1);0==e&&a.setType(null)}};
Blockscad.assignBlockTypes=function(a){for(var b=0;b<a.length;b++){for(var e=a[b].getRootBlock().getDescendants(),f=0,k=0,h=0;h<e.length;h++)if(e[h].category){var l=e[h].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){f=1;break}"PRIMITIVE_CAG"==l&&(k=1)}for(h=0;h<e.length;h++)!e[h].category||"TRANSFORM"!=e[h].category&&"SET_OP"!=e[h].category&&"PROCEDURE"!=e[h].category&&"LOOP"!=e[h].category||(l=!e[h].collapsedParents(),f?Blockscad.hasExtrudeParent(e[h])?e[h].setType("CAG",l):e[h].setType("CSG",
l):k?e[h].setType("CAG",l):e[h].setType(["CSG","CAG"],l))}};Blockscad.hasExtrudeParent=function(a){do{if("EXTRUDE"==a.category)return!0;a=a.parentBlock_}while(a);return!1};
Blockscad.initLanguage=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);var a=[],b;for(b in BSUtils.LANGUAGE_NAME)a.push([BSUtils.LANGUAGE_NAME[b],b]);a.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0});for(var e=document.getElementById("languageMenu"),f=e.options.length=0;f<a.length;f++){var k=a[f];b=k[k.length-1];k=new Option(k[0],b);b==BSUtils.LANG&&(k.selected=!0);e.options.add(k)}e.addEventListener("change",
BSUtils.changeLanguage,!0)};Blockscad.saveBlocksLocal=function(){var a=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()),a=Blockly.Xml.domToText(a),a=new Blob([a],{type:"text/plain;charset=utf-8"}),b=$("#project-name").val();b?(saveAs(a,b+".xml"),Blockscad.setNoSaveNeeded()):alert("SAVE FAILED.  Please give your project a name, then try again.")};Blockscad.savePicLocal=function(a){a=new Blob([a],{type:"img/jpeg"});saveAs(a,"tryThis.jpg")};
Blockscad.saveOpenscadLocal=function(){var a=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),a=new Blob([a],{type:"text/plain;charset=utf-8"}),b=$("#project-name").val();b?saveAs(a,b+".scad"):alert("SAVE FAILED.  Please give your project a name, then try again.")};var fileSaver={},saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,e=a.URL||a.webkitURL||a,f=b.createElementNS("http://www.w3.org/1999/xhtml","a"),k=!a.externalHost&&"download"in f,h=a.webkitRequestFileSystem,l=a.requestFileSystem||h||a.mozRequestFileSystem,q=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},
z=0,p=[],u=function(){for(var a=p.length;a--;){var b=p[a];"string"===typeof b?e.revokeObjectURL(b):b.remove()}p.length=0},r=function(a,b,e){b=[].concat(b);for(var f=b.length;f--;){var h=a["on"+b[f]];if("function"===typeof h)try{h.call(a,e||a)}catch(k){q(k)}}},v=function(e,q){var n=this,v=e.type,t=!1,D,g,u=function(){var c=(a.URL||a.webkitURL||a).createObjectURL(e);p.push(c);return c},A=function(){r(n,["writestart","progress","write","writeend"])},K=function(){if(t||!D)D=u(e);g?g.location.href=D:window.open(D,
"_blank");n.readyState=n.DONE;A()},x=function(a){return function(){if(n.readyState!==n.DONE)return a.apply(this,arguments)}},w={create:!0,exclusive:!1},c;n.readyState=n.INIT;q||(q="download");if(k)D=u(e),b=a.document,f=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f.href=D,f.download=q,v=b.createEvent("MouseEvents"),v.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(v),n.readyState=n.DONE,A();else{a.chrome&&v&&"application/octet-stream"!==v&&(c=e.slice||e.webkitSlice,
e=c.call(e,0,e.size,"application/octet-stream"),t=!0);h&&"download"!==q&&(q+=".download");if("application/octet-stream"===v||h)g=a;l?(z+=e.size,l(a.TEMPORARY,z,x(function(a){a.root.getDirectory("saved",w,x(function(a){var c=function(){a.getFile(q,w,x(function(a){a.createWriter(x(function(c){c.onwriteend=function(c){g.location.href=a.toURL();p.push(a);n.readyState=n.DONE;r(n,"writeend",c)};c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&K()};["writestart","progress","write","abort"].forEach(function(a){c["on"+
a]=n["on"+a]});c.write(e);n.abort=function(){c.abort();n.readyState=n.DONE};n.readyState=n.WRITING}),K)}),K)};a.getFile(q,{create:!1},x(function(a){a.remove();c()}),x(function(a){a.code===a.NOT_FOUND_ERR?c():K()}))}),K)}),K)):K()}},A=v.prototype,n=function(a,b){return new v(a,b)};A.abort=function(){this.readyState=this.DONE;r(this,"abort")};A.readyState=A.INIT=0;A.WRITING=1;A.DONE=2;A.error=A.onwritestart=A.onprogress=A.onwrite=A.onabort=A.onerror=A.onwriteend=null;a.addEventListener("unload",u,!1);
n.unload=function(){u();a.removeEventListener("unload",u,!1)};return n}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&(module.exports=saveAs);Blockscad=Blockscad||{};Blockscad.fonts={};Blockscad.fontList="/fonts/Roboto/Roboto-Bold.ttf /fonts/liberation/LiberationSerif-Bold.ttf /fonts/nimbus/nimbus-sans-l_bold.ttf /fonts/AverageMono/AverageMonoSimp.ttf /fonts/Open_Sans/OpenSans-ExtraBold.ttf /fonts/stardos-stencil/StardosStencil-Bold.ttf /fonts/Chewy/Chewy.ttf /fonts/bangers/Bangers.ttf".split(" ");Blockscad.fontName="Roboto;Liberation Serif;Nimbus Sans;Average Mono;Open Sans;Stardos Stencil;Chewy;Bangers".split(";");
Blockscad.loadFonts=function(){for(var a=0;a<Blockscad.fontList.length;a++)Blockscad.loadFont(a)};Blockscad.loadFont=function(a){opentype.load(Blockscad.fontList[a],function(b,e){if(b)console.log("Could not load font: ",e+":"+b);else return Blockscad.fonts[Blockscad.fontName[a]]=e})};
Blockscad.loadFontThenRender=function(a,b){try{var e=Blockscad.fontName[Blockscad.loadTheseFonts[a]];opentype.load(Blockscad.fontList[Blockscad.loadTheseFonts[a]],function(f,k){f?(console.log("Could not load font: ",k+":"+f),$("#error-message").html("Error: Failed to load font: "+e),$("#error-message").addClass("has-error"),$("#renderButton").html("Render"),$("#renderButton").prop("disabled",!1)):(Blockscad.fonts[Blockscad.fontName[Blockscad.loadTheseFonts[a]]]=k,Blockscad.numloaded++,Blockscad.numloaded==
Blockscad.loadTheseFonts.length&&Blockscad.renderCode(b))})}catch(f){console.log("network error loading font")}};
Blockscad.pathToPoints=function(a,b){var e=[],f=[],k=[],h=2,l,q,z,p,u,r;2<b&&(h=b);10<h&&(h=10);if(a&&a.commands&&0<a.commands.length)for(var v=0,A=[],n=0;n<a.commands.length;n++)switch(a.commands[n].type){case "M":2<k.length&&f.push(k);k=[];e.push([a.commands[n].x,-1*a.commands[n].y]);k.push(v++);A=[a.commands[n].x,-1*a.commands[n].y];break;case "L":e.push([a.commands[n].x,-1*a.commands[n].y]);k.push(v++);A=[a.commands[n].x,-1*a.commands[n].y];break;case "C":l=[a.commands[n].x,-1*a.commands[n].y];
q=[a.commands[n].x1,-1*a.commands[n].y1];z=[a.commands[n].x2,-1*a.commands[n].y2];for(var B=1;B<=h;B++)r=B/h,p=A[1]*Math.pow(1-r,3)+3*q[1]*Math.pow(1-r,2)*r+3*z[1]*Math.pow(1-r,1)*r*r+l[1]*Math.pow(r,3),e.push([p,u]),k.push(v++);A=l;break;case "Q":l=[a.commands[n].x,-1*a.commands[n].y];q=[a.commands[n].x1,-1*a.commands[n].y1];for(B=1;B<=h;B++)r=B/h,p=A[0]*Math.pow(1-r,2)+2*q[0]*Math.pow(1-r,1)*r+l[0]*Math.pow(r,2),u=A[1]*Math.pow(1-r,2)+2*q[1]*Math.pow(1-r,1)*r+l[1]*Math.pow(r,2),e.push([p,u]),k.push(v++);
A=l;break;case "Z":2<k.length&&(f.push(k),k=[])}3>e.length&&(e=[]);return[e,f]};Blockscad.whichFonts=function(a){for(var b=[],e=0;e<Blockscad.fontList.length;e++)-1<a.indexOf(Blockscad.fontName[e])&&(Blockscad.fonts[Blockscad.fontName[e]]||b.push(e));return b};var GL=function(){function a(a,b,c){c=c||{};this.id=g.createTexture();this.width=a;this.height=b;this.format=c.format||g.RGBA;this.type=c.type||g.UNSIGNED_BYTE;g.bindTexture(g.TEXTURE_2D,this.id);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,c.filter||c.magFilter||g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c.filter||c.minFilter||g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c.wrap||c.wrapS||g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,
g.TEXTURE_WRAP_T,c.wrap||c.wrapT||g.CLAMP_TO_EDGE);g.texImage2D(g.TEXTURE_2D,0,this.format,a,b,0,this.format,this.type,null)}function b(){this.unique=[];this.indices=[];this.map={}}function e(a,b){this.buffer=null;this.target=a;this.type=b;this.data=[]}function f(a){a=a||{};this.vertexBuffers={};this.indexBuffers={};this.addVertexBuffer("vertices","gl_Vertex");a.coords&&this.addVertexBuffer("coords","gl_TexCoord");a.normals&&this.addVertexBuffer("normals","gl_Normal");a.colors&&this.addVertexBuffer("colors",
"gl_Color");"triangles"in a&&!a.triangles||this.addIndexBuffer("triangles");a.lines&&this.addIndexBuffer("lines")}function k(a){return new h(2*(a&1)-1,(a&2)-1,(a&4)/2-1)}function h(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}function l(a,b,c){for(var e;null!==(e=a.exec(b));)c(e)}function q(a,b){function c(a){var c=document.getElementById(a);return c?c.text:a}function e(a,c){var x={},b=/^((\s*\/\/.*\n|\s*#extension.*\n)+)\^*$/.exec(c);c=b?b[1]+a+c.substr(b[1].length):a+c;l(/\bgl_\w+\b/g,a,function(a){a in
x||(c=c.replace(new RegExp("\\b"+a+"\\b","g"),"LIGHTGL"+a),x[a]=!0)});return c}function f(a,c){var x=g.createShader(a);g.shaderSource(x,c);g.compileShader(x);if(!g.getShaderParameter(x,g.COMPILE_STATUS))throw"compile error: "+g.getShaderInfoLog(x);return x}a=c(a);b=c(b);var h=a+b,k={};l(/\b(gl_[^;]*)\b;/g,"uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",
function(a){a=a[1];if(-1!=h.indexOf(a)){var c=a.replace(/[a-z_]/g,"");k[c]="LIGHTGL"+a}});-1!=h.indexOf("ftransform")&&(k.MVPM="LIGHTGLgl_ModelViewProjectionMatrix");this.usedMatrices=k;a=e("uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;vec4 ftransform() {  return gl_ModelViewProjectionMatrix * gl_Vertex;}",
a);b=e("precision highp float;uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",b);this.program=g.createProgram();g.attachShader(this.program,f(g.VERTEX_SHADER,a));g.attachShader(this.program,f(g.FRAGMENT_SHADER,b));g.linkProgram(this.program);if(!g.getProgramParameter(this.program,g.LINK_STATUS))throw"link error: "+
g.getProgramInfoLog(this.program);this.attributes={};this.uniformLocations={};var S={};l(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,a+b,function(a){S[a[2]]=1});this.isSampler=S}function z(){g.MODELVIEW=U|1;g.PROJECTION=U|2;var a=new n,b=new n;g.modelviewMatrix=new n;g.projectionMatrix=new n;var c=[],e=[],f,k;g.matrixMode=function(a){switch(a){case g.MODELVIEW:f="modelviewMatrix";k=c;break;case g.PROJECTION:f="projectionMatrix";k=e;break;default:throw"invalid matrix mode "+a;}};g.loadIdentity=
function(){n.identity(g[f])};g.loadMatrix=function(a){a=a.m;for(var c=g[f].m,x=0;16>x;x++)c[x]=a[x]};g.multMatrix=function(a){g.loadMatrix(n.multiply(g[f],a,b))};g.perspective=function(c,b,w,e){g.multMatrix(n.perspective(c,b,w,e,a))};g.frustum=function(c,b,w,e,f,E){g.multMatrix(n.frustum(c,b,w,e,f,E,a))};g.ortho=function(c,b,w,e,f,E){g.multMatrix(n.ortho(c,b,w,e,f,E,a))};g.scale=function(c,b,w){g.multMatrix(n.scale(c,b,w,a))};g.translate=function(c,b,w){g.multMatrix(n.translate(c,b,w,a))};g.rotate=
function(c,b,w,e){g.multMatrix(n.rotate(c,b,w,e,a))};g.lookAt=function(c,b,w,e,f,E,h,F,k){g.multMatrix(n.lookAt(c,b,w,e,f,E,h,F,k,a))};g.pushMatrix=function(){k.push(Array.prototype.slice.call(g[f].m))};g.popMatrix=function(){var a=k.pop();g[f].m=K?new Float32Array(a):a};g.project=function(a,c,x,b,w,e){b=b||g.modelviewMatrix;w=w||g.projectionMatrix;e=e||g.getParameter(g.VIEWPORT);a=w.transformPoint(b.transformPoint(new h(a,c,x)));return new h(e[0]+e[2]*(.5*a.x+.5),e[1]+e[3]*(.5*a.y+.5),.5*a.z+.5)};
g.unProject=function(c,e,f,E,F,k){E=E||g.modelviewMatrix;F=F||g.projectionMatrix;k=k||g.getParameter(g.VIEWPORT);c=new h((c-k[0])/k[2]*2-1,(e-k[1])/k[3]*2-1,2*f-1);return n.inverse(n.multiply(F,E,a),b).transformPoint(c)};g.matrixMode(g.MODELVIEW)}function p(){var a=new f({coords:!0,colors:!0,triangles:!1}),b=-1,c=[0,0,0,0],e=[1,1,1,1],h=new q("uniform float pointSize;varying vec4 color;varying vec4 coord;void main() {color = gl_Color;coord = gl_TexCoord;gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;gl_PointSize = pointSize;}",
"uniform sampler2D texture;uniform float pointSize;uniform bool useTexture;varying vec4 color;varying vec4 coord;void main() {gl_FragColor = color;if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);}");g.pointSize=function(a){h.uniforms({pointSize:a})};g.begin=function(c){if(-1!=b)throw"mismatched gl.begin() and gl.end() calls";b=c;a.colors=[];a.coords=[];a.vertices=[]};g.color=function(a,c,x,b){e=1==arguments.length?a.toArray().concat(1):[a,c,x,b||1]};g.texCoord=function(a,x){c=1==arguments.length?
a.toArray(2):[a,x]};g.vertex=function(b,w,g){a.colors.push(e);a.coords.push(c);a.vertices.push(1==arguments.length?b.toArray():[b,w,g])};g.end=function(){if(-1==b)throw"mismatched gl.begin() and gl.end() calls";a.compile();h.uniforms({useTexture:!!g.getParameter(g.TEXTURE_BINDING_2D)}).draw(a,b);b=-1}}function u(){function a(){for(var c in I)if(v.call(I,c)&&I[c])return!0;return!1}function b(c){var w={},e;for(e in c)w[e]="function"==typeof c[e]?function(a){return function(){a.apply(c,arguments)}}(c[e]):
c[e];w.original=c;w.x=w.pageX;w.y=w.pageY;for(e=g.canvas;e;e=e.offsetParent)w.x-=e.offsetLeft,w.y-=e.offsetTop;r?(w.deltaX=w.x-t,w.deltaY=w.y-O):(w.deltaX=0,w.deltaY=0,r=!0);t=w.x;O=w.y;w.dragging=a();w.preventDefault=function(){w.original.preventDefault()};w.stopPropagation=function(){w.original.stopPropagation()};return w}function c(a){var c={},x;for(x in a)c[x]="function"==typeof a[x]?function(c){return function(){c.apply(a,arguments)}}(a[x]):a[x];c.original=a;if(0<c.targetTouches.length){x=c.targetTouches[0];
c.x=x.pageX;c.y=x.pageY;for(x=g.canvas;x;x=x.offsetParent)c.x-=x.offsetLeft,c.y-=x.offsetTop;r?(c.deltaX=c.x-t,c.deltaY=c.y-O):(c.deltaX=0,c.deltaY=0,r=!0);t=c.x;O=c.y;c.dragging=!0}c.preventDefault=function(){c.original.preventDefault()};c.stopPropagation=function(){c.original.stopPropagation()};return c}function e(a){g=p;a=b(a);if(g.onmousemove)g.onmousemove(a);a.preventDefault()}function f(c){g=p;I[c.which]=!1;a()||(document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",
f),g.canvas.addEventListener("mousemove",e),g.canvas.addEventListener("mouseup",f));c=b(c);if(g.onmouseup)g.onmouseup(c);c.preventDefault()}function h(a){g=p;a=b(a);if(g.onmousewheel)g.onmousewheel(a);a.preventDefault()}function k(a){g=p;0===a.targetTouches.length&&l(a);a=c(a);if(g.ontouchmove)g.ontouchmove(a);a.preventDefault()}function l(a){document.removeEventListener("touchmove",k);document.removeEventListener("touchend",l);g.canvas.addEventListener("touchmove",k);g.canvas.addEventListener("touchend",
l);g=p;a=c(a);if(g.ontouchend)g.ontouchend(a);a.preventDefault()}function q(){r=!1}function n(){I={};r=!1}var p=g,t=0,O=0,I={},r=!1,v=Object.prototype.hasOwnProperty;g.canvas.addEventListener("mousedown",function(c){g=p;a()||(document.addEventListener("mousemove",e),document.addEventListener("mouseup",f),g.canvas.removeEventListener("mousemove",e),g.canvas.removeEventListener("mouseup",f));I[c.which]=!0;c=b(c);if(g.onmousedown)g.onmousedown(c);c.preventDefault()});g.canvas.addEventListener("mousemove",
e);g.canvas.addEventListener("mouseup",f);g.canvas.addEventListener("mousewheel",h);g.canvas.addEventListener("DOMMouseScroll",h);g.canvas.addEventListener("mouseover",q);g.canvas.addEventListener("mouseout",q);g.canvas.addEventListener("touchstart",function(a){n();document.addEventListener("touchmove",k);document.addEventListener("touchend",l);g.canvas.removeEventListener("touchmove",k);g.canvas.removeEventListener("touchend",l);g=p;a=c(a);if(g.ontouchstart)g.ontouchstart(a);a.preventDefault()});
g.canvas.addEventListener("touchmove",k);g.canvas.addEventListener("touchend",l);document.addEventListener("contextmenu",n)}function r(a){return{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[a]||(65<=a&&90>=a?String.fromCharCode(a):null)}function v(a,b,c){a.addEventListener(b,c)}function A(){(function(a){g.makeCurrent=function(){g=a}})(g);g.animate=function(){function a(){g=e;var f=(new Date).getTime();if(g.onupdate)g.onupdate((f-c)/1E3);
if(g.ondraw)g.ondraw();b(a);c=f}var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,1E3/60)},c=(new Date).getTime(),e=g;a()};g.fullscreen=function(a){function b(){g.canvas.width=window.innerWidth-e-f;g.canvas.height=window.innerHeight-c-h;g.viewport(0,0,g.canvas.width,g.canvas.height);!a.camera&&"camera"in a||(g.matrixMode(g.PROJECTION),g.loadIdentity(),g.perspective(a.fov||45,g.canvas.width/g.canvas.height,a.near||.1,a.far||
1E3),g.matrixMode(g.MODELVIEW));if(g.onresize)g.onresize();if(g.ondraw)g.ondraw()}a=a||{};var c=a.paddingTop||0,e=a.paddingLeft||0,f=a.paddingRight||0,h=a.paddingBottom||0;if(!document.body)throw"document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)";document.body.appendChild(g.canvas);document.body.style.overflow="hidden";g.canvas.style.position="absolute";g.canvas.style.left=e+"px";g.canvas.style.top=c+"px";window.addEventListener("resize",b);
b()}}function n(){var a=Array.prototype.concat.apply([],arguments);a.length||(a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.m=K?new Float32Array(a):a}function B(a,b,c){this.t=arguments.length?a:Number.MAX_VALUE;this.hit=b;this.normal=c}function J(){var a=g.getParameter(g.VIEWPORT),b=g.modelviewMatrix.m,c=new h(b[0],b[4],b[8]),e=new h(b[1],b[5],b[9]),f=new h(b[2],b[6],b[10]),b=new h(b[3],b[7],b[11]);this.eye=new h(-b.dot(c),-b.dot(e),-b.dot(f));c=a[0];e=c+a[2];f=a[1];b=f+a[3];this.ray00=g.unProject(c,
f,1).subtract(this.eye);this.ray10=g.unProject(e,f,1).subtract(this.eye);this.ray01=g.unProject(c,b,1).subtract(this.eye);this.ray11=g.unProject(e,b,1).subtract(this.eye);this.viewport=a}var N,P,t;a.prototype={bind:function(a){g.activeTexture(g.TEXTURE0+(a||0));g.bindTexture(g.TEXTURE_2D,this.id)},unbind:function(a){g.activeTexture(g.TEXTURE0+(a||0));g.bindTexture(g.TEXTURE_2D,null)},drawTo:function(a,b){b=b||{};var c=g.getParameter(g.VIEWPORT);g.viewport(0,0,this.width,this.height);N=N||g.createFramebuffer();
g.bindFramebuffer(g.FRAMEBUFFER,N);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,this.id,0);if(!1!==b.depth){P=P||g.createRenderbuffer();g.bindRenderbuffer(g.RENDERBUFFER,P);if(this.width!=P.width||this.height!=P.height)P.width=this.width,P.height=this.height,g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_COMPONENT16,this.width,this.height);g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,P)}a();g.bindFramebuffer(g.FRAMEBUFFER,null);g.bindRenderbuffer(g.RENDERBUFFER,
null);g.viewport(c[0],c[1],c[2],c[3])},swapWith:function(a){var b;b=a.id;a.id=this.id;this.id=b;b=a.width;a.width=this.width;this.width=b;b=a.height;a.height=this.height;this.height=b}};a.fromImage=function(b,w){w=w||{};var c=new a(b.width,b.height,w);try{g.texImage2D(g.TEXTURE_2D,0,c.format,c.format,c.type,b)}catch(e){if("file:"==window.location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";
}w.minFilter&&w.minFilter!=g.NEAREST&&w.minFilter!=g.LINEAR&&g.generateMipmap(g.TEXTURE_2D);return c};a.fromURL=function(b,w){t=t||function(){var a=document.createElement("canvas").getContext("2d");a.canvas.width=a.canvas.height=128;for(var c=0;c<a.canvas.height;c+=16)for(var b=0;b<a.canvas.width;b+=16)a.fillStyle=(b^c)&16?"#FFF":"#DDD",a.fillRect(b,c,16,16);return a.canvas}();var c=a.fromImage(t,w),e=new Image,f=g;e.onload=function(){f.makeCurrent();a.fromImage(e,w).swapWith(c)};e.src=b;return c};
b.prototype={add:function(a){var b=JSON.stringify(a);b in this.map||(this.map[b]=this.unique.length,this.unique.push(a));return this.map[b]}};e.prototype={compile:function(a){for(var b=[],c=0;c<this.data.length;c+=1E4)b=Array.prototype.concat.apply(b,this.data.slice(c,c+1E4));c=this.data.length?b.length/this.data.length:0;if(c!=Math.round(c))throw"buffer elements not of consistent size, average size is "+c;this.buffer=this.buffer||g.createBuffer();this.buffer.length=b.length;this.buffer.spacing=c;
g.bindBuffer(this.target,this.buffer);g.bufferData(this.target,new this.type(b),a||g.STATIC_DRAW)}};f.prototype={addVertexBuffer:function(a,b){(this.vertexBuffers[b]=new e(g.ARRAY_BUFFER,Float32Array)).name=a;this[a]=[]},addIndexBuffer:function(a){this.indexBuffers[a]=new e(g.ELEMENT_ARRAY_BUFFER,Uint16Array);this[a]=[]},compile:function(){for(var a in this.vertexBuffers){var b=this.vertexBuffers[a];b.data=this[b.name];b.compile()}for(var c in this.indexBuffers)b=this.indexBuffers[c],b.data=this[c],
b.compile()},transform:function(a){this.vertices=this.vertices.map(function(c){return a.transformPoint(h.fromArray(c)).toArray()});if(this.normals){var b=a.inverse().transpose();this.normals=this.normals.map(function(a){return b.transformVector(h.fromArray(a)).unit().toArray()})}this.compile();return this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal");for(var a=0;a<this.vertices.length;a++)this.normals[a]=new h;for(a=0;a<this.triangles.length;a++){var b=this.triangles[a],
c=h.fromArray(this.vertices[b[0]]),e=h.fromArray(this.vertices[b[1]]),f=h.fromArray(this.vertices[b[2]]),c=e.subtract(c).cross(f.subtract(c)).unit();this.normals[b[0]]=this.normals[b[0]].add(c);this.normals[b[1]]=this.normals[b[1]].add(c);this.normals[b[2]]=this.normals[b[2]].add(c)}for(a=0;a<this.vertices.length;a++)this.normals[a]=this.normals[a].unit().toArray();this.compile();return this},computeWireframe:function(){for(var a=new b,e=0;e<this.triangles.length;e++)for(var c=this.triangles[e],f=
0;f<c.length;f++){var g=c[f],h=c[(f+1)%c.length];a.add([Math.min(g,h),Math.max(g,h)])}this.lines||this.addIndexBuffer("lines");this.lines=a.unique;this.compile();return this},getAABB:function(){var a={min:new h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};a.max=a.min.negative();for(var b=0;b<this.vertices.length;b++){var c=h.fromArray(this.vertices[b]);a.min=h.min(a.min,c);a.max=h.max(a.max,c)}return a},getBoundingSphere:function(){for(var a=this.getAABB(),a={center:a.min.add(a.max).divide(2),
radius:0},b=0;b<this.vertices.length;b++)a.radius=Math.max(a.radius,h.fromArray(this.vertices[b]).subtract(a.center).length());return a}};f.plane=function(a){a=a||{};var b=new f(a),c=a.detailX||a.detail||1;a=a.detailY||a.detail||1;for(var e=0;e<=a;e++)for(var g=e/a,h=0;h<=c;h++){var k=h/c;b.vertices.push([2*k-1,2*g-1,0]);b.coords&&b.coords.push([k,g]);b.normals&&b.normals.push([0,0,1]);h<c&&e<a&&(k=h+e*(c+1),b.triangles.push([k,k+1,k+c+1]),b.triangles.push([k+c+1,k+1,k+c+2]))}b.compile();return b};
var D=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];f.cube=function(a){a=new f(a);for(var b=0;b<D.length;b++){for(var c=D[b],e=4*b,g=0;4>g;g++)a.vertices.push(k(c[g]).toArray()),a.coords&&a.coords.push([g&1,(g&2)/2]),a.normals&&a.normals.push(c.slice(4,7));a.triangles.push([e,e+1,e+2]);a.triangles.push([e+2,e+1,e+3])}a.compile();return a};f.sphere=function(a){function e(a,c,b){return q?[a,b,c]:[a,c,b]}a=a||{};var c=new f(a),g=new b;a=a.detail||
6;for(var F=0;8>F;F++)for(var l=k(F),q=0<l.x*l.y*l.z,n=[],p=0;p<=a;p++){for(var t=0;p+t<=a;t++){var r=p/a,v=t/a,O=(a-p-t)/a,v={vertex:(new h(r+(r-r*r)/2,v+(v-v*v)/2,O+(O-O*O)/2)).unit().multiply(l).toArray()};c.coords&&(v.coord=0<l.y?[1-r,O]:[O,1-r]);n.push(g.add(v))}if(0<p)for(t=0;p+t<=a;t++)r=(p-1)*(a+1)+(p-1-(p-1)*(p-1))/2+t,v=p*(a+1)+(p-p*p)/2+t,c.triangles.push(e(n[r],n[r+1],n[v])),p+t<a&&c.triangles.push(e(n[v],n[r+1],n[v+1]))}c.vertices=g.unique.map(function(a){return a.vertex});c.coords&&
(c.coords=g.unique.map(function(a){return a.coord}));c.normals&&(c.normals=c.vertices);c.compile();return c};f.load=function(a,b){b=b||{};"coords"in b||(b.coords=!!a.coords);"normals"in b||(b.normals=!!a.normals);"colors"in b||(b.colors=!!a.colors);"triangles"in b||(b.triangles=!!a.triangles);"lines"in b||(b.lines=!!a.lines);var c=new f(b);c.vertices=a.vertices;c.coords&&(c.coords=a.coords);c.normals&&(c.normals=a.normals);c.colors&&(c.colors=a.colors);c.triangles&&(c.triangles=a.triangles);c.lines&&
(c.lines=a.lines);c.compile();return c};h.prototype={negative:function(){return new h(-this.x,-this.y,-this.z)},add:function(a){return a instanceof h?new h(this.x+a.x,this.y+a.y,this.z+a.z):new h(this.x+a,this.y+a,this.z+a)},subtract:function(a){return a instanceof h?new h(this.x-a.x,this.y-a.y,this.z-a.z):new h(this.x-a,this.y-a,this.z-a)},multiply:function(a){return a instanceof h?new h(this.x*a.x,this.y*a.y,this.z*a.z):new h(this.x*a,this.y*a,this.z*a)},divide:function(a){return a instanceof h?
new h(this.x/a.x,this.y/a.y,this.z/a.z):new h(this.x/a,this.y/a,this.z/a)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){return new h(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,
this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(a){return[this.x,this.y,this.z].slice(0,a||3)},clone:function(){return new h(this.x,this.y,this.z)},init:function(a,b,c){this.x=a;this.y=b;this.z=c;return this}};h.negative=function(a,b){b.x=-a.x;b.y=-a.y;b.z=-a.z;return b};h.add=function(a,b,c){b instanceof h?(c.x=a.x+b.x,c.y=a.y+b.y,c.z=a.z+b.z):(c.x=a.x+b,c.y=a.y+b,c.z=a.z+b);return c};h.subtract=function(a,b,c){b instanceof
h?(c.x=a.x-b.x,c.y=a.y-b.y,c.z=a.z-b.z):(c.x=a.x-b,c.y=a.y-b,c.z=a.z-b);return c};h.multiply=function(a,b,c){b instanceof h?(c.x=a.x*b.x,c.y=a.y*b.y,c.z=a.z*b.z):(c.x=a.x*b,c.y=a.y*b,c.z=a.z*b);return c};h.divide=function(a,b,c){b instanceof h?(c.x=a.x/b.x,c.y=a.y/b.y,c.z=a.z/b.z):(c.x=a.x/b,c.y=a.y/b,c.z=a.z/b);return c};h.cross=function(a,b,c){c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};h.unit=function(a,b){var c=a.length();b.x=a.x/c;b.y=a.y/c;b.z=a.z/c;return b};h.fromAngles=
function(a,b){return new h(Math.cos(a)*Math.cos(b),Math.sin(b),Math.sin(a)*Math.cos(b))};h.randomDirection=function(){return h.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))};h.min=function(a,b){return new h(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.min(a.z,b.z))};h.max=function(a,b){return new h(Math.max(a.x,b.x),Math.max(a.y,b.y),Math.max(a.z,b.z))};h.lerp=function(a,b,c){return b.subtract(a).multiply(c).add(a)};h.fromArray=function(a){return new h(a[0],a[1],a[2])};q.prototype=
{uniforms:function(a){g.useProgram(this.program);for(var b in a){var c=this.uniformLocations[b]||g.getUniformLocation(this.program,b);if(c){this.uniformLocations[b]=c;var e=a[b];e instanceof h?e=[e.x,e.y,e.z]:e instanceof n&&(e=e.m);var f=Object.prototype.toString.call(e);if("[object Array]"==f||"[object Float32Array]"==f)switch(e.length){case 1:g.uniform1fv(c,new Float32Array(e));break;case 2:g.uniform2fv(c,new Float32Array(e));break;case 3:g.uniform3fv(c,new Float32Array(e));break;case 4:g.uniform4fv(c,
new Float32Array(e));break;case 9:g.uniformMatrix3fv(c,!1,new Float32Array([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]));break;case 16:g.uniformMatrix4fv(c,!1,new Float32Array([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]));break;default:throw"don't know how to load uniform \""+b+'" of length '+e.length;}else if(f=Object.prototype.toString.call(e),"[object Number]"==f||"[object Boolean]"==f)(this.isSampler[b]?g.uniform1i:g.uniform1f).call(g,c,e);else throw'attempted to set uniform "'+
b+'" to invalid value '+e;}}return this},draw:function(a,b){this.drawBuffers(a.vertexBuffers,a.indexBuffers[b==g.LINES?"lines":"triangles"],2>arguments.length?g.TRIANGLES:b)},drawBuffers:function(a,b,c){var e=this.usedMatrices,f=g.modelviewMatrix,h=g.projectionMatrix,k=e.MVMI||e.NM?f.inverse():null,l=e.PMI?h.inverse():null,p=e.MVPM||e.MVPMI?h.multiply(f):null,q={};e.MVM&&(q[e.MVM]=f);e.MVMI&&(q[e.MVMI]=k);e.PM&&(q[e.PM]=h);e.PMI&&(q[e.PMI]=l);e.MVPM&&(q[e.MVPM]=p);e.MVPMI&&(q[e.MVPMI]=p.inverse());
e.NM&&(f=k.m,q[e.NM]=[f[0],f[4],f[8],f[1],f[5],f[9],f[2],f[6],f[10]]);this.uniforms(q);var e=0,n;for(n in a)q=a[n],f=this.attributes[n]||g.getAttribLocation(this.program,n.replace(/^(gl_.*)$/,"LIGHTGL$1")),-1!=f&&q.buffer&&(this.attributes[n]=f,g.bindBuffer(g.ARRAY_BUFFER,q.buffer),g.enableVertexAttribArray(f),g.vertexAttribPointer(f,q.buffer.spacing,g.FLOAT,!1,0,0),e=q.buffer.length/q.buffer.spacing);for(n in this.attributes)n in a||g.disableVertexAttribArray(this.attributes[n]);!e||b&&!b.buffer||
(b?(g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,b.buffer),g.drawElements(c,b.buffer.length,g.UNSIGNED_SHORT,0)):g.drawArrays(c,0,e));return this}};q.fromURL=function(a,b){var c=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);if(200!==b.status)throw"could not load "+a;return b.responseText},e=c(a),c=c(b);return new q(e,c)};q.from=function(a,b){try{return new q(a,b)}catch(c){return q.fromURL(a,b)}};var g,C={create:function(a){a=a||{};var b=a.canvas;b||(b=document.createElement("canvas"),
b.width=a.width||800,b.height=a.height||600);"alpha"in a||(a.alpha=!1);try{g=b.getContext("webgl",a)}catch(c){}try{g=g||b.getContext("experimental-webgl",a)}catch(c){}if(!g)throw"WebGL not supported";z();p();u();A();return g},keys:{},Matrix:n,Indexer:b,Buffer:e,Mesh:f,HitTest:B,Raytracer:J,Shader:q,Texture:a,Vector:h};v(document,"keydown",function(a){if(!a.altKey&&!a.ctrlKey&&!a.metaKey){var b=r(a.keyCode);b&&(C.keys[b]=!0);C.keys[a.keyCode]=!0}});v(document,"keyup",function(a){if(!a.altKey&&!a.ctrlKey&&
!a.metaKey){var b=r(a.keyCode);b&&(C.keys[b]=!1);C.keys[a.keyCode]=!1}});var U=305397760,K="undefined"!=typeof Float32Array;n.prototype={inverse:function(){return n.inverse(this,new n)},transpose:function(){return n.transpose(this,new n)},multiply:function(a){return n.multiply(this,a,new n)},transformPoint:function(a){var b=this.m;return(new h(b[0]*a.x+b[1]*a.y+b[2]*a.z+b[3],b[4]*a.x+b[5]*a.y+b[6]*a.z+b[7],b[8]*a.x+b[9]*a.y+b[10]*a.z+b[11])).divide(b[12]*a.x+b[13]*a.y+b[14]*a.z+b[15])},transformVector:function(a){var b=
this.m;return new h(b[0]*a.x+b[1]*a.y+b[2]*a.z,b[4]*a.x+b[5]*a.y+b[6]*a.z,b[8]*a.x+b[9]*a.y+b[10]*a.z)}};n.inverse=function(a,b){b=b||new n;var c=a.m,e=b.m;e[0]=c[5]*c[10]*c[15]-c[5]*c[14]*c[11]-c[6]*c[9]*c[15]+c[6]*c[13]*c[11]+c[7]*c[9]*c[14]-c[7]*c[13]*c[10];e[1]=-c[1]*c[10]*c[15]+c[1]*c[14]*c[11]+c[2]*c[9]*c[15]-c[2]*c[13]*c[11]-c[3]*c[9]*c[14]+c[3]*c[13]*c[10];e[2]=c[1]*c[6]*c[15]-c[1]*c[14]*c[7]-c[2]*c[5]*c[15]+c[2]*c[13]*c[7]+c[3]*c[5]*c[14]-c[3]*c[13]*c[6];e[3]=-c[1]*c[6]*c[11]+c[1]*c[10]*
c[7]+c[2]*c[5]*c[11]-c[2]*c[9]*c[7]-c[3]*c[5]*c[10]+c[3]*c[9]*c[6];e[4]=-c[4]*c[10]*c[15]+c[4]*c[14]*c[11]+c[6]*c[8]*c[15]-c[6]*c[12]*c[11]-c[7]*c[8]*c[14]+c[7]*c[12]*c[10];e[5]=c[0]*c[10]*c[15]-c[0]*c[14]*c[11]-c[2]*c[8]*c[15]+c[2]*c[12]*c[11]+c[3]*c[8]*c[14]-c[3]*c[12]*c[10];e[6]=-c[0]*c[6]*c[15]+c[0]*c[14]*c[7]+c[2]*c[4]*c[15]-c[2]*c[12]*c[7]-c[3]*c[4]*c[14]+c[3]*c[12]*c[6];e[7]=c[0]*c[6]*c[11]-c[0]*c[10]*c[7]-c[2]*c[4]*c[11]+c[2]*c[8]*c[7]+c[3]*c[4]*c[10]-c[3]*c[8]*c[6];e[8]=c[4]*c[9]*c[15]-c[4]*
c[13]*c[11]-c[5]*c[8]*c[15]+c[5]*c[12]*c[11]+c[7]*c[8]*c[13]-c[7]*c[12]*c[9];e[9]=-c[0]*c[9]*c[15]+c[0]*c[13]*c[11]+c[1]*c[8]*c[15]-c[1]*c[12]*c[11]-c[3]*c[8]*c[13]+c[3]*c[12]*c[9];e[10]=c[0]*c[5]*c[15]-c[0]*c[13]*c[7]-c[1]*c[4]*c[15]+c[1]*c[12]*c[7]+c[3]*c[4]*c[13]-c[3]*c[12]*c[5];e[11]=-c[0]*c[5]*c[11]+c[0]*c[9]*c[7]+c[1]*c[4]*c[11]-c[1]*c[8]*c[7]-c[3]*c[4]*c[9]+c[3]*c[8]*c[5];e[12]=-c[4]*c[9]*c[14]+c[4]*c[13]*c[10]+c[5]*c[8]*c[14]-c[5]*c[12]*c[10]-c[6]*c[8]*c[13]+c[6]*c[12]*c[9];e[13]=c[0]*c[9]*
c[14]-c[0]*c[13]*c[10]-c[1]*c[8]*c[14]+c[1]*c[12]*c[10]+c[2]*c[8]*c[13]-c[2]*c[12]*c[9];e[14]=-c[0]*c[5]*c[14]+c[0]*c[13]*c[6]+c[1]*c[4]*c[14]-c[1]*c[12]*c[6]-c[2]*c[4]*c[13]+c[2]*c[12]*c[5];e[15]=c[0]*c[5]*c[10]-c[0]*c[9]*c[6]-c[1]*c[4]*c[10]+c[1]*c[8]*c[6]+c[2]*c[4]*c[9]-c[2]*c[8]*c[5];for(var c=c[0]*e[0]+c[1]*e[4]+c[2]*e[8]+c[3]*e[12],f=0;16>f;f++)e[f]/=c;return b};n.transpose=function(a,b){b=b||new n;var c=a.m,e=b.m;e[0]=c[0];e[1]=c[4];e[2]=c[8];e[3]=c[12];e[4]=c[1];e[5]=c[5];e[6]=c[9];e[7]=c[13];
e[8]=c[2];e[9]=c[6];e[10]=c[10];e[11]=c[14];e[12]=c[3];e[13]=c[7];e[14]=c[11];e[15]=c[15];return b};n.multiply=function(a,b,c){c=c||new n;a=a.m;b=b.m;var e=c.m;e[0]=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12];e[1]=a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13];e[2]=a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14];e[3]=a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15];e[4]=a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12];e[5]=a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13];e[6]=a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14];e[7]=a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15];e[8]=a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12];e[9]=a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13];e[10]=a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14];e[11]=a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15];e[12]=a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12];e[13]=a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13];e[14]=a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14];e[15]=a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15];return c};n.identity=function(a){a=a||new n;var b=a.m;b[0]=b[5]=b[10]=b[15]=
1;b[1]=b[2]=b[3]=b[4]=b[6]=b[7]=b[8]=b[9]=b[11]=b[12]=b[13]=b[14]=0;return a};n.perspective=function(a,b,c,e,f){a=Math.tan(a*Math.PI/360)*c;b*=a;return n.frustum(-b,b,-a,a,c,e,f)};n.frustum=function(a,b,c,e,f,g,h){h=h||new n;var k=h.m;k[0]=2*f/(b-a);k[1]=0;k[2]=(b+a)/(b-a);k[3]=0;k[4]=0;k[5]=2*f/(e-c);k[6]=(e+c)/(e-c);k[7]=0;k[8]=0;k[9]=0;k[10]=-(g+f)/(g-f);k[11]=-2*g*f/(g-f);k[12]=0;k[13]=0;k[14]=-1;k[15]=0;return h};n.ortho=function(a,b,c,e,f,g,h){h=h||new n;var k=h.m;k[0]=2/(b-a);k[1]=0;k[2]=0;
k[3]=-(b+a)/(b-a);k[4]=0;k[5]=2/(e-c);k[6]=0;k[7]=-(e+c)/(e-c);k[8]=0;k[9]=0;k[10]=-2/(g-f);k[11]=-(g+f)/(g-f);k[12]=0;k[13]=0;k[14]=0;k[15]=1;return h};n.scale=function(a,b,c,e){e=e||new n;var f=e.m;f[0]=a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=b;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=c;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return e};n.translate=function(a,b,c,e){e=e||new n;var f=e.m;f[0]=1;f[1]=0;f[2]=0;f[3]=a;f[4]=0;f[5]=1;f[6]=0;f[7]=b;f[8]=0;f[9]=0;f[10]=1;f[11]=c;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return e};
n.rotate=function(a,b,c,e,f){if(!a||!b&&!c&&!e)return n.identity(f);f=f||new n;var g=f.m,h=Math.sqrt(b*b+c*c+e*e);a*=Math.PI/180;b/=h;c/=h;e/=h;h=Math.cos(a);a=Math.sin(a);var k=1-h;g[0]=b*b*k+h;g[1]=b*c*k-e*a;g[2]=b*e*k+c*a;g[3]=0;g[4]=c*b*k+e*a;g[5]=c*c*k+h;g[6]=c*e*k-b*a;g[7]=0;g[8]=e*b*k-c*a;g[9]=e*c*k+b*a;g[10]=e*e*k+h;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return f};n.lookAt=function(a,b,c,e,f,g,k,l,q,p){p=p||new n;var t=p.m;a=new h(a,b,c);e=new h(e,f,g);l=new h(k,l,q);k=a.subtract(e).unit();
l=l.cross(k).unit();q=k.cross(l).unit();t[0]=l.x;t[1]=l.y;t[2]=l.z;t[3]=-l.dot(a);t[4]=q.x;t[5]=q.y;t[6]=q.z;t[7]=-q.dot(a);t[8]=k.x;t[9]=k.y;t[10]=k.z;t[11]=-k.dot(a);t[12]=0;t[13]=0;t[14]=0;t[15]=1;return p};B.prototype={mergeWith:function(a){0<a.t&&a.t<this.t&&(this.t=a.t,this.hit=a.hit,this.normal=a.normal)}};J.prototype={getRayForPixel:function(a,b){a=(a-this.viewport[0])/this.viewport[2];b=1-(b-this.viewport[1])/this.viewport[3];var c=h.lerp(this.ray00,this.ray10,a),e=h.lerp(this.ray01,this.ray11,
a);return h.lerp(c,e,b).unit()}};J.hitTestBox=function(a,b,c,e){var f=c.subtract(a).divide(b),g=e.subtract(a).divide(b),k=h.min(f,g),f=h.max(f,g),k=k.max(),f=f.min();return 0<k&&k<f?(a=a.add(b.multiply(k)),c=c.add(1E-6),e=e.subtract(1E-6),new B(k,a,new h((a.x>e.x)-(a.x<c.x),(a.y>e.y)-(a.y<c.y),(a.z>e.z)-(a.z<c.z)))):null};J.hitTestSphere=function(a,b,c,e){var f=a.subtract(c),g=b.dot(b),h=2*b.dot(f),f=f.dot(f)-e*e,f=h*h-4*g*f;return 0<f?(g=(-h-Math.sqrt(f))/(2*g),a=a.add(b.multiply(g)),new B(g,a,a.subtract(c).divide(e))):
null};J.hitTestTriangle=function(a,b,c,e,f){var g=e.subtract(c),h=f.subtract(c);f=g.cross(h).unit();e=f.dot(c.subtract(a))/f.dot(b);if(0<e){a=a.add(b.multiply(e));var k=a.subtract(c);c=h.dot(h);b=h.dot(g);var h=h.dot(k),l=g.dot(g),g=g.dot(k),k=c*l-b*b,l=(l*h-b*g)/k,g=(c*g-b*h)/k;if(0<=l&&0<=g&&1>=l+g)return new B(e,a,f)}return null};return C}();Blockscad=Blockscad||{};Blockscad.Toolbox={};Blockly=Blockly||{};Blockscad.Toolbox.catIDs=[];Blockscad.Toolbox.allcats="HEX_3D_PRIMITIVE HEX_2D_PRIMITIVE HEX_TRANSFORM HEX_SETOP HEX_MATH HEX_LOGIC HEX_LOOP HEX_TEXT HEX_VARIABLE HEX_PROCEDURE".split(" ");Blockscad.Toolbox.whichCatsInSimple=[0,2,3,4,8,9];Blockscad.Toolbox.colorScheme={};Blockscad.Toolbox.colorScheme.one="#006205 #209303 #26549E #7450E2 #0186E2 #BF6920 #612485 #727272 #8C7149 #900355".split(" ");Blockscad.Toolbox.colorScheme.two="#885ee3 #82af5a #23901c #377eb8 #ba9969 #afaf13 #a66658 #d761bf #999999 #b02375".split(" ");
Blockscad.Toolbox.catHex=[];Blockscad.Toolbox.simpCatHex=[];Blockscad.Toolbox.setColorScheme=function(a){for(var b=0;b<Blockscad.Toolbox.allcats.length;b++)Blockscad.Toolbox[Blockscad.Toolbox.allcats[b]]=a[b],Blockscad.Toolbox.catHex[b]=a[b]};
Blockscad.Toolbox.setCatColors=function(){if(Blockscad.Toolbox.catIDs.length<Blockscad.Toolbox.allcats.length)for(var a=0;a<Blockscad.Toolbox.catIDs.length;a++){var b=document.getElementById(Blockscad.Toolbox.catIDs[a]);b.style.background=Blockscad.Toolbox.catHex[Blockscad.Toolbox.whichCatsInSimple[a]]}else for(a=0;a<Blockscad.Toolbox.catIDs.length;a++)b=document.getElementById(Blockscad.Toolbox.catIDs[a]),b.style.background=Blockscad.Toolbox.catHex[a]};Blockscad.Toolbox.cat_3D='<category name="3D Shapes"><block type="sphere"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cube"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="torus"><value name="RAD1"><block type="math_number"><field name="NUM">4</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">1</field></block></value><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value><value name="FACES"><block type="math_number"><field name="NUM">16</field></block></value></block></category>';
Blockscad.Toolbox.cat_3D_sim='<category name="3D Shapes"><block type="sphere"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cube"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';
Blockscad.Toolbox.cat2D='<category name="2D Shapes"><block type="circle"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="square"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';Blockscad.Toolbox.catTransform='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="simplemirror_new"></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="color_rgb"><value name="RED"><block type="math_number"><field name="NUM">100</field></block></value><value name="GREEN"><block type="math_number"><field name="NUM">100</field></block></value><value name="BLUE"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block><block type="taper"><value name="FACTOR"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="linearextrude"><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value><value name="TWIST"><block type="math_angle"><field name="NUM">0</field></block></value><value name="XSCALE"><block type="math_number"><field name="NUM">1</field></block></value><value name="YSCALE"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="rotateextrude"><value name="FACES"><block type="math_number"><field name="NUM">5</field></block></value></block><block type="fancyrotate"><value name="AVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="fancymirror"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block></category>';
Blockscad.Toolbox.catTransform_sim='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block></category>';
Blockscad.Toolbox.catSetOps='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block><block type="hull"></block></category>';Blockscad.Toolbox.catSetOps_sim='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block></category>';Blockscad.Toolbox.catMathLogic='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_trig"></block><block type="math_constant_bs"></block><block type="math_number_property"></block><block type="math_round"></block><block type="math_modulo"></block><block type="math_constrain"><value name="LOW"><block type="math_number"><field name="NUM">1</field></block></value><value name="HIGH"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_int"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_float"></block></category><category name="Logic"><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_ternary"></block></category>';
Blockscad.Toolbox.catMathLogic_sim='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_random_int"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">100</field></block></value></block></category>';Blockscad.Toolbox.catLoops='<category name="Loops"><block type="controls_for"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block> </value><value name="TO"><block type="math_number"><field name="NUM">10</field></block></value><value name="BY"><block type="math_number"><field name="NUM">1</field></block></value></block></category>';
Blockscad.Toolbox.catOther='<category name="Text"><block type="bs_text"><value name="TEXT"><block type="text"></block></value><value name="SIZE"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="bs_3dtext"><value name="TEXT"><block type="text"></block></value><value name="SIZE"><block type="math_number"><field name="NUM">10</field></block></value><value name="THICKNESS"><block type="math_number"><field name="NUM">2</field></block></value></block><block type="text"></block><block type="bs_text_length"></block></category><category name="Variables" custom="VARIABLE"></category><category name="Modules" custom="PROCEDURE"></category></xml>';
Blockscad.Toolbox.catOther_sim='<category name="Variables" custom="VARIABLE"></category><category name="Modules" custom="PROCEDURE"></category></xml>';Blockscad.Toolbox.adv='<xml id="toolbox" style="display: none">';Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat_3D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat2D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catTransform;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catSetOps;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catMathLogic;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catLoops;
Blockscad.Toolbox.adv+=Blockscad.Toolbox.catOther;Blockscad.Toolbox.sim='<xml id="toolbox" style="display: none">';Blockscad.Toolbox.sim+=Blockscad.Toolbox.cat_3D_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catTransform_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catSetOps_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catMathLogic_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catOther_sim;(function(a){var b,e,f=null,k,h,l,q,z,p,u,r,v,A,n,B,J,N,P,t=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],K=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],x=function(){this.list=this.next=null},w=function(){this.n=this.b=this.e=0;this.t=null},c=function(a,b,c,e,f,g){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var h=Array(this.BMAX+1),k,l,q,p,n,t,r,v=Array(this.BMAX+1),D,u,z,A=new w,C=Array(this.BMAX);p=Array(this.N_MAX);var B,E=Array(this.BMAX+1),F,G,J;J=this.root=null;for(n=0;n<h.length;n++)h[n]=0;for(n=0;n<v.length;n++)v[n]=0;for(n=0;n<C.length;n++)C[n]=null;for(n=0;n<p.length;n++)p[n]=0;for(n=0;n<
E.length;n++)E[n]=0;k=256<b?a[256]:this.BMAX;D=a;u=0;n=b;do h[D[u]]++,u++;while(0<--n);if(h[0]==b)this.root=null,this.status=this.m=0;else{for(t=1;t<=this.BMAX&&0==h[t];t++);r=t;g<t&&(g=t);for(n=this.BMAX;0!=n&&0==h[n];n--);q=n;g>n&&(g=n);for(F=1<<t;t<n;t++,F<<=1)if(0>(F-=h[t])){this.status=2;this.m=g;return}if(0>(F-=h[n]))this.status=2,this.m=g;else{h[n]+=F;E[1]=t=0;D=h;u=1;for(z=2;0<--n;)E[z++]=t+=D[u++];D=a;n=u=0;do 0!=(t=D[u++])&&(p[E[t]++]=n);while(++n<b);b=E[q];E[0]=n=0;D=p;u=0;p=-1;B=v[0]=
0;z=null;for(G=0;r<=q;r++)for(a=h[r];0<a--;){for(;r>B+v[1+p];){B+=v[1+p];p++;G=(G=q-B)>g?g:G;if((l=1<<(t=r-B))>a+1)for(l-=a+1,z=r;++t<G&&!((l<<=1)<=h[++z]);)l-=h[z];B+t>k&&B<k&&(t=k-B);G=1<<t;v[1+p]=t;z=Array(G);for(l=0;l<G;l++)z[l]=new w;J=null==J?this.root=new x:J.next=new x;J.next=null;J.list=z;C[p]=z;0<p&&(E[p]=n,A.b=v[p],A.e=16+t,A.t=z,t=(n&(1<<B)-1)>>B-v[p],C[p-1][t].e=A.e,C[p-1][t].b=A.b,C[p-1][t].n=A.n,C[p-1][t].t=A.t)}A.b=r-B;u>=b?A.e=99:D[u]<c?(A.e=256>D[u]?16:15,A.n=D[u++]):(A.e=f[D[u]-
c],A.n=e[D[u++]-c]);l=1<<r-B;for(t=n>>B;t<G;t+=l)z[t].e=A.e,z[t].b=A.b,z[t].n=A.n,z[t].t=A.t;for(t=1<<r-1;0!=(n&t);t>>=1)n^=t;for(n^=t;(n&(1<<B)-1)!=E[p];)B-=v[p],p--}this.m=v[1];this.status=0!=F&&1!=q?1:0}}},E=function(a){for(;z<a;){var b=q,c;c=N.length==P?-1:N.charCodeAt(P++)&255;q=b|c<<z;z+=8}},F=function(a){return q&t[a]},G=function(a){q>>=a;z-=a},R=function(a,c,f){var g,h,k;if(0==f)return 0;for(k=0;;){E(B);h=A.list[F(B)];for(g=h.e;16<g;){if(99==g)return-1;G(h.b);g-=16;E(g);h=h.t[F(g)];g=h.e}G(h.b);
if(16==g)e&=32767,a[c+k++]=b[e++]=h.n;else{if(15==g)break;E(g);r=h.n+F(g);G(g);E(J);h=n.list[F(J)];for(g=h.e;16<g;){if(99==g)return-1;G(h.b);g-=16;E(g);h=h.t[F(g)];g=h.e}G(h.b);E(g);v=e-h.n-F(g);for(G(g);0<r&&k<f;)r--,v&=32767,e&=32767,a[c+k++]=b[e++]=b[v++]}if(k==f)return f}p=-1;return k},S=function(a,b,e){var f,h,k,l,t,p,q,r=Array(316);for(f=0;f<r.length;f++)r[f]=0;E(5);p=257+F(5);G(5);E(5);q=1+F(5);G(5);E(4);f=4+F(4);G(4);if(286<p||30<q)return-1;for(h=0;h<f;h++)E(3),r[K[h]]=F(3),G(3);for(;19>h;h++)r[K[h]]=
0;B=7;h=new c(r,19,19,null,null,B);if(0!=h.status)return-1;A=h.root;B=h.m;l=p+q;for(f=k=0;f<l;)if(E(B),t=A.list[F(B)],h=t.b,G(h),h=t.n,16>h)r[f++]=k=h;else if(16==h){E(2);h=3+F(2);G(2);if(f+h>l)return-1;for(;0<h--;)r[f++]=k}else{17==h?(E(3),h=3+F(3),G(3)):(E(7),h=11+F(7),G(7));if(f+h>l)return-1;for(;0<h--;)r[f++]=0;k=0}B=9;h=new c(r,p,257,D,g,B);0==B&&(h.status=1);if(0!=h.status&&1==h.status)return-1;A=h.root;B=h.m;for(f=0;f<q;f++)r[f]=r[f+p];J=6;h=new c(r,q,0,C,U,J);n=h.root;J=h.m;return 0==J&&257<
p||0!=h.status?-1:R(a,b,e)},Y=function(a,t,x){var w,I;for(w=0;w<x&&(!u||-1!=p);){if(0<r){if(0!=p)for(;0<r&&w<x;)r--,v&=32767,e&=32767,a[t+w++]=b[e++]=b[v++];else{for(;0<r&&w<x;)r--,e&=32767,E(8),a[t+w++]=b[e++]=F(8),G(8);0==r&&(p=-1)}if(w==x)break}if(-1==p){if(u)break;E(1);0!=F(1)&&(u=!0);G(1);E(2);p=F(2);G(2);A=null;r=0}switch(p){case 0:I=a;var L=t+w,K=x-w,M=void 0,M=z&7;G(M);E(16);M=F(16);G(16);E(16);if(M!=(~q&65535))I=-1;else{G(16);r=M;for(M=0;0<r&&M<K;)r--,e&=32767,E(8),I[L+M++]=b[e++]=F(8),G(8);
0==r&&(p=-1);I=M}break;case 1:if(null!=A)I=R(a,t+w,x-w);else a:{I=a;L=t+w;K=x-w;if(null==f){for(var H=void 0,M=Array(288),H=void 0,H=0;144>H;H++)M[H]=8;for(;256>H;H++)M[H]=9;for(;280>H;H++)M[H]=7;for(;288>H;H++)M[H]=8;h=7;H=new c(M,288,257,D,g,h);if(0!=H.status){alert("HufBuild error: "+H.status);I=-1;break a}f=H.root;h=H.m;for(H=0;30>H;H++)M[H]=5;l=5;H=new c(M,30,0,C,U,l);if(1<H.status){f=null;alert("HufBuild error: "+H.status);I=-1;break a}k=H.root;l=H.m}A=f;n=k;B=h;J=l;I=R(I,L,K)}break;case 2:I=
null!=A?R(a,t+w,x-w):S(a,t+w,x-w);break;default:I=-1}if(-1==I)return u?0:-1;w+=I}return w};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.inflate=function(a){var c;null==b&&(b=Array(65536));z=q=e=0;p=-1;u=!1;r=v=0;A=null;N=a;P=0;for(var f=Array(1024),g=[];0<(a=Y(f,0,f.length));){var h=Array(a);for(c=0;c<a;c++)h[c]=String.fromCharCode(f[c]);g[g.length]=h.join("")}N=null;return g.join("")}})(this);
(function(a){var b,e,f,k,h=null,l,q,z,p,u,r,v,A,n,B,J,N,P,t,D,g,C,U,K,x,w,c,E,F,G,R,S,Y,Q,V,W,O,I,L,Z,M,H,ha,ea,ua,ma,na,ba,oa,va,fa,ia,ca,ga,pa,wa,ja=function(){this.dl=this.fc=0},xa=function(){this.extra_bits=this.static_tree=this.dyn_tree=null;this.max_code=this.max_length=this.elems=this.extra_base=0},X=function(a,b,c,e){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=e},Pa=function(){this.next=null;this.len=0;this.ptr=Array(8192);this.off=0},ya=[0,0,0,0,0,0,0,0,1,1,1,1,2,
2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ka=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Qa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Da=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],za=[new X(0,0,0,0),new X(4,4,8,4),new X(4,5,16,8),new X(4,6,32,32),new X(4,4,16,16),new X(8,16,32,32),new X(8,16,128,128),new X(8,32,128,256),new X(32,128,258,1024),new X(32,258,258,4096)],qa=function(a){h[q+l++]=a;if(8192==q+l&&0!=l){var c;null!=b?(a=b,b=b.next):a=new Pa;a.next=null;a.len=a.off=0;null==
e?e=f=a:f=f.next=a;a.len=l-q;for(c=0;c<a.len;c++)a.ptr[c]=h[q+c];l=q=0}},ra=function(a){a&=65535;8190>q+l?(h[q+l++]=a&255,h[q+l++]=a>>>8):(qa(a&255),qa(a>>>8))},sa=function(){J=(J<<5^p[C+3-1]&255)&8191;N=v[32768+J];v[C&32767]=N;v[32768+J]=C},da=function(a,b){T(b[a].fc,b[a].dl)},Ea=function(a,b,c){return a[b].fc<a[c].fc||a[b].fc==a[c].fc&&H[b]<=H[c]},Fa=function(a,b,c){var e;for(e=0;e<c&&wa<pa.length;e++)a[b+e]=pa.charCodeAt(wa++)&255;return e},Ga=function(a){var b=w,c=C,e,f=g,h=32506<C?C-32506:0,
k=C+258,t=p[c+f-1],n=p[c+f];g>=F&&(b>>=2);do if(e=a,p[e+f]==n&&p[e+f-1]==t&&p[e]==p[c]&&p[++e]==p[c+1]){c+=2;for(e++;p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&p[++c]==p[++e]&&c<k;);e=258-(k-c);c=k-258;if(e>f){U=a;f=e;if(258<=e)break;t=p[c+f-1];n=p[c+f]}}while((a=v[a&32767])>h&&0!=--b);return f},Aa=function(){var a,b,c=65536-x-C;if(-1==c)c--;else if(65274<=C){for(a=0;32768>a;a++)p[a]=p[a+32768];U-=32768;C-=32768;B-=32768;for(a=0;8192>
a;a++)b=v[32768+a],v[32768+a]=32768<=b?b-32768:0;for(a=0;32768>a;a++)b=v[a],v[a]=32768<=b?b-32768:0;c+=32768}K||(a=Fa(p,C+x,c),0>=a?K=!0:x+=a)},Ra=function(a,b,f){var h;if(!k){if(!K){n=A=0;var r,u;if(0==Y[0].dl){V.dyn_tree=G;V.static_tree=S;V.extra_bits=ya;V.extra_base=257;V.elems=286;V.max_length=15;V.max_code=0;W.dyn_tree=R;W.static_tree=Y;W.extra_bits=ka;W.extra_base=0;W.elems=30;W.max_length=15;W.max_code=0;O.dyn_tree=Q;O.static_tree=null;O.extra_bits=Qa;O.extra_base=0;O.elems=19;O.max_length=
7;for(u=r=O.max_code=0;28>u;u++)for(ua[u]=r,h=0;h<1<<ya[u];h++)ha[r++]=u;ha[r-1]=u;for(u=r=0;16>u;u++)for(ma[u]=r,h=0;h<1<<ka[u];h++)ea[r++]=u;for(r>>=7;30>u;u++)for(ma[u]=r<<7,h=0;h<1<<ka[u]-7;h++)ea[256+r++]=u;for(h=0;15>=h;h++)I[h]=0;for(h=0;143>=h;)S[h++].dl=8,I[8]++;for(;255>=h;)S[h++].dl=9,I[9]++;for(;279>=h;)S[h++].dl=7,I[7]++;for(;287>=h;)S[h++].dl=8,I[8]++;Ha(S,287);for(h=0;30>h;h++)Y[h].dl=5,Y[h].fc=Ia(h,5);Ja()}for(h=0;8192>h;h++)v[32768+h]=0;c=za[E].max_lazy;F=za[E].good_length;w=za[E].max_chain;
B=C=0;x=Fa(p,0,65536);if(0>=x)K=!0,x=0;else{for(K=!1;262>x&&!K;)Aa();for(h=J=0;2>h;h++)J=(J<<5^p[h]&255)&8191}e=null;t=q=l=0;3>=E?(g=2,D=0):(D=2,t=t=0);z=!1}k=!0;if(0==x)return z=!0,0}if((h=Ka(a,b,f))==f)return f;if(z)return h;if(3>=E)for(;0!=x&&null==e;){sa();0!=N&&32506>=C-N&&(D=Ga(N),D>x&&(D=x));if(3<=D)if(u=la(C-U,D-3),x-=D,D<=c){D--;do C++,sa();while(0!=--D);C++}else C+=D,D=0,J=p[C]&255,J=(J<<5^p[C+1]&255)&8191;else u=la(0,p[C]&255),x--,C++;u&&(ta(0),B=C);for(;262>x&&!K;)Aa()}else for(;0!=x&&
null==e;){sa();g=D;P=U;D=2;0!=N&&g<c&&32506>=C-N&&(D=Ga(N),D>x&&(D=x),3==D&&4096<C-U&&D--);if(3<=g&&D<=g){u=la(C-1-P,g-3);x-=g-1;g-=2;do C++,sa();while(0!=--g);t=0;D=2;C++;u&&(ta(0),B=C)}else 0!=t?la(0,p[C-1]&255)&&(ta(0),B=C):t=1,C++,x--;for(;262>x&&!K;)Aa()}0==x&&(0!=t&&la(0,p[C-1]&255),ta(1),z=!0);return h+Ka(a,h+b,f-h)},Ka=function(a,c,f){var g,k,t;for(g=0;null!=e&&g<f;){k=f-g;k>e.len&&(k=e.len);for(t=0;t<k;t++)a[c+g+t]=e.ptr[e.off+t];e.off+=k;e.len-=k;g+=k;0==e.len&&(k=e,e=e.next,k.next=b,b=
k)}if(g==f)return g;if(q<l){k=f-g;k>l-q&&(k=l-q);for(t=0;t<k;t++)a[c+g+t]=h[q+t];q+=k;g+=k;l==q&&(l=q=0)}return g},Ja=function(){var a;for(a=0;286>a;a++)G[a].fc=0;for(a=0;30>a;a++)R[a].fc=0;for(a=0;19>a;a++)Q[a].fc=0;G[256].fc=1;fa=ba=oa=va=ca=ga=0;ia=1},Ba=function(a,b){for(var c=L[b],e=b<<1;e<=Z;){e<Z&&Ea(a,L[e+1],L[e])&&e++;if(Ea(a,c,L[e]))break;L[b]=L[e];b=e;e<<=1}L[b]=c},Ha=function(a,b){var c=Array(16),e=0,f;for(f=1;15>=f;f++)e=e+I[f-1]<<1,c[f]=e;for(e=0;e<=b;e++)f=a[e].dl,0!=f&&(a[e].fc=Ia(c[f]++,
f))},Ca=function(a){var b=a.dyn_tree,c=a.static_tree,e=a.elems,f,h=-1,g=e;Z=0;M=573;for(f=0;f<e;f++)0!=b[f].fc?(L[++Z]=h=f,H[f]=0):b[f].dl=0;for(;2>Z;)f=L[++Z]=2>h?++h:0,b[f].fc=1,H[f]=0,ca--,null!=c&&(ga-=c[f].dl);a.max_code=h;for(f=Z>>1;1<=f;f--)Ba(b,f);do f=L[1],L[1]=L[Z--],Ba(b,1),c=L[1],L[--M]=f,L[--M]=c,b[g].fc=b[f].fc+b[c].fc,H[g]=H[f]>H[c]+1?H[f]:H[c]+1,b[f].dl=b[c].dl=g,L[1]=g++,Ba(b,1);while(2<=Z);L[--M]=L[1];g=a.dyn_tree;f=a.extra_bits;var e=a.extra_base,c=a.max_code,k=a.max_length,t=a.static_tree,
n,l,p,q,r=0;for(l=0;15>=l;l++)I[l]=0;g[L[M]].dl=0;for(a=M+1;573>a;a++)n=L[a],l=g[g[n].dl].dl+1,l>k&&(l=k,r++),g[n].dl=l,n>c||(I[l]++,p=0,n>=e&&(p=f[n-e]),q=g[n].fc,ca+=q*(l+p),null!=t&&(ga+=q*(t[n].dl+p)));if(0!=r){do{for(l=k-1;0==I[l];)l--;I[l]--;I[l+1]+=2;I[k]--;r-=2}while(0<r);for(l=k;0!=l;l--)for(n=I[l];0!=n;)f=L[--a],f>c||(g[f].dl!=l&&(ca+=(l-g[f].dl)*g[f].fc,g[f].fc=l),n--)}Ha(b,h)},La=function(a,b){var c,e=-1,f,g=a[0].dl,h=0,k=7,l=4;0==g&&(k=138,l=3);a[b+1].dl=65535;for(c=0;c<=b;c++)f=g,g=
a[c+1].dl,++h<k&&f==g||(h<l?Q[f].fc+=h:0!=f?(f!=e&&Q[f].fc++,Q[16].fc++):10>=h?Q[17].fc++:Q[18].fc++,h=0,e=f,0==g?(k=138,l=3):f==g?(k=6,l=3):(k=7,l=4))},Ma=function(a,b){var c,e=-1,f,g=a[0].dl,h=0,k=7,l=4;0==g&&(k=138,l=3);for(c=0;c<=b;c++)if(f=g,g=a[c+1].dl,!(++h<k&&f==g)){if(h<l){do da(f,Q);while(0!=--h)}else 0!=f?(f!=e&&(da(f,Q),h--),da(16,Q),T(h-3,2)):10>=h?(da(17,Q),T(h-3,3)):(da(18,Q),T(h-11,7));h=0;e=f;0==g?(k=138,l=3):f==g?(k=6,l=3):(k=7,l=4)}},ta=function(a){var b,c,e,f;f=C-B;na[va]=fa;Ca(V);
Ca(W);La(G,V.max_code);La(R,W.max_code);Ca(O);for(e=18;3<=e&&0==Q[Da[e]].dl;e--);ca+=3*(e+1)+14;b=ca+3+7>>3;c=ga+3+7>>3;c<=b&&(b=c);if(f+4<=b&&0<=B)for(T(0+a,3),Na(),ra(f),ra(~f),e=0;e<f;e++)qa(p[B+e]);else if(c==b)T(2+a,3),Oa(S,Y);else{T(4+a,3);f=V.max_code+1;b=W.max_code+1;e+=1;T(f-257,5);T(b-1,5);T(e-4,4);for(c=0;c<e;c++)T(Q[Da[c]].dl,3);Ma(G,f-1);Ma(R,b-1);Oa(G,R)}Ja();0!=a&&Na()},la=function(a,b){r[ba++]=b;0==a?G[b].fc++:(a--,G[ha[b]+256+1].fc++,R[(256>a?ea[a]:ea[256+(a>>7)])&255].fc++,u[oa++]=
a,fa|=ia);ia<<=1;0==(ba&7)&&(na[va++]=fa,fa=0,ia=1);if(2<E&&0==(ba&4095)){var c=8*ba,e=C-B,f;for(f=0;30>f;f++)c+=R[f].fc*(5+ka[f]);c>>=3;if(oa<parseInt(ba/2)&&c<parseInt(e/2))return!0}return 8191==ba||8192==oa},Oa=function(a,b){var c,e=0,f=0,h=0,g=0,k,l;if(0!=ba){do 0==(e&7)&&(g=na[h++]),c=r[e++]&255,0==(g&1)?da(c,a):(k=ha[c],da(k+256+1,a),l=ya[k],0!=l&&(c-=ua[k],T(c,l)),c=u[f++],k=(256>c?ea[c]:ea[256+(c>>7)])&255,da(k,b),l=ka[k],0!=l&&(c-=ma[k],T(c,l))),g>>=1;while(e<ba)}da(256,a)},T=function(a,
b){n>16-b?(A|=a<<n,ra(A),A=a>>16-n,n+=b-16):(A|=a<<n,n+=b)},Ia=function(a,b){var c=0;do c|=a&1,a>>=1,c<<=1;while(0<--b);return c>>1},Na=function(){8<n?ra(A):0<n&&qa(A);n=A=0};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.deflate=function(a,c){var g,l;pa=a;wa=0;"undefined"==typeof c&&(c=6);(g=c)?1>g?g=1:9<g&&(g=9):g=6;E=g;K=k=!1;if(null==h){b=e=f=null;h=Array(8192);p=Array(65536);u=Array(8192);r=Array(32832);v=Array(65536);G=Array(573);for(g=0;573>g;g++)G[g]=new ja;R=Array(61);for(g=0;61>g;g++)R[g]=
new ja;S=Array(288);for(g=0;288>g;g++)S[g]=new ja;Y=Array(30);for(g=0;30>g;g++)Y[g]=new ja;Q=Array(39);for(g=0;39>g;g++)Q[g]=new ja;V=new xa;W=new xa;O=new xa;I=Array(16);L=Array(573);H=Array(573);ha=Array(256);ea=Array(512);ua=Array(29);ma=Array(30);na=Array(1024)}for(var t=Array(1024),n=[];0<(g=Ra(t,0,t.length));){var q=Array(g);for(l=0;l<g;l++)q[l]=String.fromCharCode(t[l]);n[n.length]=q.join("")}pa=null;return n.join("")}})(this);
(function(a){if(!a.Base64){var b;"undefined"!==typeof module&&module.exports&&(b=require("buffer").Buffer);var e=function(a){for(var b={},e=0,f=a.length;e<f;e++)b[a.charAt(e)]=e;return b}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),f=String.fromCharCode,k=function(a){if(2>a.length){var b=a.charCodeAt(0);return 128>b?a:2048>b?f(192|b>>>6)+f(128|b&63):f(224|b>>>12&15)+f(128|b>>>6&63)+f(128|b&63)}b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return f(240|b>>>18&
7)+f(128|b>>>12&63)+f(128|b>>>6&63)+f(128|b&63)},h=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(a){return a.replace(h,k)},q=function(a){var b=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=b?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>
6&63),1<=b?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},z=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,q)},p=b?function(a){return(new b(a)).toString("base64")}:function(a){return z(l(a))},u=function(a,b){return b?p(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):p(a)},r=RegExp("[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}","g"),v=function(a){switch(a.length){case 4:return a=
((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-65536,f((a>>>10)+55296)+f((a&1023)+56320);case 3:return f((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return f((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},A=function(a){return a.replace(r,v)},n=function(a){var b=a.length,g=b%4;a=(0<b?e[a.charAt(0)]<<18:0)|(1<b?e[a.charAt(1)]<<12:0)|(2<b?e[a.charAt(2)]<<6:0)|(3<b?e[a.charAt(3)]:0);a=[f(a>>>16),f(a>>>8&255),f(a&255)];a.length-=
[0,0,2,1][g];return a.join("")},B=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,n)},J=b?function(a){return(new b(a,"base64")).toString()}:function(a){return A(B(a))},N=function(a){return J(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};a.Base64={VERSION:"2.1.1",atob:B,btoa:z,fromBase64:N,toBase64:u,utob:l,encode:u,encodeURI:function(a){return u(a,!0)},btou:A,decode:N};if("function"===typeof Object.defineProperty){var P=function(a){return{value:a,enumerable:!1,
writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",P(function(){return N(this)}));Object.defineProperty(String.prototype,"toBase64",P(function(a){return u(this,a)}));Object.defineProperty(String.prototype,"toBase64URI",P(function(){return u(this,!0)}))}}}})(this);function importSTL(a,b){for(var e=!0,f=0;f<a.length;f++)if(0==a[f].charCodeAt(0)){e=!1;break}console.log("STL file is ascii: ",e);return e?importAsciiSTL(a,b):importBinarySTL(a,b)}
function importBinarySTL(a,b){var e=[],f=new BinaryReader(a);f.seek(80);for(var k=f.readUInt32(),h=[1E4,1E4,1E4],l=[-1E4,-1E4,-1E4],q=0;q<k;q++){f.readFloat();f.readFloat();f.readFloat();var z=[];z.push(f.readFloat());z.push(f.readFloat());z.push(f.readFloat());var p=[];p.push(f.readFloat());p.push(f.readFloat());p.push(f.readFloat());var u=[];u.push(f.readFloat());u.push(f.readFloat());u.push(f.readFloat());for(var r=0,v=0;3>v;v++)isNaN(z[v])&&r++,isNaN(p[v])&&r++,isNaN(u[v])&&r++;0<r&&console.log("this many bad vertices: ",
r);f.readUInt16();if(!r)for(e.push(z),e.push(p),e.push(u),v=0;3>v;v++)h[v]=Math.min(h[v],z[v]),h[v]=Math.min(h[v],p[v]),h[v]=Math.min(h[v],u[v]),l[v]=Math.max(l[v],z[v]),l[v]=Math.max(l[v],p[v]),l[v]=Math.max(l[v],u[v])}r&&console.log("WARNING: import errors: expect some missing or bad triangles\n");f=[Math.round(l[0]-(l[0]-h[0])/2),Math.round(l[1]-(l[1]-h[1])/2),Math.round(l[2]-(l[2]-h[2])/2)];return[vt2csg(e),f]}
function importAsciiSTL(a,b){for(var e="",f=[],k=0,h=0,l=[1E4,1E4,1E4],q=[-1E4,-1E4,-1E4],z=a.split("\n"),p=0;p<z.length;p++)if(!z[p].match(/facet/)&&!z[p].match(/endloop/))if(z[p].match(/outer/))var k=h=0,u=[[],[],[]];else if(z[p].match(/vertex/)){z[p]=z[p].replace(/^\s+|\s+$/g,"");var r=z[p].split(" ");u[h].push(parseFloat(r[1]));u[h].push(parseFloat(r[2]));u[h].push(parseFloat(r[3]));isNaN(u[h][0])&&k++;isNaN(u[h][1])&&k++;isNaN(u[h][2])&&k++;0<k&&(console.log("this many bad vertices: ",k),console.log("things are:",
r));if(!k&&3==++h)for(f.push(u[0]),f.push(u[1]),f.push(u[2]),r=0;3>r;r++)l[r]=Math.min(l[r],u[0][r]),l[r]=Math.min(l[r],u[1][r]),l[r]=Math.min(l[r],u[2][r]),q[r]=Math.max(q[r],u[0][r]),q[r]=Math.max(q[r],u[1][r]),q[r]=Math.max(q[r],u[2][r])}k=[Math.round(q[0]-(q[0]-l[0])/2),Math.round(q[1]-(q[1]-l[1])/2),Math.round(q[2]-(q[2]-l[2])/2)];e+=vt2csg(f);return[e,k]}
function vt2csg(a){var b;b="CSG.fromPolygons([";for(var e=0;e<a.length/3;e++){b+="new CSG.Polygon([";for(var f=0;3>f;f++)b+="new CSG.Vertex(new CSG.Vector3D([",b+=a[3*e+f]+"]))",2>f&&(b+=",");b+="])";e<a.length/3-1&&(b+=",")}return b+"])"}var BinaryReader=function(a){this._buffer=a;this._pos=0};
BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(a){this._checkSize(8*
a);var b=this._buffer.substr(this._pos,a);this._pos+=a;return b},seek:function(a){this._pos=a;this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(a,b){var e=a+b+1,f=e>>3;this._checkSize(e);var e=Math.pow(2,b-1)-1,k=this._readBits(a+b,1,f),h=this._readBits(a,b,f),l=0,q=2,z=0;do for(var p=this._readByte(++z,f),u=a%8||8,r=1<<u;r>>=1;)p&r&&(l+=1/q),q*=2;while(a-=u);this._pos+=f;return h==(e<<1)+1?l?NaN:k?-Infinity:Infinity:
(1+-2*k)*(h||l?h?Math.pow(2,h-e)*(1+l):Math.pow(2,-e+1)*l:0)},_decodeInt:function(a,b){var e=this._readBits(0,a,a/8),f=Math.pow(2,a);this._pos+=a/8;return b&&e>=f/2?e-f:e},_shl:function(a,b){for(++b;--b;a=1073741824==((a%=2147483648)&1073741824)?2*a:2*(a-1073741824)+2147483648);return a},_readByte:function(a,b){return this._buffer.charCodeAt(this._pos+b-a-1)&255},_readBits:function(a,b,e){var f=(a+b)%8,k=a%8,h=e-(a>>3)-1;a=e+(-(a+b)>>3);var l=h-a;b=this._readByte(h,e)>>k&(1<<(l?8-k:b))-1;for(l&&f&&
(b+=(this._readByte(a++,e)&(1<<f)-1)<<(l--<<3)-k);l;)b+=this._shl(this._readByte(a++,e),(l--<<3)-k);return b},_checkSize:function(a){}};var stIsIE=!1;
sorttable={init:function(){arguments.callee.done||(arguments.callee.done=!0,_timer&&clearInterval(_timer),document.createElement&&document.getElementsByTagName&&(sorttable.DATE_RE=/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,forEach(document.getElementsByTagName("table"),function(a){-1!=a.className.search(/\bsortable\b/)&&sorttable.makeSortable(a)})))},makeSortable:function(a){0==a.getElementsByTagName("thead").length&&(the=document.createElement("thead"),the.appendChild(a.rows[0]),a.insertBefore(the,
a.firstChild));null==a.tHead&&(a.tHead=a.getElementsByTagName("thead")[0]);if(1==a.tHead.rows.length){sortbottomrows=[];for(var b=0;b<a.rows.length;b++)-1!=a.rows[b].className.search(/\bsortbottom\b/)&&(sortbottomrows[sortbottomrows.length]=a.rows[b]);if(sortbottomrows){null==a.tFoot&&(tfo=document.createElement("tfoot"),a.appendChild(tfo));for(b=0;b<sortbottomrows.length;b++)tfo.appendChild(sortbottomrows[b]);delete sortbottomrows}headrow=a.tHead.rows[0].cells;for(b=0;b<headrow.length;b++)headrow[b].className.match(/\bsorttable_nosort\b/)||
((mtch=headrow[b].className.match(/\bsorttable_([a-z0-9]+)\b/))&&(override=mtch[1]),headrow[b].sorttable_sortfunction=mtch&&"function"==typeof sorttable["sort_"+override]?sorttable["sort_"+override]:sorttable.guessType(a,b),headrow[b].sorttable_columnindex=b,headrow[b].sorttable_tbody=a.tBodies[0],dean_addEvent(headrow[b],"click",sorttable.innerSortFunction=function(a){if(-1!=this.className.search(/\bsorttable_sorted\b/))sorttable.reverse(this.sorttable_tbody),this.className=this.className.replace("sorttable_sorted",
"sorttable_sorted_reverse"),this.removeChild(document.getElementById("sorttable_sortfwdind")),sortrevind=document.createElement("span"),sortrevind.id="sorttable_sortrevind",sortrevind.innerHTML=stIsIE?'&nbsp<font face="webdings">5</font>':"&nbsp;&#x25B4;",this.appendChild(sortrevind);else if(-1!=this.className.search(/\bsorttable_sorted_reverse\b/))sorttable.reverse(this.sorttable_tbody),this.className=this.className.replace("sorttable_sorted_reverse","sorttable_sorted"),this.removeChild(document.getElementById("sorttable_sortrevind")),
sortfwdind=document.createElement("span"),sortfwdind.id="sorttable_sortfwdind",sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;",this.appendChild(sortfwdind);else{theadrow=this.parentNode;forEach(theadrow.childNodes,function(a){1==a.nodeType&&(a.className=a.className.replace("sorttable_sorted_reverse",""),a.className=a.className.replace("sorttable_sorted",""))});(sortfwdind=document.getElementById("sorttable_sortfwdind"))&&sortfwdind.parentNode.removeChild(sortfwdind);
(sortrevind=document.getElementById("sorttable_sortrevind"))&&sortrevind.parentNode.removeChild(sortrevind);this.className+=" sorttable_sorted";sortfwdind=document.createElement("span");sortfwdind.id="sorttable_sortfwdind";sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;";this.appendChild(sortfwdind);row_array=[];col=this.sorttable_columnindex;rows=this.sorttable_tbody.rows;for(a=0;a<rows.length;a++)row_array[row_array.length]=[sorttable.getInnerText(rows[a].cells[col]),
rows[a]];row_array.sort(this.sorttable_sortfunction);tb=this.sorttable_tbody;for(a=0;a<row_array.length;a++)tb.appendChild(row_array[a][1]);delete row_array}}))}},guessType:function(a,b){sortfn=sorttable.sort_alpha;for(var e=0;e<a.tBodies[0].rows.length;e++)if(text=sorttable.getInnerText(a.tBodies[0].rows[e].cells[b]),""!=text){if(text.match(/^-?[?$?]?[\d,.]+%?$/))return sorttable.sort_numeric;if(possdate=text.match(sorttable.DATE_RE)){first=parseInt(possdate[1]);second=parseInt(possdate[2]);if(12<
first)return sorttable.sort_ddmm;if(12<second)return sorttable.sort_mmdd;sortfn=sorttable.sort_ddmm}}return sortfn},getInnerText:function(a){if(!a)return"";hasInputs="function"==typeof a.getElementsByTagName&&a.getElementsByTagName("input").length;if(null!=a.getAttribute("sorttable_customkey"))return a.getAttribute("sorttable_customkey");if("undefined"==typeof a.textContent||hasInputs)if("undefined"==typeof a.innerText||hasInputs)if("undefined"==typeof a.text||hasInputs)switch(a.nodeType){case 3:if("input"==
a.nodeName.toLowerCase())return a.value.replace(/^\s+|\s+$/g,"");case 4:return a.nodeValue.replace(/^\s+|\s+$/g,"");case 1:case 11:for(var b="",e=0;e<a.childNodes.length;e++)b+=sorttable.getInnerText(a.childNodes[e]);return b.replace(/^\s+|\s+$/g,"");default:return""}else return a.text.replace(/^\s+|\s+$/g,"");else return a.innerText.replace(/^\s+|\s+$/g,"");else return a.textContent.replace(/^\s+|\s+$/g,"")},reverse:function(a){newrows=[];for(var b=0;b<a.rows.length;b++)newrows[newrows.length]=a.rows[b];
for(b=newrows.length-1;0<=b;b--)a.appendChild(newrows[b]);delete newrows},sort_numeric:function(a,b){aa=parseFloat(a[0].replace(/[^0-9.-]/g,""));isNaN(aa)&&(aa=0);bb=parseFloat(b[0].replace(/[^0-9.-]/g,""));isNaN(bb)&&(bb=0);return aa-bb},sort_alpha:function(a,b){return a[0].toLowerCase()==b[0].toLowerCase()?0:a[0].toLowerCase()<b[0].toLowerCase()?-1:1},sort_ddmm:function(a,b){mtch=a[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];1==m.length&&(m="0"+m);1==d.length&&(d="0"+d);dt1=y+m+d;
mtch=b[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];1==m.length&&(m="0"+m);1==d.length&&(d="0"+d);dt2=y+m+d;return dt1==dt2?0:dt1<dt2?-1:1},sort_mmdd:function(a,b){mtch=a[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];1==m.length&&(m="0"+m);1==d.length&&(d="0"+d);dt1=y+m+d;mtch=b[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];1==m.length&&(m="0"+m);1==d.length&&(d="0"+d);dt2=y+m+d;return dt1==dt2?0:dt1<dt2?-1:1},shaker_sort:function(a,b){for(var e=0,f=a.length-1,
k=!0;k;){for(var k=!1,h=e;h<f;++h)0<b(a[h],a[h+1])&&(k=a[h],a[h]=a[h+1],a[h+1]=k,k=!0);f--;if(!k)break;for(h=f;h>e;--h)0>b(a[h],a[h-1])&&(k=a[h],a[h]=a[h-1],a[h-1]=k,k=!0);e++}}};document.addEventListener&&document.addEventListener("DOMContentLoaded",sorttable.init,!1);if(/WebKit/i.test(navigator.userAgent))var _timer=setInterval(function(){/loaded|complete/.test(document.readyState)&&sorttable.init()},10);window.onload=sorttable.init;
function dean_addEvent(a,b,e){if(a.addEventListener)a.addEventListener(b,e,!1);else{e.$$guid||(e.$$guid=dean_addEvent.guid++);a.events||(a.events={});var f=a.events[b];f||(f=a.events[b]={},a["on"+b]&&(f[0]=a["on"+b]));f[e.$$guid]=e;a["on"+b]=handleEvent}}dean_addEvent.guid=1;function removeEvent(a,b,e){a.removeEventListener?a.removeEventListener(b,e,!1):a.events&&a.events[b]&&delete a.events[b][e.$$guid]}
function handleEvent(a){var b=!0;a=a||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var e=this.events[a.type],f;for(f in e)this.$$handleEvent=e[f],!1===this.$$handleEvent(a)&&(b=!1);return b}function fixEvent(a){a.preventDefault=fixEvent.preventDefault;a.stopPropagation=fixEvent.stopPropagation;return a}fixEvent.preventDefault=function(){this.returnValue=!1};fixEvent.stopPropagation=function(){this.cancelBubble=!0};
Array.forEach||(Array.forEach=function(a,b,e){for(var f=0;f<a.length;f++)b.call(e,a[f],f,a)});Function.prototype.forEach=function(a,b,e){for(var f in a)"undefined"==typeof this.prototype[f]&&b.call(e,a[f],f,a)};String.forEach=function(a,b,e){Array.forEach(a.split(""),function(f,k){b.call(e,f,k,a)})};
var forEach=function(a,b,e){if(a){var f=Object;if(a instanceof Function)f=Function;else{if(a.forEach instanceof Function){a.forEach(b,e);return}"string"==typeof a?f=String:"number"==typeof a.length&&(f=Array)}f.forEach(a,b,e)}};