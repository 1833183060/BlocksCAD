// Do not edit this file; automatically generated by blockscad_build.py.
"use strict";
var BlocklyStorage=BlocklyStorage||{},Blockscad=Blockscad||{};Blockscad.Auth=Blockscad.Auth||{};var Blockly=Blockly||{};Blockly.Xml=Blockly.Xml||{};
BlocklyStorage.backupBlocks_=function(){console.log("in backupBlocks");if("localStorage"in window){localStorage.clear();for(var a=Blockly.Xml.workspaceToDom(Blockscad.workspace),d=window.location.href.split("#")[0],e=d+"proj_name",k=d+"current_project",r=Blockscad.workspace.getAllBlocks(),h=0;h<r.length;h++)if("stl_import"==r[h].type){var l=r[h].getField("STL_CONTENTS").getText();if(0<l.length){var m=d+l,w=d+l+"center";if(3E6>Blockscad.csg_commands[l].length){var n=Base64.toBase64(RawDeflate.deflate(Base64.utob(Blockscad.csg_commands[l])));
window.localStorage.setItem(m,n);window.localStorage.setItem(w,Blockscad.csg_center[l])}}}window.localStorage.setItem(d,Blockly.Xml.domToText(a));window.localStorage.setItem(e,$("#project-name").val());window.localStorage.setItem(k,Blockscad.Auth.current_project)}};BlocklyStorage.backupOnUnload=function(){window.addEventListener("unload",BlocklyStorage.backupBlocks_,!1)};
BlocklyStorage.restoreBlocks=function(){var a=window.location.href.split("#")[0],d=a+"proj_name",e=a+"current_project";console.log(window.localStorage);if("localStorage"in window&&window.localStorage[a]){var k=Blockly.Xml.textToDom(window.localStorage[a]);Blockly.Xml.domToWorkspace(Blockscad.workspace,k);for(var k=Blockscad.workspace.getAllBlocks(),r=0;r<k.length;r++)if("stl_import"==k[r].type){var h=k[r].getField("STL_CONTENTS").getText(),l=k[r].getField("STL_FILENAME").getText(),m=k[r].getField("STL_BUTTON");
if(0<h.length){var w=window.localStorage[a+h],n=window.localStorage[a+h+"center"];w&&0<w.length&&(m.setVisible(!1),console.log("csg contents compressed length is:",w.length),m=Base64.btou(RawDeflate.inflate(Base64.fromBase64(w))),console.log("decompressed lengeth is:",m.length),Blockscad.csg_commands[h]=m,Blockscad.csg_filename[h]=l+":::",Blockscad.csg_center[h]=n,k[r].render())}else{console.log("couldn't find the stuff in localStorage");$("#error-message").html("Warning: Re-load your .STL files");
k[r].getField("STL_CONTENTS").setText("");k[r].getField("STL_FILENAME").setText("");h=k[r].getCommentText();h.match(/^RELOAD/)||(h="RELOAD: "+h);k[r].setCommentText(h);m.setText("Reload");k[r].backlight();if(h=k[r].collapsedParents())for(l=0;l<h.length;l++)h[l].backlight();k[r].isCollapsed()||m.setVisible(!0);m=k[r];for(h=null;m;)m.isCollapsed()&&(h=m),m=m.getSurroundParent();h&&h.setCollapsed(!0,!0);k[r].render()}}a=window.localStorage[d];"undefined"!=a?$("#project-name").val(a):$("#project-name").val("Untitled");
e=window.localStorage[e];Blockscad.Auth.currentProject="undefined"!=e?e:""}};var BSUtils=BSUtils||{};BSUtils.LANGUAGE_NAME={en:"English",es:"Espa\u00f1ol"};BSUtils.LANGUAGE_RTL=["ar","fa","he"];BSUtils.LANGUAGES=void 0;BSUtils.getStringParamFromUrl=function(a,d){var e=window.location.search.match(new RegExp("[?&]"+a+"=([^&]+)"));return e?decodeURIComponent(e[1].replace(/\+/g,"%20")):d};BSUtils.getLang=function(){var a=BSUtils.getStringParamFromUrl("lang","");void 0===BSUtils.LANGUAGE_NAME[a]&&(a="en");return a};BSUtils.LANG=BSUtils.getLang();
BSUtils.isRtl=function(){return-1!=BSUtils.LANGUAGE_RTL.indexOf(BSUtils.LANG)};
BSUtils.init=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);for(var a=[],d,e=0;e<BSUtils.LANGUAGES.length;e++)d=BSUtils.LANGUAGES[e],a.push([BSUtils.LANGUAGE_NAME[d],d]);a.sort(function(a,e){return a[0]>e[0]?1:a[0]<e[0]?-1:0});for(var k=document.getElementById("languageMenu"),e=k.options.length=0;e<a.length;e++){var r=a[e];d=r[r.length-1];r=new Option(r[0],d);d==BSUtils.LANG&&(r.selected=
!0);k.options.add(r)}k.addEventListener("change",BSUtils.changeLanguage,!0);document.getElementById("codeButton")&&BSUtils.bindClick("codeButton",BSUtils.showCode);(a=document.querySelector('meta[name="viewport"]'))&&725>screen.availWidth&&a.setAttribute("content","width=725, initial-scale=.35, user-scalable=no")};
BSUtils.initReadonly=function(){Blockly.inject(document.getElementById("blockly"),{path:"./",readOnly:!0,rtl:BSUtils.isRtl(),scrollbars:!1});var a=BSUtils.getStringParamFromUrl("xml",""),a=Blockly.Xml.textToDom("<xml>"+a+"</xml>");Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)};
BSUtils.loadBlocks=function(a){try{var d=window.sessionStorage.loadOnceBlocks}catch(e){d=null}"BlocklyStorage"in window&&1<window.location.hash.length?BlocklyStorage.retrieveXml(window.location.hash.substring(1)):d?(delete window.sessionStorage.loadOnceBlocks,a=Blockly.Xml.textToDom(d),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):a?(a=Blockly.Xml.textToDom(a),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,a)):"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)};
BSUtils.changeLanguage=function(){if("undefined"!=typeof Blockly&&window.sessionStorage){var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),a=Blockly.Xml.domToText(a);window.sessionStorage.loadOnceBlocks=a}var a=document.getElementById("languageMenu"),a=encodeURIComponent(a.options[a.selectedIndex].value),d=window.location.search,d=1>=d.length?"?lang="+a:d.match(/[?&]lang=[^&]*/)?d.replace(/([?&]lang=)[^&]*/,"$1"+a):d.replace(/\?/,"?lang="+a+"&");window.location=window.location.protocol+"//"+
window.location.host+window.location.pathname+d};BSUtils.isDialogVisible_=!1;BSUtils.dialogOrigin_=null;BSUtils.dialogDispose_=null;
BSUtils.showDialog=function(a,d,e,k,r,h){function l(){BSUtils.isDialogVisible_&&(m.style.visibility="visible",m.style.zIndex=1,w.style.visibility="hidden")}BSUtils.isDialogVisible_&&BSUtils.hideDialog(!1);BSUtils.isDialogVisible_=!0;BSUtils.dialogOrigin_=d;BSUtils.dialogDispose_=h;var m=document.getElementById("dialog");h=document.getElementById("dialogShadow");var w=document.getElementById("dialogBorder"),n;for(n in r)m.style[n]=r[n];k&&(h.style.visibility="visible",h.style.opacity=.3,k=document.createElement("div"),
k.id="dialogHeader",m.appendChild(k),BSUtils.dialogMouseDownWrapper_=Blockly.bindEvent_(k,"mousedown",null,BSUtils.dialogMouseDown_));m.appendChild(a);a.className=a.className.replace("dialogHiddenContent","");e&&d?(BSUtils.matchBorder_(d,!1,.2),BSUtils.matchBorder_(m,!0,.8),window.setTimeout(l,175)):l()};BSUtils.dialogStartX_=0;BSUtils.dialogStartY_=0;
BSUtils.dialogMouseDown_=function(a){BSUtils.dialogUnbindDragEvents_();if(!Blockly.isRightButton(a)){var d=document.getElementById("dialog");BSUtils.dialogStartX_=d.offsetLeft-a.clientX;BSUtils.dialogStartY_=d.offsetTop-a.clientY;BSUtils.dialogMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",null,BSUtils.dialogUnbindDragEvents_);BSUtils.dialogMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",null,BSUtils.dialogMouseMove_);a.stopPropagation()}};
BSUtils.dialogMouseMove_=function(a){var d=document.getElementById("dialog"),e=BSUtils.dialogStartX_+a.clientX;a=BSUtils.dialogStartY_+a.clientY;a=Math.max(a,0);a=Math.min(a,window.innerHeight-d.offsetHeight);e=Math.max(e,0);e=Math.min(e,window.innerWidth-d.offsetWidth);d.style.left=e+"px";d.style.top=a+"px"};
BSUtils.dialogUnbindDragEvents_=function(){BSUtils.dialogMouseUpWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseUpWrapper_),BSUtils.dialogMouseUpWrapper_=null);BSUtils.dialogMouseMoveWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseMoveWrapper_),BSUtils.dialogMouseMoveWrapper_=null)};
BSUtils.hideDialog=function(a){function d(){k.style.visibility="hidden";r.style.visibility="hidden"}if(BSUtils.isDialogVisible_){BSUtils.dialogUnbindDragEvents_();BSUtils.dialogMouseDownWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseDownWrapper_),BSUtils.dialogMouseDownWrapper_=null);BSUtils.isDialogVisible_=!1;BSUtils.dialogDispose_&&BSUtils.dialogDispose_();BSUtils.dialogDispose_=null;var e=!1===a?null:BSUtils.dialogOrigin_;a=document.getElementById("dialog");var k=document.getElementById("dialogShadow"),
r=document.getElementById("dialogBorder");k.style.opacity=0;e?(BSUtils.matchBorder_(a,!1,.8),BSUtils.matchBorder_(e,!0,.2),window.setTimeout(d,175)):d();a.style.visibility="hidden";a.style.zIndex=-1;for((e=document.getElementById("dialogHeader"))&&e.parentNode.removeChild(e);a.firstChild;)e=a.firstChild,e.className+=" dialogHiddenContent",document.body.appendChild(e)}};
BSUtils.matchBorder_=function(a,d,e){function k(){r.style.width=h.width+"px";r.style.height=h.height+"px";r.style.left=h.x+"px";r.style.top=h.y+"px";r.style.opacity=e}if(a){var r=document.getElementById("dialogBorder"),h=BSUtils.getBBox_(a);d?(r.className="dialogAnimate",window.setTimeout(k,1)):(r.className="",k());r.style.visibility="visible"}};
BSUtils.getBBox_=function(a){var d=a.offsetHeight,e=a.offsetWidth,k=0,r=0;do k+=a.offsetLeft,r+=a.offsetTop,a=a.offsetParent;while(a);return{height:d,width:e,x:k,y:r}};
BSUtils.storageAlert=function(a){var d=document.getElementById("containerStorage");d.textContent="";a=a.split("\n");for(var e=0;e<a.length;e++){var k=document.createElement("p");k.appendChild(document.createTextNode(a[e]));d.appendChild(k)}d=document.getElementById("dialogStorage");a=document.getElementById("linkButton");BSUtils.showDialog(d,a,!0,!0,{width:"50%",left:"25%",top:"5em"},BSUtils.stopDialogKeyDown());BSUtils.startDialogKeyDown()};
BSUtils.dialogKeyDown_=function(a){!BSUtils.isDialogVisible_||13!=a.keyCode&&27!=a.keyCode&&32!=a.keyCode||(BSUtils.hideDialog(!0),a.stopPropagation(),a.preventDefault())};BSUtils.startDialogKeyDown=function(){document.body.addEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.stopDialogKeyDown=function(){document.body.removeEventListener("keydown",BSUtils.dialogKeyDown_,!0)};BSUtils.getMsg=function(a){var d=BSUtils.getMsgOrNull(a);return null===d?"[Unknown message: "+a+"]":d};
BSUtils.getMsgOrNull=function(a){return(a=document.getElementById(a))?(a=a.textContent,a=a.replace(/\\n/g,"\n")):null};BSUtils.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var a=document.getElementsByTagName("button"),d=0,e;e=a[d];d++)e.ontouchend||(e.ontouchend=e.onclick)};window.addEventListener("load",BSUtils.addTouchEvents,!1);
BSUtils.bindClick=function(a,d){"string"==typeof a&&(a=document.getElementById(a));a.addEventListener("click",d,!0);a.addEventListener("touchend",d,!0)};Blockscad=Blockscad||{};Blockscad.Toolbox=Blockscad.Toolbox||{};Blockscad.Auth=Blockscad.Auth||{};BlocklyStorage=BlocklyStorage||{};Blockly=Blockly||{};BSUtils=BSUtils||{};Blockscad.version="1.0.1";Blockscad.offline=!0;var gCurrentFile=null,gProcessor=null,editor=null,gCurrentFiles=[],gMemFs=[],gMemFsCount=0,gMemFsTotal=0,gMemFsChanged=0,gRootFs=[],_includePath="./";Blockscad.drawAxes=1;
Blockscad.init=function(){function a(a,d){var r=a.target.files[0];if(r){var h;d&&(h=r.name.substr(0,r.name.lastIndexOf("("))||r.name,h=h.substr(0,r.name.lastIndexOf("."))||h,h=h.replace(/^\s+|\s+$/g,""));!Blockscad.offline&&d&&(Blockscad.Auth.isLoggedIn&&0<Blockscad.undo.undoStack.length&&(console.log("autosaving!"),Blockscad.Auth.saveBlocksToAccount()),Blockscad.Auth.currentProject="");d&&Blockly.getMainWorkspace().clear();var l={},m=new FileReader;m.onload=function(a){l=a.target.result;a=Blockly.Xml.textToDom(l);
Blockly.Xml.domToWorkspace(Blockscad.workspace,a);Blockly.fireUiEvent(window,"resize");Blockscad.clearStlBlocks()};m.readAsText(r);$("#importLocal")[0].value="";$("#loadLocal")[0].value="";d&&$("#project-name").val(h);$("#projView").hide();$("#editView").show();$("#displayBlocks").click()}else alert("Failed to load file")}Blockscad.initLanguage();BSUtils.isRtl();Blockscad.missingFields=[];Blockscad.csg_commands={};Blockscad.csg_filename={};Blockscad.csg_center=[0,0,0];var d=document.getElementById("main");
window.addEventListener("resize",function(a){a=BSUtils.getBBox_(d);var k=document.getElementById("blocklyDiv");k.style.top=a.y+"px";k.style.left=a.x+"px";k.style.height=a.height-88+"px";k.style.width=a.width+"px";gProcessor&&gProcessor.viewer.rendered_resize(gProcessor.viewerdiv.offsetWidth,gProcessor.viewerdiv.offsetHeight);70>$("#main").height()-$(".resizableDiv").height()&&$(".resizableDiv").height($("#main").height()-70);20>$("#main").width()-$(".resizableDiv").width()&&$(".resizableDiv").width($("#main").width()-
20);$(".resizableDiv").position({of:$("#main"),my:"right top",at:"right top",offset:"-12 -55"})},!1);Blockscad.workspace=Blockly.inject(document.getElementById("blocklyDiv"),{media:"blockly/media/",zoom:{enabled:!0,scaleSpeed:1.1,controls:!0},trashcan:!1,toolbox:Blockscad.Toolbox.adv});Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one);Blockscad.Toolbox.setCatColors();$("#advancedToolbox").hide();BSUtils.loadBlocks("");"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload();$(".resizableDiv").resizable({handles:"s,w,sw",
resize:function(a,d){var r=$(window).height();gProcessor&&(r=gProcessor.viewerdiv.offsetHeight,gProcessor.viewer.rendered_resize(gProcessor.viewerdiv.offsetWidth,r));20>$("#main").width()-d.size.width&&(d.size.width=$("#main").width()-20);70>$("#main").height()-d.size.height&&(d.size.height=$("#main").height()-70);d.position.left=$(window).width()-(d.size.width+12);d.position.top=55}});Blockly.fireUiEvent(window,"resize");Blockscad.offline||Blockscad.Auth.init();BSUtils.bindClick("trashButton",function(){Blockscad.discard()});
BSUtils.bindClick("renderButton",Blockscad.doRender);BSUtils.bindClick("undoButton",Blockscad.onUndo);BSUtils.bindClick("redoButton",Blockscad.onRedo);$("#axesButton").click(function(){Blockscad.drawAxes=(Blockscad.drawAxes+1)%2;$("#axesButton").toggleClass("btn-pushed");gProcessor.viewer.onDraw()});$("#displayCode").click(function(){var a=document.getElementById("openScadPre"),d=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace);a.textContent=d;"function"==typeof prettyPrintOne&&(d=a.innerHTML,
d=prettyPrintOne(d,"js"),a.innerHTML=d);Blockly.fireUiEvent(window,"resize")});$("#renderButton").prop("disabled",!0);$("#throw-it-away").click(Blockscad.clearProject);$("#main").on("click",".new-project",Blockscad.newProject);Blockscad.readStlFile=function(a){var d=a.target.files[0];d?(a=new FileReader,a.onload=function(a){a=importSTL(a.target.result);var e=a[0];(a=a[1])||(a="blah");for(var l=d.name.substr(0,d.name.lastIndexOf("("))||d.name,l=l.substr(0,d.name.lastIndexOf("."))||l,m=l=l.replace(/^\s+|\s+$/g,
""),w=1,n=0;Blockscad.csg_commands[m]&&!n;)e!=Blockscad.csg_commands[m]?(m=l+"_"+w,w++):n=1;Blockscad.csg_commands[m]=e;Blockscad.csg_filename[m]=n?Blockscad.csg_filename[m]+(d.name+":::"):d.name+":::";Blockscad.csg_center[m]=a;Blockscad.currentInterestingBlock?(l=Blockscad.currentInterestingBlock.getField("STL_FILENAME"),e=Blockscad.currentInterestingBlock.getField("STL_BUTTON"),w=Blockscad.currentInterestingBlock.getField("STL_CONTENTS"),l.setText(d.name),l.setVisible(!0),e.setVisible(!1),w.setText(m),
Blockscad.currentInterestingBlock.setCommentText(d.name+"\ncenter:("+a+")"),Blockscad.currentInterestingBlock=null):(m=Blockly.Xml.textToDom('<xml xmlns="http://www.w3.org/1999/xhtml"><block type="stl_import" id="1" x="10" y="10"><field name="STL_FILENAME">'+d.name+'</field><field name="STL_BUTTON">Browse</field><field name="STL_CONTENTS">'+m+"</field></block></xml>"),m=Blockly.Xml.domToBlock(Blockscad.workspace,m.firstChild),e=m.getField("STL_BUTTON"),e.setVisible(!1),m.setCommentText(d.name+"\ncenter:("+
a+")"),m.render())},a.readAsBinaryString(d),$("#importStl")[0].value="",$("#displayBlocks").click(),$("#renderButton").prop("disabled",!1)):alert("Failed to load file")};$("#file-menu").on("change","#loadLocal",function(d){a(d,!0)});$("#file-menu").on("change","#importLocal",function(d){a(d,!1)});$("#file-menu").on("change","#importStl",function(a){Blockscad.readStlFile(a)});gProcessor=new Blockscad.Processor(document.getElementById("renderDiv"));BSUtils.bindClick("viewReset",Blockscad.resetView);
Blockscad.undo={blockList:[],oldBlockList:[],undoStack:[],redoStack:[],current_xml:null,blockCount:0,yesthis:0,fieldChanging:0,blockIds:[],fieldValues:[],parentIds:[],oldBlockIds:[],oldFieldValues:[],oldParentIds:[],just_did_undo:0};Blockscad.workspace.addUndoListener(Blockscad.workspaceChanged);Blockscad.offline||Blockscad.Auth.checkForUser();$("#help-menu").on("click","#about",function(){$("#about-modal").modal("show")});$("#file-menu").on("click","#saveLocal",Blockscad.saveBlocksLocal);$("#simpleToolbox").on("click",
function(){console.log("switching to simple toolbox");$("#simpleToolbox").hide();$("#advancedToolbox").show();Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.sim),Blockscad.Toolbox.setCatColors())});$("#advancedToolbox").on("click",function(){console.log("switching to advanced toolbox");$("#advancedToolbox").hide();$("#simpleToolbox").show();Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.adv),
Blockscad.Toolbox.setCatColors())});$("#colors_one").on("click",function(){console.log("switching block color scheme");Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one),Blockscad.Toolbox.setCatColors(),Blockscad.workspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});$("#colors_two").on("click",function(){console.log("switching block color scheme");Blockscad.workspace&&(Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.two),
Blockscad.Toolbox.setCatColors(),Blockscad.workspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml))});$(function(){$(".dropdown-menu > li > a.trigger").on("click",function(a){var d=$(this).next(),r=$(this).parent().parent();($(this).hasClass("left-caret")||$(this).hasClass("right-caret"))&&$(this).toggleClass("right-caret left-caret");r.find(".left-caret").not(this).toggleClass("right-caret left-caret");r.find(".sub-menu:visible").not(d).hide();d.toggle();a.stopPropagation()});
$(".dropdown-menu > li > a:not(.trigger)").on("click",function(){var a=$(this).closest(".dropdown");a.find(".left-caret").toggleClass("right-caret left-caret");a.find(".sub-menu:visible").hide()})})};document.write('<script src="blockly/msg/js/'+BSUtils.LANG+'.js">\x3c/script>\n');window.addEventListener("load",Blockscad.init);
Blockscad.clearStlBlocks=function(){for(var a=Blockscad.workspace.getAllBlocks(),d=0;d<a.length;d++)if("stl_import"==a[d].type){var e=a[d].getField("STL_BUTTON");a[d].getField("STL_CONTENTS").setText("");a[d].getField("STL_FILENAME").setText("");var k=a[d].getCommentText();k.match(/^RELOAD/)||(k="RELOAD: "+k);a[d].setCommentText(k);e.setText("Reload");a[d].backlight();if(k=a[d].collapsedParents())for(var r=0;r<k.length;r++)k[r].backlight();a[d].isCollapsed()||e.setVisible(!0);e=a[d];for(k=null;e;)e.isCollapsed()&&
(k=e),e=e.getSurroundParent();k&&k.setCollapsed(!0,!0);a[d].render();$("#error-message").html("Warning: re-load your STL file block")}};Blockscad.newProject=function(){0<Blockscad.undo.undoStack.length?!Blockscad.offline&&Blockscad.Auth.isLoggedIn?(console.log("autosaving"),Blockscad.Auth.saveBlocksToAccount(),Blockscad.clearProject()):$("#delete-confirm").modal("show"):Blockscad.clearProject();$("#displayBlocks").click()};
Blockscad.clearProject=function(){Blockscad.offline||(Blockscad.Auth.currentProject="",Blockscad.Auth.currentProjectKey="");Blockscad.workspace.clear();gProcessor.clearViewer();for(Blockscad.workspaceChanged();Blockscad.undo.undoStack.length;)Blockscad.undo.undoStack.pop();for(;Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop();$("#project-name").val("Untitled");$("#projectView").hide();$("#editView").show()};
Blockscad.discard=function(){var a=Blockly.mainWorkspace.getAllBlocks().length;if(2>a||window.confirm("Delete all "+a+" blocks?"))Blockly.mainWorkspace.clear(),window.location.hash=""};Blockscad.resetView=function(){gProcessor&&gProcessor.viewer&&gProcessor.viewer.viewReset()};
Blockscad.mixes2and3D=function(){for(var a=[],a=Blockly.mainWorkspace.getTopBlocks(),d=0,e=0,k=0,r=0,h=0;h<a.length;h++)if(Blockscad.stackIsShape(a[h])){var r=1,l=a[h].category,m;"PRIMITIVE_CSG"==l&&d++;"PRIMITIVE_CAG"==l&&e++;if("TRANSFORM"==l||"SET_OP"==l)m=a[h].getInput("A").connection.check_,1==m.length&&"CSG"==m[0]&&d++,1==m.length&&"CAG"==m[0]&&e++;"LOOP"==l&&(m=a[h].getInput("DO").connection.check_,1==m.length&&"CSG"==m[0]&&d++,1==m.length&&"CAG"==m[0]&&e++);"PROCEDURE"==l&&((m=a[h].myType_)&&
"CSG"==m&&d++,m&&"CAG"==m&&e++);"COLOR"==l&&d++;"EXTRUDE"==l&&d++;"controls_if"==a[h].type&&k++}!r||d+e+k||Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks());return[d&&e,r]};
Blockscad.doRender=function(){$("#error-message").html("");$("#error-message").removeClass("has-error");$("#renderButton").prop("disabled",!0);gProcessor.clearViewer();var a=Blockscad.mixes2and3D();if(0===a[1])$("#error-message").html("Error: Nothing to Render"),$("#error-message").addClass("has-error");else if(a[0])$("#error-message").html("Error: both 2D and 3D objects are present.  There can be only one."),$("#error-message").addClass("has-error");else{Blockscad.missingFields=[];Blockscad.illegalValue=
[];var a=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),d=!1;if(0<Blockscad.missingFields.length)for(var e=0;e<Blockscad.missingFields.length;e++){d=Blockly.mainWorkspace.getBlockById(Blockscad.missingFields[e]);d.unselect();d.backlight();if(d=d.collapsedParents())for(var k=0;k<d.length;k++)d[k].unselect(),d[k].backlight();d=!0}if(0<Blockscad.illegalValue.length){for(e=0;e<Blockscad.illegalValue.length;e++)if(d=Blockly.mainWorkspace.getBlockById(Blockscad.illegalValue[e]),d.unselect(),d.backlight(),
d=d.collapsedParents())for(k=0;k<d.length;k++)d[k].unselect(),d[k].backlight();d=!0}if(d)a="",Blockscad.missingFields.length&&(a+="ERROR: "+Blockscad.missingFields.length+" blocks are missing fields."),Blockscad.missingFields.length&&Blockscad.illegalValue.length&&(a+="<br>"),Blockscad.illegalValue.length&&(a+="ERROR: "+Blockscad.illegalValue.length+" blocks have an illegal negative or zero value"),$("#error-message").html(a),$("#error-message").addClass("has-error");else if(Blockscad.loadTheseFonts=
Blockscad.whichFonts(a),$("#renderButton").html("working"),0<Blockscad.loadTheseFonts.length)for(console.log("I need to load "+Blockscad.loadTheseFonts.length+" fonts."),e=Blockscad.numloaded=0;e<Blockscad.loadTheseFonts.length;e++)Blockscad.loadFontThenRender(e,a);else Blockscad.renderCode(a)}};
Blockscad.renderCode=function(a){var d="",e=!0;try{window.setTimeout(function(){d=openscadOpenJscadParser.parse(a)},0)}catch(k){$("#error-message").html(k),$("#error-message").addClass("has-error"),e=!1}e?window.setTimeout(function(){gProcessor.setBlockscad(d)},0):$("#renderButton").html("Render")};
Blockscad.isRealChange=function(){Blockscad.undo.blockIds=[];Blockscad.undo.parentIds=[];Blockscad.undo.fieldValues=[];Blockscad.undo.isDisabled=[];for(var a=null,a=a=null,d=!1,e=0;e<Blockscad.undo.blockList.length;e++)Blockscad.undo.fieldValues[e]=Blockscad.undo.blockList[e].getAllFieldValues(),Blockscad.undo.blockIds[e]=Blockscad.undo.blockList[e].id,Blockscad.undo.isDisabled[e]=Blockscad.undo.blockList[e].disabled,Blockscad.undo.blockList[e].getParent()?Blockscad.undo.parentIds[e]=Blockscad.undo.blockList[e].getParent().id:
Blockscad.undo.parentIds[e]=null,Blockscad.undo.blockList[e].category&&"UNKNOWN"==Blockscad.undo.blockList[e].category&&Blockscad.undo.blockList[e].getType();if(Blockscad.undo.blockCount>Blockscad.undo.blockList.length)return Blockscad.undo.fieldChanging=0,0!==Blockscad.undo.blockList.length&&(a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList),(a=Blockscad.getBlockFromId(Blockscad.undo.oldParentIds[a],Blockscad.undo.blockList))&&Blockscad.assignBlockTypes([a])),!0;
if(Blockscad.undo.blockCount<Blockscad.undo.blockList.length)return Blockscad.undo.fieldChanging=0,0===Blockscad.undo.oldBlockList.length?Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()):(a=Blockscad.getExtraRootBlock(Blockscad.undo.oldBlockList,Blockscad.undo.blockList),Blockscad.assignBlockTypes([Blockscad.undo.blockList[a]])),!0;for(e=0;e<Blockscad.undo.blockIds.length;e++){for(var k=Blockscad.undo.blockIds[e],r=0,a=0;a<Blockscad.undo.blockIds.length;a++)if(k==Blockscad.undo.oldBlockIds[a]){r=
1;if(Blockscad.undo.parentIds[e]!=Blockscad.undo.oldParentIds[a]){Blockscad.assignBlockTypes([Blockscad.undo.blockList[e]]);for(d=0;e=Blockscad.undo.blockList[d];d++)if(e.id==Blockscad.undo.oldParentIds[a]){Blockscad.assignBlockTypes([Blockscad.undo.blockList[d]]);break}return!0}if(Blockscad.undo.fieldValues[e]!=Blockscad.undo.oldFieldValues[a])return $("#renderButton").prop("disabled",!1),Blockscad.undo.fieldChanging!=k?(Blockscad.undo.fieldChanging=k,!0):!1;Blockscad.undo.isDisabled[e]!=Blockscad.undo.oldDisabled[a]&&
(d=!0)}if(!r)return!0}return d?!0:!1};
Blockscad.workspaceChanged=function(){Blockscad.undo.yesthis=0;Blockscad.undo.blockList=Blockly.mainWorkspace.getAllBlocks();Blockscad.undo.yesthis=Blockscad.isRealChange();Blockscad.undo.blockCount=Blockscad.undo.blockList.length;Blockscad.undo.oldBlockIds=Blockscad.undo.blockIds;Blockscad.undo.oldParentIds=Blockscad.undo.parentIds;Blockscad.undo.oldFieldValues=Blockscad.undo.fieldValues;Blockscad.undo.oldDisabled=Blockscad.undo.isDisabled;if(Blockscad.undo.yesthis&&($("#renderButton").prop("disabled",
!1),Blockscad.undo.just_did_undo&&Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()),0===Blockscad.undo.just_did_undo)){null!==Blockscad.undo.current_xml&&Blockscad.undo.undoStack.push(Blockscad.undo.current_xml);for(Blockscad.undo.current_xml=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());0<Blockscad.undo.redoStack.length;)Blockscad.undo.redoStack.pop();50<Blockscad.undo.undoStack.length&&Blockscad.undo.undoStack.shift()}Blockscad.undo.current_xml=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
Blockscad.undo.oldBlockList=[];for(var a=0;a<Blockscad.undo.blockList.length;a++)Blockscad.undo.oldBlockList.push(Blockly.Xml.blockToDom_(Blockscad.undo.blockList[a]));Blockscad.undo.just_did_undo=0;0<Blockscad.undo.undoStack.length?$("#undoButton").prop("disabled",!1):$("#undoButton").prop("disabled",!0);0<Blockscad.undo.redoStack.length?$("#redoButton").prop("disabled",!1):$("#redoButton").prop("disabled",!0)};
Blockscad.getExtraRootBlock=function(a,d){var e=0;if(a.length>d.length)for(var k=0;k<a.length;k++){for(var r=e=0;r<d.length;r++)if(a[k].getAttribute("id")==d[r].id){e=1;break}if(!e)return k}else for(k=0;k<d.length;k++){for(r=e=0;r<a.length;r++)if(d[k].id==a[r].getAttribute("id")){e=1;break}if(!e)return k}return 0};Blockscad.getBlockFromId=function(a,d){for(var e=0,k;k=d[e];e++)if(k.id==a)return k;return null};
Blockscad.onUndo=function(){0<Blockscad.undo.undoStack.length&&(Blockscad.undo.redoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.undoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};
Blockscad.onRedo=function(){0<Blockscad.undo.redoStack.length&&(Blockscad.undo.undoStack.push(Blockscad.undo.current_xml),Blockscad.undo.current_xml=Blockscad.undo.redoStack.pop(),Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockscad.workspace,Blockscad.undo.current_xml),Blockly.mainWorkspace.render(),Blockscad.undo.just_did_undo=1)};Blockscad.aCallerBlock=function(a,d){for(var e=0;e<d.length;e++)if(a==d[e])return!0;return!1};
Blockscad.findBlockType=function(a,d){for(var e=a.getRootBlock().getDescendants(),k=0,r=0,h=0;h<e.length;h++)if(!Blockscad.aCallerBlock(e[h],d)&&e[h].category){var l=e[h].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){k=1;break}"PRIMITIVE_CAG"==l&&(r=1)}return k?Blockscad.hasExtrudeParent(a)?"CAG":"CSG":r?"CAG":"EITHER"};Blockscad.stackIsShape=function(a){a=a.getDescendants();for(var d=0;d<a.length;d++){var e=a[d];if(("PRIMITIVE_CSG"==e.category||"PRIMITIVE_CAG"==e.category)&&!e.hasDisabledParent())return!0}return!1};
Blockscad.assignBlockTypes=function(a){for(var d=0;d<a.length;d++){for(var e=a[d].getRootBlock().getDescendants(),k=0,r=0,h=0;h<e.length;h++)if(e[h].category){var l=e[h].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){k=1;break}"PRIMITIVE_CAG"==l&&(r=1)}for(h=0;h<e.length;h++)!e[h].category||"TRANSFORM"!=e[h].category&&"SET_OP"!=e[h].category&&"PROCEDURE"!=e[h].category&&"LOOP"!=e[h].category||(l=!e[h].collapsedParents(),k?Blockscad.hasExtrudeParent(e[h])?e[h].setType("CAG",l):e[h].setType("CSG",
l):r?e[h].setType("CAG",l):e[h].setType(["CSG","CAG"],l))}};Blockscad.hasExtrudeParent=function(a){do{if("EXTRUDE"==a.category)return!0;a=a.parentBlock_}while(a);return!1};function putSourceInEditor(a,d){editor.setValue(a);editor.clearSelection();editor.navigateFileStart();previousFilename=d;previousScript=a;gPreviousModificationTime=""}
Blockscad.initLanguage=function(){var a=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",a?"rtl":"ltr");document.head.parentElement.setAttribute("lang",BSUtils.LANG);var a=[],d;for(d in BSUtils.LANGUAGE_NAME)a.push([BSUtils.LANGUAGE_NAME[d],d]);a.sort(function(a,d){return a[0]>d[0]?1:a[0]<d[0]?-1:0});for(var e=document.getElementById("languageMenu"),k=e.options.length=0;k<a.length;k++){var r=a[k];d=r[r.length-1];r=new Option(r[0],d);d==BSUtils.LANG&&(r.selected=!0);e.options.add(r)}e.addEventListener("change",
BSUtils.changeLanguage,!0)};Blockscad.saveBlocksLocal=function(){var a=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()),a=Blockly.Xml.domToText(a),a=new Blob([a],{type:"text/plain;charset=utf-8"}),d=$("#project-name").val();d?saveAs(a,d+".xml"):alert("SAVE FAILED.  Please give your project a name, then try again.")};var fileSaver={},saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var d=a.document,e=a.URL||a.webkitURL||a,k=d.createElementNS("http://www.w3.org/1999/xhtml","a"),r=!a.externalHost&&"download"in k,h=a.webkitRequestFileSystem,l=a.requestFileSystem||h||a.mozRequestFileSystem,m=function(d){(a.setImmediate||a.setTimeout)(function(){throw d;},0)},
w=0,n=[],u=function(){for(var a=n.length;a--;){var d=n[a];"string"===typeof d?e.revokeObjectURL(d):d.remove()}n.length=0},t=function(a,d,e){d=[].concat(d);for(var h=d.length;h--;){var k=a["on"+d[h]];if("function"===typeof k)try{k.call(a,e||a)}catch(r){m(r)}}},v=function(e,m){var p=this,v=e.type,q=!1,A,g,u=function(){var b=(a.URL||a.webkitURL||a).createObjectURL(e);n.push(b);return b},x=function(){t(p,["writestart","progress","write","writeend"])},H=function(){if(q||!A)A=u(e);g?g.location.href=A:window.open(A,
"_blank");p.readyState=p.DONE;x()},c=function(b){return function(){if(p.readyState!==p.DONE)return b.apply(this,arguments)}},f={create:!0,exclusive:!1},b;p.readyState=p.INIT;m||(m="download");if(r)A=u(e),d=a.document,k=d.createElementNS("http://www.w3.org/1999/xhtml","a"),k.href=A,k.download=m,v=d.createEvent("MouseEvents"),v.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),k.dispatchEvent(v),p.readyState=p.DONE,x();else{a.chrome&&v&&"application/octet-stream"!==v&&(b=e.slice||e.webkitSlice,
e=b.call(e,0,e.size,"application/octet-stream"),q=!0);h&&"download"!==m&&(m+=".download");if("application/octet-stream"===v||h)g=a;l?(w+=e.size,l(a.TEMPORARY,w,c(function(b){b.root.getDirectory("saved",f,c(function(b){var a=function(){b.getFile(m,f,c(function(b){b.createWriter(c(function(c){c.onwriteend=function(c){g.location.href=b.toURL();n.push(b);p.readyState=p.DONE;t(p,"writeend",c)};c.onerror=function(){var b=c.error;b.code!==b.ABORT_ERR&&H()};["writestart","progress","write","abort"].forEach(function(b){c["on"+
b]=p["on"+b]});c.write(e);p.abort=function(){c.abort();p.readyState=p.DONE};p.readyState=p.WRITING}),H)}),H)};b.getFile(m,{create:!1},c(function(b){b.remove();a()}),c(function(b){b.code===b.NOT_FOUND_ERR?a():H()}))}),H)}),H)):H()}},x=v.prototype,p=function(a,d){return new v(a,d)};x.abort=function(){this.readyState=this.DONE;t(this,"abort")};x.readyState=x.INIT=0;x.WRITING=1;x.DONE=2;x.error=x.onwritestart=x.onprogress=x.onwrite=x.onabort=x.onerror=x.onwriteend=null;a.addEventListener("unload",u,!1);
p.unload=function(){u();a.removeEventListener("unload",u,!1)};return p}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&(module.exports=saveAs);Blockscad=Blockscad||{};Blockscad.fonts={};Blockscad.fontList="/fonts/liberation/LiberationSerif-Bold.ttf /fonts/Roboto/Roboto-Bold.ttf /fonts/nimbus/nimbus-sans-l_bold.ttf /fonts/AverageMono/AverageMonoSimp.ttf /fonts/Open_Sans/OpenSans-ExtraBold.ttf /fonts/Chewy/Chewy.ttf /fonts/bangers/bangers.ttf".split(" ");Blockscad.fontName="Liberation Serif;Roboto;Nimbus Sans;Average Mono;Open Sans;Chewy;Bangers".split(";");Blockscad.loadFonts=function(){for(var a=0;a<Blockscad.fontList.length;a++)Blockscad.loadFont(a)};
Blockscad.loadFont=function(a){opentype.load(Blockscad.fontList[a],function(d,e){if(d)console.log("Could not load font: ",e+":"+d);else return Blockscad.fonts[Blockscad.fontName[a]]=e})};
Blockscad.loadFontThenRender=function(a,d){try{opentype.load(Blockscad.fontList[Blockscad.loadTheseFonts[a]],function(e,k){e?console.log("Could not load font: ",k+":"+e):(Blockscad.fonts[Blockscad.fontName[Blockscad.loadTheseFonts[a]]]=k,Blockscad.numloaded++,Blockscad.numloaded==Blockscad.loadTheseFonts.length&&Blockscad.renderCode(d))})}catch(e){console.log("network error loading font")}};
Blockscad.pathToPoints=function(a,d){var e=[],k=[],r=[],h=2,l,m,w,n,u,t;2<d&&(h=d);10<h&&(h=10);if(a&&a.commands&&0<a.commands.length)for(var v=0,x=[],p=0;p<a.commands.length;p++)switch(a.commands[p].type){case "M":2<r.length&&k.push(r);r=[];e.push([a.commands[p].x,-1*a.commands[p].y]);r.push(v++);x=[a.commands[p].x,-1*a.commands[p].y];break;case "L":e.push([a.commands[p].x,-1*a.commands[p].y]);r.push(v++);x=[a.commands[p].x,-1*a.commands[p].y];break;case "C":l=[a.commands[p].x,-1*a.commands[p].y];
m=[a.commands[p].x1,-1*a.commands[p].y1];w=[a.commands[p].x2,-1*a.commands[p].y2];for(var y=1;y<=h;y++)t=y/h,n=x[1]*Math.pow(1-t,3)+3*m[1]*Math.pow(1-t,2)*t+3*w[1]*Math.pow(1-t,1)*t*t+l[1]*Math.pow(t,3),e.push([n,u]),r.push(v++);x=l;break;case "Q":l=[a.commands[p].x,-1*a.commands[p].y];m=[a.commands[p].x1,-1*a.commands[p].y1];for(y=1;y<=h;y++)t=y/h,n=x[0]*Math.pow(1-t,2)+2*m[0]*Math.pow(1-t,1)*t+l[0]*Math.pow(t,2),u=x[1]*Math.pow(1-t,2)+2*m[1]*Math.pow(1-t,1)*t+l[1]*Math.pow(t,2),e.push([n,u]),r.push(v++);
x=l;break;case "Z":2<r.length&&(k.push(r),r=[])}3>e.length&&(e=[]);return[e,k]};Blockscad.whichFonts=function(a){for(var d=[],e=0;e<Blockscad.fontList.length;e++)-1<a.indexOf(Blockscad.fontName[e])&&(Blockscad.fonts[Blockscad.fontName[e]]||d.push(e));return d};var GL=function(){function a(c,f,b){b=b||{};this.id=g.createTexture();this.width=c;this.height=f;this.format=b.format||g.RGBA;this.type=b.type||g.UNSIGNED_BYTE;g.bindTexture(g.TEXTURE_2D,this.id);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,b.filter||b.magFilter||g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,b.filter||b.minFilter||g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,b.wrap||b.wrapS||g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,
g.TEXTURE_WRAP_T,b.wrap||b.wrapT||g.CLAMP_TO_EDGE);g.texImage2D(g.TEXTURE_2D,0,this.format,c,f,0,this.format,this.type,null)}function d(){this.unique=[];this.indices=[];this.map={}}function e(c,f){this.buffer=null;this.target=c;this.type=f;this.data=[]}function k(c){c=c||{};this.vertexBuffers={};this.indexBuffers={};this.addVertexBuffer("vertices","gl_Vertex");c.coords&&this.addVertexBuffer("coords","gl_TexCoord");c.normals&&this.addVertexBuffer("normals","gl_Normal");c.colors&&this.addVertexBuffer("colors",
"gl_Color");"triangles"in c&&!c.triangles||this.addIndexBuffer("triangles");c.lines&&this.addIndexBuffer("lines")}function r(c){return new h(2*(c&1)-1,(c&2)-1,(c&4)/2-1)}function h(c,f,b){this.x=c||0;this.y=f||0;this.z=b||0}function l(c,f,b){for(var a;null!==(a=c.exec(f));)b(a)}function m(c,f){function b(b){var c=document.getElementById(b);return c?c.text:b}function a(b,c){var f={},d=/^((\s*\/\/.*\n|\s*#extension.*\n)+)\^*$/.exec(c);c=d?d[1]+b+c.substr(d[1].length):b+c;l(/\bgl_\w+\b/g,b,function(b){b in
f||(c=c.replace(new RegExp("\\b"+b+"\\b","g"),"LIGHTGL"+b),f[b]=!0)});return c}function d(b,c){var f=g.createShader(b);g.shaderSource(f,c);g.compileShader(f);if(!g.getShaderParameter(f,g.COMPILE_STATUS))throw"compile error: "+g.getShaderInfoLog(f);return f}c=b(c);f=b(f);var e=c+f,h={};l(/\b(gl_[^;]*)\b;/g,"uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",
function(b){b=b[1];if(-1!=e.indexOf(b)){var c=b.replace(/[a-z_]/g,"");h[c]="LIGHTGL"+b}});-1!=e.indexOf("ftransform")&&(h.MVPM="LIGHTGLgl_ModelViewProjectionMatrix");this.usedMatrices=h;c=a("uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;vec4 ftransform() {  return gl_ModelViewProjectionMatrix * gl_Vertex;}",
c);f=a("precision highp float;uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",f);this.program=g.createProgram();g.attachShader(this.program,d(g.VERTEX_SHADER,c));g.attachShader(this.program,d(g.FRAGMENT_SHADER,f));g.linkProgram(this.program);if(!g.getProgramParameter(this.program,g.LINK_STATUS))throw"link error: "+
g.getProgramInfoLog(this.program);this.attributes={};this.uniformLocations={};var k={};l(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,c+f,function(b){k[b[2]]=1});this.isSampler=k}function w(){g.MODELVIEW=Q|1;g.PROJECTION=Q|2;var c=new p,f=new p;g.modelviewMatrix=new p;g.projectionMatrix=new p;var b=[],a=[],d,e;g.matrixMode=function(c){switch(c){case g.MODELVIEW:d="modelviewMatrix";e=b;break;case g.PROJECTION:d="projectionMatrix";e=a;break;default:throw"invalid matrix mode "+c;}};g.loadIdentity=
function(){p.identity(g[d])};g.loadMatrix=function(b){b=b.m;for(var c=g[d].m,f=0;16>f;f++)c[f]=b[f]};g.multMatrix=function(b){g.loadMatrix(p.multiply(g[d],b,f))};g.perspective=function(b,f,a,d){g.multMatrix(p.perspective(b,f,a,d,c))};g.frustum=function(b,f,a,d,e,B){g.multMatrix(p.frustum(b,f,a,d,e,B,c))};g.ortho=function(b,f,a,d,e,B){g.multMatrix(p.ortho(b,f,a,d,e,B,c))};g.scale=function(b,f,a){g.multMatrix(p.scale(b,f,a,c))};g.translate=function(b,f,a){g.multMatrix(p.translate(b,f,a,c))};g.rotate=
function(b,f,a,d){g.multMatrix(p.rotate(b,f,a,d,c))};g.lookAt=function(b,f,a,d,e,B,h,k,G){g.multMatrix(p.lookAt(b,f,a,d,e,B,h,k,G,c))};g.pushMatrix=function(){e.push(Array.prototype.slice.call(g[d].m))};g.popMatrix=function(){var b=e.pop();g[d].m=H?new Float32Array(b):b};g.project=function(b,c,f,a,d,e){a=a||g.modelviewMatrix;d=d||g.projectionMatrix;e=e||g.getParameter(g.VIEWPORT);b=d.transformPoint(a.transformPoint(new h(b,c,f)));return new h(e[0]+e[2]*(.5*b.x+.5),e[1]+e[3]*(.5*b.y+.5),.5*b.z+.5)};
g.unProject=function(b,a,d,e,B,k){e=e||g.modelviewMatrix;B=B||g.projectionMatrix;k=k||g.getParameter(g.VIEWPORT);b=new h((b-k[0])/k[2]*2-1,(a-k[1])/k[3]*2-1,2*d-1);return p.inverse(p.multiply(B,e,c),f).transformPoint(b)};g.matrixMode(g.MODELVIEW)}function n(){var c=new k({coords:!0,colors:!0,triangles:!1}),f=-1,b=[0,0,0,0],a=[1,1,1,1],d=new m("uniform float pointSize;varying vec4 color;varying vec4 coord;void main() {color = gl_Color;coord = gl_TexCoord;gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;gl_PointSize = pointSize;}",
"uniform sampler2D texture;uniform float pointSize;uniform bool useTexture;varying vec4 color;varying vec4 coord;void main() {gl_FragColor = color;if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);}");g.pointSize=function(b){d.uniforms({pointSize:b})};g.begin=function(b){if(-1!=f)throw"mismatched gl.begin() and gl.end() calls";f=b;c.colors=[];c.coords=[];c.vertices=[]};g.color=function(b,c,f,d){a=1==arguments.length?b.toArray().concat(1):[b,c,f,d||1]};g.texCoord=function(c,f){b=1==arguments.length?
c.toArray(2):[c,f]};g.vertex=function(f,d,e){c.colors.push(a);c.coords.push(b);c.vertices.push(1==arguments.length?f.toArray():[f,d,e])};g.end=function(){if(-1==f)throw"mismatched gl.begin() and gl.end() calls";c.compile();d.uniforms({useTexture:!!g.getParameter(g.TEXTURE_BINDING_2D)}).draw(c,f);f=-1}}function u(){function c(){for(var b in E)if(t.call(E,b)&&E[b])return!0;return!1}function f(b){var f={},a;for(a in b)f[a]="function"==typeof b[a]?function(c){return function(){c.apply(b,arguments)}}(b[a]):
b[a];f.original=b;f.x=f.pageX;f.y=f.pageY;for(a=g.canvas;a;a=a.offsetParent)f.x-=a.offsetLeft,f.y-=a.offsetTop;q?(f.deltaX=f.x-p,f.deltaY=f.y-n):(f.deltaX=0,f.deltaY=0,q=!0);p=f.x;n=f.y;f.dragging=c();f.preventDefault=function(){f.original.preventDefault()};f.stopPropagation=function(){f.original.stopPropagation()};return f}function b(b){var c={},f;for(f in b)c[f]="function"==typeof b[f]?function(c){return function(){c.apply(b,arguments)}}(b[f]):b[f];c.original=b;if(0<c.targetTouches.length){f=c.targetTouches[0];
c.x=f.pageX;c.y=f.pageY;for(f=g.canvas;f;f=f.offsetParent)c.x-=f.offsetLeft,c.y-=f.offsetTop;q?(c.deltaX=c.x-p,c.deltaY=c.y-n):(c.deltaX=0,c.deltaY=0,q=!0);p=c.x;n=c.y;c.dragging=!0}c.preventDefault=function(){c.original.preventDefault()};c.stopPropagation=function(){c.original.stopPropagation()};return c}function a(b){g=l;b=f(b);if(g.onmousemove)g.onmousemove(b);b.preventDefault()}function d(b){g=l;E[b.which]=!1;c()||(document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",
d),g.canvas.addEventListener("mousemove",a),g.canvas.addEventListener("mouseup",d));b=f(b);if(g.onmouseup)g.onmouseup(b);b.preventDefault()}function e(b){g=l;b=f(b);if(g.onmousewheel)g.onmousewheel(b);b.preventDefault()}function k(c){g=l;0===c.targetTouches.length&&h(c);c=b(c);if(g.ontouchmove)g.ontouchmove(c);c.preventDefault()}function h(c){document.removeEventListener("touchmove",k);document.removeEventListener("touchend",h);g.canvas.addEventListener("touchmove",k);g.canvas.addEventListener("touchend",
h);g=l;c=b(c);if(g.ontouchend)g.ontouchend(c);c.preventDefault()}function r(){q=!1}function m(){E={};q=!1}var l=g,p=0,n=0,E={},q=!1,t=Object.prototype.hasOwnProperty;g.canvas.addEventListener("mousedown",function(b){g=l;c()||(document.addEventListener("mousemove",a),document.addEventListener("mouseup",d),g.canvas.removeEventListener("mousemove",a),g.canvas.removeEventListener("mouseup",d));E[b.which]=!0;b=f(b);if(g.onmousedown)g.onmousedown(b);b.preventDefault()});g.canvas.addEventListener("mousemove",
a);g.canvas.addEventListener("mouseup",d);g.canvas.addEventListener("mousewheel",e);g.canvas.addEventListener("DOMMouseScroll",e);g.canvas.addEventListener("mouseover",r);g.canvas.addEventListener("mouseout",r);g.canvas.addEventListener("touchstart",function(c){m();document.addEventListener("touchmove",k);document.addEventListener("touchend",h);g.canvas.removeEventListener("touchmove",k);g.canvas.removeEventListener("touchend",h);g=l;c=b(c);if(g.ontouchstart)g.ontouchstart(c);c.preventDefault()});
g.canvas.addEventListener("touchmove",k);g.canvas.addEventListener("touchend",h);document.addEventListener("contextmenu",m)}function t(c){return{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[c]||(65<=c&&90>=c?String.fromCharCode(c):null)}function v(c,f,b){c.addEventListener(f,b)}function x(){(function(c){g.makeCurrent=function(){g=c}})(g);g.animate=function(){function c(){g=a;var d=(new Date).getTime();if(g.onupdate)g.onupdate((d-b)/1E3);
if(g.ondraw)g.ondraw();f(c);b=d}var f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(b){setTimeout(b,1E3/60)},b=(new Date).getTime(),a=g;c()};g.fullscreen=function(c){function f(){g.canvas.width=window.innerWidth-a-d;g.canvas.height=window.innerHeight-b-e;g.viewport(0,0,g.canvas.width,g.canvas.height);!c.camera&&"camera"in c||(g.matrixMode(g.PROJECTION),g.loadIdentity(),g.perspective(c.fov||45,g.canvas.width/g.canvas.height,c.near||.1,c.far||
1E3),g.matrixMode(g.MODELVIEW));if(g.onresize)g.onresize();if(g.ondraw)g.ondraw()}c=c||{};var b=c.paddingTop||0,a=c.paddingLeft||0,d=c.paddingRight||0,e=c.paddingBottom||0;if(!document.body)throw"document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)";document.body.appendChild(g.canvas);document.body.style.overflow="hidden";g.canvas.style.position="absolute";g.canvas.style.left=a+"px";g.canvas.style.top=b+"px";window.addEventListener("resize",f);
f()}}function p(){var c=Array.prototype.concat.apply([],arguments);c.length||(c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.m=H?new Float32Array(c):c}function y(c,f,b){this.t=arguments.length?c:Number.MAX_VALUE;this.hit=f;this.normal=b}function F(){var c=g.getParameter(g.VIEWPORT),f=g.modelviewMatrix.m,b=new h(f[0],f[4],f[8]),a=new h(f[1],f[5],f[9]),d=new h(f[2],f[6],f[10]),f=new h(f[3],f[7],f[11]);this.eye=new h(-f.dot(b),-f.dot(a),-f.dot(d));b=c[0];a=b+c[2];d=c[1];f=d+c[3];this.ray00=g.unProject(b,
d,1).subtract(this.eye);this.ray10=g.unProject(a,d,1).subtract(this.eye);this.ray01=g.unProject(b,f,1).subtract(this.eye);this.ray11=g.unProject(a,f,1).subtract(this.eye);this.viewport=c}var K,L,q;a.prototype={bind:function(c){g.activeTexture(g.TEXTURE0+(c||0));g.bindTexture(g.TEXTURE_2D,this.id)},unbind:function(c){g.activeTexture(g.TEXTURE0+(c||0));g.bindTexture(g.TEXTURE_2D,null)},drawTo:function(c,f){f=f||{};var b=g.getParameter(g.VIEWPORT);g.viewport(0,0,this.width,this.height);K=K||g.createFramebuffer();
g.bindFramebuffer(g.FRAMEBUFFER,K);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,this.id,0);if(!1!==f.depth){L=L||g.createRenderbuffer();g.bindRenderbuffer(g.RENDERBUFFER,L);if(this.width!=L.width||this.height!=L.height)L.width=this.width,L.height=this.height,g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_COMPONENT16,this.width,this.height);g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,L)}c();g.bindFramebuffer(g.FRAMEBUFFER,null);g.bindRenderbuffer(g.RENDERBUFFER,
null);g.viewport(b[0],b[1],b[2],b[3])},swapWith:function(c){var f;f=c.id;c.id=this.id;this.id=f;f=c.width;c.width=this.width;this.width=f;f=c.height;c.height=this.height;this.height=f}};a.fromImage=function(c,f){f=f||{};var b=new a(c.width,c.height,f);try{g.texImage2D(g.TEXTURE_2D,0,b.format,b.format,b.type,c)}catch(d){if("file:"==window.location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";
}f.minFilter&&f.minFilter!=g.NEAREST&&f.minFilter!=g.LINEAR&&g.generateMipmap(g.TEXTURE_2D);return b};a.fromURL=function(c,f){q=q||function(){var b=document.createElement("canvas").getContext("2d");b.canvas.width=b.canvas.height=128;for(var c=0;c<b.canvas.height;c+=16)for(var f=0;f<b.canvas.width;f+=16)b.fillStyle=(f^c)&16?"#FFF":"#DDD",b.fillRect(f,c,16,16);return b.canvas}();var b=a.fromImage(q,f),d=new Image,e=g;d.onload=function(){e.makeCurrent();a.fromImage(d,f).swapWith(b)};d.src=c;return b};
d.prototype={add:function(c){var f=JSON.stringify(c);f in this.map||(this.map[f]=this.unique.length,this.unique.push(c));return this.map[f]}};e.prototype={compile:function(c){for(var f=[],b=0;b<this.data.length;b+=1E4)f=Array.prototype.concat.apply(f,this.data.slice(b,b+1E4));b=this.data.length?f.length/this.data.length:0;if(b!=Math.round(b))throw"buffer elements not of consistent size, average size is "+b;this.buffer=this.buffer||g.createBuffer();this.buffer.length=f.length;this.buffer.spacing=b;
g.bindBuffer(this.target,this.buffer);g.bufferData(this.target,new this.type(f),c||g.STATIC_DRAW)}};k.prototype={addVertexBuffer:function(c,f){(this.vertexBuffers[f]=new e(g.ARRAY_BUFFER,Float32Array)).name=c;this[c]=[]},addIndexBuffer:function(c){this.indexBuffers[c]=new e(g.ELEMENT_ARRAY_BUFFER,Uint16Array);this[c]=[]},compile:function(){for(var c in this.vertexBuffers){var f=this.vertexBuffers[c];f.data=this[f.name];f.compile()}for(var b in this.indexBuffers)f=this.indexBuffers[b],f.data=this[b],
f.compile()},transform:function(c){this.vertices=this.vertices.map(function(b){return c.transformPoint(h.fromArray(b)).toArray()});if(this.normals){var f=c.inverse().transpose();this.normals=this.normals.map(function(b){return f.transformVector(h.fromArray(b)).unit().toArray()})}this.compile();return this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal");for(var c=0;c<this.vertices.length;c++)this.normals[c]=new h;for(c=0;c<this.triangles.length;c++){var f=this.triangles[c],
b=h.fromArray(this.vertices[f[0]]),a=h.fromArray(this.vertices[f[1]]),d=h.fromArray(this.vertices[f[2]]),b=a.subtract(b).cross(d.subtract(b)).unit();this.normals[f[0]]=this.normals[f[0]].add(b);this.normals[f[1]]=this.normals[f[1]].add(b);this.normals[f[2]]=this.normals[f[2]].add(b)}for(c=0;c<this.vertices.length;c++)this.normals[c]=this.normals[c].unit().toArray();this.compile();return this},computeWireframe:function(){for(var c=new d,f=0;f<this.triangles.length;f++)for(var b=this.triangles[f],a=
0;a<b.length;a++){var e=b[a],g=b[(a+1)%b.length];c.add([Math.min(e,g),Math.max(e,g)])}this.lines||this.addIndexBuffer("lines");this.lines=c.unique;this.compile();return this},getAABB:function(){var c={min:new h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};c.max=c.min.negative();for(var f=0;f<this.vertices.length;f++){var b=h.fromArray(this.vertices[f]);c.min=h.min(c.min,b);c.max=h.max(c.max,b)}return c},getBoundingSphere:function(){for(var c=this.getAABB(),c={center:c.min.add(c.max).divide(2),
radius:0},f=0;f<this.vertices.length;f++)c.radius=Math.max(c.radius,h.fromArray(this.vertices[f]).subtract(c.center).length());return c}};k.plane=function(c){c=c||{};var f=new k(c),b=c.detailX||c.detail||1;c=c.detailY||c.detail||1;for(var a=0;a<=c;a++)for(var d=a/c,e=0;e<=b;e++){var g=e/b;f.vertices.push([2*g-1,2*d-1,0]);f.coords&&f.coords.push([g,d]);f.normals&&f.normals.push([0,0,1]);e<b&&a<c&&(g=e+a*(b+1),f.triangles.push([g,g+1,g+b+1]),f.triangles.push([g+b+1,g+1,g+b+2]))}f.compile();return f};
var A=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];k.cube=function(c){c=new k(c);for(var f=0;f<A.length;f++){for(var b=A[f],a=4*f,d=0;4>d;d++)c.vertices.push(r(b[d]).toArray()),c.coords&&c.coords.push([d&1,(d&2)/2]),c.normals&&c.normals.push(b.slice(4,7));c.triangles.push([a,a+1,a+2]);c.triangles.push([a+2,a+1,a+3])}c.compile();return c};k.sphere=function(c){function f(b,c,f){return l?[b,f,c]:[b,c,f]}c=c||{};var b=new k(c),a=new d;c=c.detail||
6;for(var e=0;8>e;e++)for(var g=r(e),l=0<g.x*g.y*g.z,m=[],p=0;p<=c;p++){for(var n=0;p+n<=c;n++){var q=p/c,t=n/c,N=(c-p-n)/c,t={vertex:(new h(q+(q-q*q)/2,t+(t-t*t)/2,N+(N-N*N)/2)).unit().multiply(g).toArray()};b.coords&&(t.coord=0<g.y?[1-q,N]:[N,1-q]);m.push(a.add(t))}if(0<p)for(n=0;p+n<=c;n++)q=(p-1)*(c+1)+(p-1-(p-1)*(p-1))/2+n,t=p*(c+1)+(p-p*p)/2+n,b.triangles.push(f(m[q],m[q+1],m[t])),p+n<c&&b.triangles.push(f(m[t],m[q+1],m[t+1]))}b.vertices=a.unique.map(function(b){return b.vertex});b.coords&&
(b.coords=a.unique.map(function(b){return b.coord}));b.normals&&(b.normals=b.vertices);b.compile();return b};k.load=function(c,f){f=f||{};"coords"in f||(f.coords=!!c.coords);"normals"in f||(f.normals=!!c.normals);"colors"in f||(f.colors=!!c.colors);"triangles"in f||(f.triangles=!!c.triangles);"lines"in f||(f.lines=!!c.lines);var b=new k(f);b.vertices=c.vertices;b.coords&&(b.coords=c.coords);b.normals&&(b.normals=c.normals);b.colors&&(b.colors=c.colors);b.triangles&&(b.triangles=c.triangles);b.lines&&
(b.lines=c.lines);b.compile();return b};h.prototype={negative:function(){return new h(-this.x,-this.y,-this.z)},add:function(c){return c instanceof h?new h(this.x+c.x,this.y+c.y,this.z+c.z):new h(this.x+c,this.y+c,this.z+c)},subtract:function(c){return c instanceof h?new h(this.x-c.x,this.y-c.y,this.z-c.z):new h(this.x-c,this.y-c,this.z-c)},multiply:function(c){return c instanceof h?new h(this.x*c.x,this.y*c.y,this.z*c.z):new h(this.x*c,this.y*c,this.z*c)},divide:function(c){return c instanceof h?
new h(this.x/c.x,this.y/c.y,this.z/c.z):new h(this.x/c,this.y/c,this.z/c)},equals:function(c){return this.x==c.x&&this.y==c.y&&this.z==c.z},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},cross:function(c){return new h(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,
this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(c){return[this.x,this.y,this.z].slice(0,c||3)},clone:function(){return new h(this.x,this.y,this.z)},init:function(c,f,b){this.x=c;this.y=f;this.z=b;return this}};h.negative=function(c,f){f.x=-c.x;f.y=-c.y;f.z=-c.z;return f};h.add=function(c,f,b){f instanceof h?(b.x=c.x+f.x,b.y=c.y+f.y,b.z=c.z+f.z):(b.x=c.x+f,b.y=c.y+f,b.z=c.z+f);return b};h.subtract=function(c,f,b){f instanceof
h?(b.x=c.x-f.x,b.y=c.y-f.y,b.z=c.z-f.z):(b.x=c.x-f,b.y=c.y-f,b.z=c.z-f);return b};h.multiply=function(c,f,b){f instanceof h?(b.x=c.x*f.x,b.y=c.y*f.y,b.z=c.z*f.z):(b.x=c.x*f,b.y=c.y*f,b.z=c.z*f);return b};h.divide=function(c,f,b){f instanceof h?(b.x=c.x/f.x,b.y=c.y/f.y,b.z=c.z/f.z):(b.x=c.x/f,b.y=c.y/f,b.z=c.z/f);return b};h.cross=function(c,f,b){b.x=c.y*f.z-c.z*f.y;b.y=c.z*f.x-c.x*f.z;b.z=c.x*f.y-c.y*f.x;return b};h.unit=function(c,f){var b=c.length();f.x=c.x/b;f.y=c.y/b;f.z=c.z/b;return f};h.fromAngles=
function(c,f){return new h(Math.cos(c)*Math.cos(f),Math.sin(f),Math.sin(c)*Math.cos(f))};h.randomDirection=function(){return h.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))};h.min=function(c,f){return new h(Math.min(c.x,f.x),Math.min(c.y,f.y),Math.min(c.z,f.z))};h.max=function(c,f){return new h(Math.max(c.x,f.x),Math.max(c.y,f.y),Math.max(c.z,f.z))};h.lerp=function(c,f,b){return f.subtract(c).multiply(b).add(c)};h.fromArray=function(c){return new h(c[0],c[1],c[2])};m.prototype=
{uniforms:function(c){g.useProgram(this.program);for(var f in c){var b=this.uniformLocations[f]||g.getUniformLocation(this.program,f);if(b){this.uniformLocations[f]=b;var a=c[f];a instanceof h?a=[a.x,a.y,a.z]:a instanceof p&&(a=a.m);var d=Object.prototype.toString.call(a);if("[object Array]"==d||"[object Float32Array]"==d)switch(a.length){case 1:g.uniform1fv(b,new Float32Array(a));break;case 2:g.uniform2fv(b,new Float32Array(a));break;case 3:g.uniform3fv(b,new Float32Array(a));break;case 4:g.uniform4fv(b,
new Float32Array(a));break;case 9:g.uniformMatrix3fv(b,!1,new Float32Array([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]]));break;case 16:g.uniformMatrix4fv(b,!1,new Float32Array([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]]));break;default:throw"don't know how to load uniform \""+f+'" of length '+a.length;}else if(d=Object.prototype.toString.call(a),"[object Number]"==d||"[object Boolean]"==d)(this.isSampler[f]?g.uniform1i:g.uniform1f).call(g,b,a);else throw'attempted to set uniform "'+
f+'" to invalid value '+a;}}return this},draw:function(c,a){this.drawBuffers(c.vertexBuffers,c.indexBuffers[a==g.LINES?"lines":"triangles"],2>arguments.length?g.TRIANGLES:a)},drawBuffers:function(c,a,b){var d=this.usedMatrices,e=g.modelviewMatrix,k=g.projectionMatrix,h=d.MVMI||d.NM?e.inverse():null,r=d.PMI?k.inverse():null,m=d.MVPM||d.MVPMI?k.multiply(e):null,l={};d.MVM&&(l[d.MVM]=e);d.MVMI&&(l[d.MVMI]=h);d.PM&&(l[d.PM]=k);d.PMI&&(l[d.PMI]=r);d.MVPM&&(l[d.MVPM]=m);d.MVPMI&&(l[d.MVPMI]=m.inverse());
d.NM&&(e=h.m,l[d.NM]=[e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]]);this.uniforms(l);var d=0,p;for(p in c)l=c[p],e=this.attributes[p]||g.getAttribLocation(this.program,p.replace(/^(gl_.*)$/,"LIGHTGL$1")),-1!=e&&l.buffer&&(this.attributes[p]=e,g.bindBuffer(g.ARRAY_BUFFER,l.buffer),g.enableVertexAttribArray(e),g.vertexAttribPointer(e,l.buffer.spacing,g.FLOAT,!1,0,0),d=l.buffer.length/l.buffer.spacing);for(p in this.attributes)p in c||g.disableVertexAttribArray(this.attributes[p]);!d||a&&!a.buffer||
(a?(g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,a.buffer),g.drawElements(b,a.buffer.length,g.UNSIGNED_SHORT,0)):g.drawArrays(b,0,d));return this}};m.fromURL=function(c,a){var b=function(b){var c=new XMLHttpRequest;c.open("GET",b,!1);c.send(null);if(200!==c.status)throw"could not load "+b;return c.responseText},d=b(c),b=b(a);return new m(d,b)};m.from=function(c,a){try{return new m(c,a)}catch(b){return m.fromURL(c,a)}};var g,z={create:function(c){c=c||{};var a=c.canvas;a||(a=document.createElement("canvas"),
a.width=c.width||800,a.height=c.height||600);"alpha"in c||(c.alpha=!1);try{g=a.getContext("webgl",c)}catch(b){}try{g=g||a.getContext("experimental-webgl",c)}catch(b){}if(!g)throw"WebGL not supported";w();n();u();x();return g},keys:{},Matrix:p,Indexer:d,Buffer:e,Mesh:k,HitTest:y,Raytracer:F,Shader:m,Texture:a,Vector:h};v(document,"keydown",function(c){if(!c.altKey&&!c.ctrlKey&&!c.metaKey){var a=t(c.keyCode);a&&(z.keys[a]=!0);z.keys[c.keyCode]=!0}});v(document,"keyup",function(c){if(!c.altKey&&!c.ctrlKey&&
!c.metaKey){var a=t(c.keyCode);a&&(z.keys[a]=!1);z.keys[c.keyCode]=!1}});var Q=305397760,H="undefined"!=typeof Float32Array;p.prototype={inverse:function(){return p.inverse(this,new p)},transpose:function(){return p.transpose(this,new p)},multiply:function(c){return p.multiply(this,c,new p)},transformPoint:function(c){var a=this.m;return(new h(a[0]*c.x+a[1]*c.y+a[2]*c.z+a[3],a[4]*c.x+a[5]*c.y+a[6]*c.z+a[7],a[8]*c.x+a[9]*c.y+a[10]*c.z+a[11])).divide(a[12]*c.x+a[13]*c.y+a[14]*c.z+a[15])},transformVector:function(c){var a=
this.m;return new h(a[0]*c.x+a[1]*c.y+a[2]*c.z,a[4]*c.x+a[5]*c.y+a[6]*c.z,a[8]*c.x+a[9]*c.y+a[10]*c.z)}};p.inverse=function(c,a){a=a||new p;var b=c.m,d=a.m;d[0]=b[5]*b[10]*b[15]-b[5]*b[14]*b[11]-b[6]*b[9]*b[15]+b[6]*b[13]*b[11]+b[7]*b[9]*b[14]-b[7]*b[13]*b[10];d[1]=-b[1]*b[10]*b[15]+b[1]*b[14]*b[11]+b[2]*b[9]*b[15]-b[2]*b[13]*b[11]-b[3]*b[9]*b[14]+b[3]*b[13]*b[10];d[2]=b[1]*b[6]*b[15]-b[1]*b[14]*b[7]-b[2]*b[5]*b[15]+b[2]*b[13]*b[7]+b[3]*b[5]*b[14]-b[3]*b[13]*b[6];d[3]=-b[1]*b[6]*b[11]+b[1]*b[10]*
b[7]+b[2]*b[5]*b[11]-b[2]*b[9]*b[7]-b[3]*b[5]*b[10]+b[3]*b[9]*b[6];d[4]=-b[4]*b[10]*b[15]+b[4]*b[14]*b[11]+b[6]*b[8]*b[15]-b[6]*b[12]*b[11]-b[7]*b[8]*b[14]+b[7]*b[12]*b[10];d[5]=b[0]*b[10]*b[15]-b[0]*b[14]*b[11]-b[2]*b[8]*b[15]+b[2]*b[12]*b[11]+b[3]*b[8]*b[14]-b[3]*b[12]*b[10];d[6]=-b[0]*b[6]*b[15]+b[0]*b[14]*b[7]+b[2]*b[4]*b[15]-b[2]*b[12]*b[7]-b[3]*b[4]*b[14]+b[3]*b[12]*b[6];d[7]=b[0]*b[6]*b[11]-b[0]*b[10]*b[7]-b[2]*b[4]*b[11]+b[2]*b[8]*b[7]+b[3]*b[4]*b[10]-b[3]*b[8]*b[6];d[8]=b[4]*b[9]*b[15]-b[4]*
b[13]*b[11]-b[5]*b[8]*b[15]+b[5]*b[12]*b[11]+b[7]*b[8]*b[13]-b[7]*b[12]*b[9];d[9]=-b[0]*b[9]*b[15]+b[0]*b[13]*b[11]+b[1]*b[8]*b[15]-b[1]*b[12]*b[11]-b[3]*b[8]*b[13]+b[3]*b[12]*b[9];d[10]=b[0]*b[5]*b[15]-b[0]*b[13]*b[7]-b[1]*b[4]*b[15]+b[1]*b[12]*b[7]+b[3]*b[4]*b[13]-b[3]*b[12]*b[5];d[11]=-b[0]*b[5]*b[11]+b[0]*b[9]*b[7]+b[1]*b[4]*b[11]-b[1]*b[8]*b[7]-b[3]*b[4]*b[9]+b[3]*b[8]*b[5];d[12]=-b[4]*b[9]*b[14]+b[4]*b[13]*b[10]+b[5]*b[8]*b[14]-b[5]*b[12]*b[10]-b[6]*b[8]*b[13]+b[6]*b[12]*b[9];d[13]=b[0]*b[9]*
b[14]-b[0]*b[13]*b[10]-b[1]*b[8]*b[14]+b[1]*b[12]*b[10]+b[2]*b[8]*b[13]-b[2]*b[12]*b[9];d[14]=-b[0]*b[5]*b[14]+b[0]*b[13]*b[6]+b[1]*b[4]*b[14]-b[1]*b[12]*b[6]-b[2]*b[4]*b[13]+b[2]*b[12]*b[5];d[15]=b[0]*b[5]*b[10]-b[0]*b[9]*b[6]-b[1]*b[4]*b[10]+b[1]*b[8]*b[6]+b[2]*b[4]*b[9]-b[2]*b[8]*b[5];for(var b=b[0]*d[0]+b[1]*d[4]+b[2]*d[8]+b[3]*d[12],e=0;16>e;e++)d[e]/=b;return a};p.transpose=function(c,a){a=a||new p;var b=c.m,d=a.m;d[0]=b[0];d[1]=b[4];d[2]=b[8];d[3]=b[12];d[4]=b[1];d[5]=b[5];d[6]=b[9];d[7]=b[13];
d[8]=b[2];d[9]=b[6];d[10]=b[10];d[11]=b[14];d[12]=b[3];d[13]=b[7];d[14]=b[11];d[15]=b[15];return a};p.multiply=function(c,a,b){b=b||new p;c=c.m;a=a.m;var d=b.m;d[0]=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];d[1]=c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13];d[2]=c[0]*a[2]+c[1]*a[6]+c[2]*a[10]+c[3]*a[14];d[3]=c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15];d[4]=c[4]*a[0]+c[5]*a[4]+c[6]*a[8]+c[7]*a[12];d[5]=c[4]*a[1]+c[5]*a[5]+c[6]*a[9]+c[7]*a[13];d[6]=c[4]*a[2]+c[5]*a[6]+c[6]*a[10]+c[7]*a[14];d[7]=c[4]*a[3]+c[5]*
a[7]+c[6]*a[11]+c[7]*a[15];d[8]=c[8]*a[0]+c[9]*a[4]+c[10]*a[8]+c[11]*a[12];d[9]=c[8]*a[1]+c[9]*a[5]+c[10]*a[9]+c[11]*a[13];d[10]=c[8]*a[2]+c[9]*a[6]+c[10]*a[10]+c[11]*a[14];d[11]=c[8]*a[3]+c[9]*a[7]+c[10]*a[11]+c[11]*a[15];d[12]=c[12]*a[0]+c[13]*a[4]+c[14]*a[8]+c[15]*a[12];d[13]=c[12]*a[1]+c[13]*a[5]+c[14]*a[9]+c[15]*a[13];d[14]=c[12]*a[2]+c[13]*a[6]+c[14]*a[10]+c[15]*a[14];d[15]=c[12]*a[3]+c[13]*a[7]+c[14]*a[11]+c[15]*a[15];return b};p.identity=function(a){a=a||new p;var d=a.m;d[0]=d[5]=d[10]=d[15]=
1;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[11]=d[12]=d[13]=d[14]=0;return a};p.perspective=function(a,d,b,e,g){a=Math.tan(a*Math.PI/360)*b;d*=a;return p.frustum(-d,d,-a,a,b,e,g)};p.frustum=function(a,d,b,e,g,k,h){h=h||new p;var l=h.m;l[0]=2*g/(d-a);l[1]=0;l[2]=(d+a)/(d-a);l[3]=0;l[4]=0;l[5]=2*g/(e-b);l[6]=(e+b)/(e-b);l[7]=0;l[8]=0;l[9]=0;l[10]=-(k+g)/(k-g);l[11]=-2*k*g/(k-g);l[12]=0;l[13]=0;l[14]=-1;l[15]=0;return h};p.ortho=function(a,d,b,e,g,k,h){h=h||new p;var l=h.m;l[0]=2/(d-a);l[1]=0;l[2]=0;
l[3]=-(d+a)/(d-a);l[4]=0;l[5]=2/(e-b);l[6]=0;l[7]=-(e+b)/(e-b);l[8]=0;l[9]=0;l[10]=-2/(k-g);l[11]=-(k+g)/(k-g);l[12]=0;l[13]=0;l[14]=0;l[15]=1;return h};p.scale=function(a,d,b,e){e=e||new p;var g=e.m;g[0]=a;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=d;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=b;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return e};p.translate=function(a,d,b,e){e=e||new p;var g=e.m;g[0]=1;g[1]=0;g[2]=0;g[3]=a;g[4]=0;g[5]=1;g[6]=0;g[7]=d;g[8]=0;g[9]=0;g[10]=1;g[11]=b;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return e};
p.rotate=function(a,d,b,e,g){if(!a||!d&&!b&&!e)return p.identity(g);g=g||new p;var k=g.m,h=Math.sqrt(d*d+b*b+e*e);a*=Math.PI/180;d/=h;b/=h;e/=h;h=Math.cos(a);a=Math.sin(a);var l=1-h;k[0]=d*d*l+h;k[1]=d*b*l-e*a;k[2]=d*e*l+b*a;k[3]=0;k[4]=b*d*l+e*a;k[5]=b*b*l+h;k[6]=b*e*l-d*a;k[7]=0;k[8]=e*d*l-b*a;k[9]=e*b*l+d*a;k[10]=e*e*l+h;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return g};p.lookAt=function(a,d,b,e,g,k,l,m,r,n){n=n||new p;var q=n.m;a=new h(a,d,b);e=new h(e,g,k);m=new h(l,m,r);l=a.subtract(e).unit();
m=m.cross(l).unit();r=l.cross(m).unit();q[0]=m.x;q[1]=m.y;q[2]=m.z;q[3]=-m.dot(a);q[4]=r.x;q[5]=r.y;q[6]=r.z;q[7]=-r.dot(a);q[8]=l.x;q[9]=l.y;q[10]=l.z;q[11]=-l.dot(a);q[12]=0;q[13]=0;q[14]=0;q[15]=1;return n};y.prototype={mergeWith:function(a){0<a.t&&a.t<this.t&&(this.t=a.t,this.hit=a.hit,this.normal=a.normal)}};F.prototype={getRayForPixel:function(a,d){a=(a-this.viewport[0])/this.viewport[2];d=1-(d-this.viewport[1])/this.viewport[3];var b=h.lerp(this.ray00,this.ray10,a),e=h.lerp(this.ray01,this.ray11,
a);return h.lerp(b,e,d).unit()}};F.hitTestBox=function(a,d,b,e){var g=b.subtract(a).divide(d),k=e.subtract(a).divide(d),l=h.min(g,k),g=h.max(g,k),l=l.max(),g=g.min();return 0<l&&l<g?(a=a.add(d.multiply(l)),b=b.add(1E-6),e=e.subtract(1E-6),new y(l,a,new h((a.x>e.x)-(a.x<b.x),(a.y>e.y)-(a.y<b.y),(a.z>e.z)-(a.z<b.z)))):null};F.hitTestSphere=function(a,d,b,e){var g=a.subtract(b),k=d.dot(d),h=2*d.dot(g),g=g.dot(g)-e*e,g=h*h-4*k*g;return 0<g?(k=(-h-Math.sqrt(g))/(2*k),a=a.add(d.multiply(k)),new y(k,a,a.subtract(b).divide(e))):
null};F.hitTestTriangle=function(a,d,b,e,g){var k=e.subtract(b),h=g.subtract(b);g=k.cross(h).unit();e=g.dot(b.subtract(a))/g.dot(d);if(0<e){a=a.add(d.multiply(e));var l=a.subtract(b);b=h.dot(h);d=h.dot(k);var h=h.dot(l),m=k.dot(k),k=k.dot(l),l=b*m-d*d,m=(m*h-d*k)/l,k=(b*k-d*h)/l;if(0<=m&&0<=k&&1>=m+k)return new y(e,a,g)}return null};return z}();Blockscad=Blockscad||{};Blockscad.Toolbox={};Blockly=Blockly||{};Blockscad.Toolbox.catIDs=[];Blockscad.Toolbox.allcats="HEX_3D_PRIMITIVE HEX_2D_PRIMITIVE HEX_TRANSFORM HEX_SETOP HEX_MATH HEX_LOGIC HEX_LOOP HEX_VARIABLE HEX_PROCEDURE".split(" ");Blockscad.Toolbox.whichCatsInSimple=[0,2,3,4,7,8];Blockscad.Toolbox.colorScheme={};Blockscad.Toolbox.colorScheme.one="#006205 #209303 #26549E #7450E2 #0186E2 #BF6920 #612485 #8C7149 #900355".split(" ");Blockscad.Toolbox.colorScheme.two="#885ee3 #82af5a #23901c #377eb8 #ba9969 #afaf13 #a66658 #999999 #b02375".split(" ");
Blockscad.Toolbox.catHex=[];Blockscad.Toolbox.simpCatHex=[];Blockscad.Toolbox.setColorScheme=function(a){for(var d=0;d<Blockscad.Toolbox.allcats.length;d++)Blockscad.Toolbox[Blockscad.Toolbox.allcats[d]]=a[d],Blockscad.Toolbox.catHex[d]=a[d]};
Blockscad.Toolbox.setCatColors=function(){if(Blockscad.Toolbox.catIDs.length<Blockscad.Toolbox.allcats.length)for(var a=0;a<Blockscad.Toolbox.catIDs.length;a++){var d=document.getElementById(Blockscad.Toolbox.catIDs[a]);d.style.background=Blockscad.Toolbox.catHex[Blockscad.Toolbox.whichCatsInSimple[a]]}else for(a=0;a<Blockscad.Toolbox.catIDs.length;a++)d=document.getElementById(Blockscad.Toolbox.catIDs[a]),d.style.background=Blockscad.Toolbox.catHex[a]};Blockscad.Toolbox.cat_3D='<category name="3D Shapes"><block type="sphere"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cube"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="torus"><value name="RAD1"><block type="math_number"><field name="NUM">4</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">1</field></block></value><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value><value name="FACES"><block type="math_number"><field name="NUM">16</field></block></value></block></category>';
Blockscad.Toolbox.cat_3D_sim='<category name="3D Shapes"><block type="sphere"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cube"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="cylinder"><value name="RAD1"><block type="math_number"><field name="NUM">10</field></block></value><value name="RAD2"><block type="math_number"><field name="NUM">10</field></block></value><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';
Blockscad.Toolbox.cat2D='<category name="2D Shapes"><block type="circle"><value name="RAD"><block type="math_number"><field name="NUM">10</field></block></value></block><block type="square"><value name="XVAL"><block type="math_number"><field name="NUM">10</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">10</field></block></value></block></category>';Blockscad.Toolbox.catTransform='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="simplemirror_new"></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block><block type="linearextrude"><value name="HEIGHT"><block type="math_number"><field name="NUM">10</field></block></value><value name="TWIST"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="rotateextrude"><value name="FACES"><block type="math_number"><field name="NUM">5</field></block></value></block><block type="fancyrotate"><value name="AVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="fancymirror"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block></category>';
Blockscad.Toolbox.catTransform_sim='<category name="Transforms"><block type="translate"><value name="XVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">0</field></block></value></block><block type="simplerotate"><value name="XVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="YVAL"><block type="math_angle"><field name="NUM">0</field></block></value><value name="ZVAL"><block type="math_angle"><field name="NUM">0</field></block></value></block><block type="scale"><value name="XVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="YVAL"><block type="math_number"><field name="NUM">1</field></block></value><value name="ZVAL"><block type="math_number"><field name="NUM">1</field></block></value></block><block type="color"><value name="COLOR"><block type="colour_picker"><field name="COLOUR">#ffcc00</field></block></value></block><block type="$fn"><value name="SIDES"><block type="math_number"><field name="NUM">8</field></block></value></block></category>';
Blockscad.Toolbox.catSetOps='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block><block type="hull"></block></category>';Blockscad.Toolbox.catSetOps_sim='<category name="Set Ops"><block type="union"></block><block type="difference"></block><block type="intersection"></block></category>';Blockscad.Toolbox.catMathLogic='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_trig"></block><block type="math_constant_bs"></block><block type="math_number_property"></block><block type="math_round"></block><block type="math_modulo"></block><block type="math_constrain"><value name="LOW"><block type="math_number"><field name="NUM">1</field></block></value><value name="HIGH"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_int"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">100</field></block></value></block><block type="math_random_float"></block></category><category name="Logic"><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_ternary"></block></category>';
Blockscad.Toolbox.catMathLogic_sim='<category name="Math"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_random_int"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">100</field></block></value></block></category>';Blockscad.Toolbox.catLoops='<category name="Loops"><block type="controls_for"><value name="FROM"><block type="math_number"><field name="NUM">1</field></block> </value><value name="TO"><block type="math_number"><field name="NUM">10</field></block></value><value name="BY"><block type="math_number"><field name="NUM">1</field></block></value></block></category>';
Blockscad.Toolbox.catOther='<category name="Text"><block type="text"></block><block type="bs_text"><value name="TEXT"><block type="text"></block></value><value name="SIZE"><block type="math_number"><field name="NUM">10</field></block></value></block></category><category name="Variables" custom="VARIABLE"></category><category name="Modules" custom="PROCEDURE"></category></xml>';Blockscad.Toolbox.catOther_sim='<category name="Variables" custom="VARIABLE"></category><category name="Modules" custom="PROCEDURE"></category></xml>';
Blockscad.Toolbox.adv='<xml id="toolbox" style="display: none">';Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat_3D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat2D;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catTransform;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catSetOps;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catMathLogic;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catLoops;Blockscad.Toolbox.adv+=Blockscad.Toolbox.catOther_sim;Blockscad.Toolbox.sim='<xml id="toolbox" style="display: none">';
Blockscad.Toolbox.sim+=Blockscad.Toolbox.cat_3D_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catTransform_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catSetOps_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catMathLogic_sim;Blockscad.Toolbox.sim+=Blockscad.Toolbox.catOther_sim;(function(a){var d,e,k=null,r,h,l,m,w,n,u,t,v,x,p,y,F,K,L,q=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],c=function(){this.list=this.next=null},f=function(){this.n=this.b=this.e=0;this.t=null},b=function(a,b,d,e,g,k){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var h=Array(this.BMAX+1),l,m,r,p,q,n,t,v=Array(this.BMAX+1),A,w,u,x=new f,z=Array(this.BMAX);p=Array(this.N_MAX);var y,B=Array(this.BMAX+1),C,F,G;G=this.root=null;for(q=0;q<h.length;q++)h[q]=0;for(q=0;q<v.length;q++)v[q]=0;for(q=0;q<z.length;q++)z[q]=null;for(q=0;q<p.length;q++)p[q]=0;for(q=0;q<
B.length;q++)B[q]=0;l=256<b?a[256]:this.BMAX;A=a;w=0;q=b;do h[A[w]]++,w++;while(0<--q);if(h[0]==b)this.root=null,this.status=this.m=0;else{for(n=1;n<=this.BMAX&&0==h[n];n++);t=n;k<n&&(k=n);for(q=this.BMAX;0!=q&&0==h[q];q--);r=q;k>q&&(k=q);for(C=1<<n;n<q;n++,C<<=1)if(0>(C-=h[n])){this.status=2;this.m=k;return}if(0>(C-=h[q]))this.status=2,this.m=k;else{h[q]+=C;B[1]=n=0;A=h;w=1;for(u=2;0<--q;)B[u++]=n+=A[w++];A=a;q=w=0;do 0!=(n=A[w++])&&(p[B[n]++]=q);while(++q<b);b=B[r];B[0]=q=0;A=p;w=0;p=-1;y=v[0]=
0;u=null;for(F=0;t<=r;t++)for(a=h[t];0<a--;){for(;t>y+v[1+p];){y+=v[1+p];p++;F=(F=r-y)>k?k:F;if((m=1<<(n=t-y))>a+1)for(m-=a+1,u=t;++n<F&&!((m<<=1)<=h[++u]);)m-=h[u];y+n>l&&y<l&&(n=l-y);F=1<<n;v[1+p]=n;u=Array(F);for(m=0;m<F;m++)u[m]=new f;G=null==G?this.root=new c:G.next=new c;G.next=null;G.list=u;z[p]=u;0<p&&(B[p]=q,x.b=v[p],x.e=16+n,x.t=u,n=(q&(1<<y)-1)>>y-v[p],z[p-1][n].e=x.e,z[p-1][n].b=x.b,z[p-1][n].n=x.n,z[p-1][n].t=x.t)}x.b=t-y;w>=b?x.e=99:A[w]<d?(x.e=256>A[w]?16:15,x.n=A[w++]):(x.e=g[A[w]-
d],x.n=e[A[w++]-d]);m=1<<t-y;for(n=q>>y;n<F;n+=m)u[n].e=x.e,u[n].b=x.b,u[n].n=x.n,u[n].t=x.t;for(n=1<<t-1;0!=(q&n);n>>=1)q^=n;for(q^=n;(q&(1<<y)-1)!=B[p];)y-=v[p],p--}this.m=v[1];this.status=0!=C&&1!=r?1:0}}},B=function(a){for(;w<a;){var b=m,c;c=K.length==L?-1:K.charCodeAt(L++)&255;m=b|c<<w;w+=8}},G=function(a){return m&q[a]},C=function(a){m>>=a;w-=a},O=function(a,b,c){var g,f,k;if(0==c)return 0;for(k=0;;){B(y);f=x.list[G(y)];for(g=f.e;16<g;){if(99==g)return-1;C(f.b);g-=16;B(g);f=f.t[G(g)];g=f.e}C(f.b);
if(16==g)e&=32767,a[b+k++]=d[e++]=f.n;else{if(15==g)break;B(g);t=f.n+G(g);C(g);B(F);f=p.list[G(F)];for(g=f.e;16<g;){if(99==g)return-1;C(f.b);g-=16;B(g);f=f.t[G(g)];g=f.e}C(f.b);B(g);v=e-f.n-G(g);for(C(g);0<t&&k<c;)t--,v&=32767,e&=32767,a[b+k++]=d[e++]=d[v++]}if(k==c)return c}n=-1;return k},R=function(a,c,d){var e,f,k,h,l,q,m,n=Array(316);for(e=0;e<n.length;e++)n[e]=0;B(5);q=257+G(5);C(5);B(5);m=1+G(5);C(5);B(4);e=4+G(4);C(4);if(286<q||30<m)return-1;for(f=0;f<e;f++)B(3),n[H[f]]=G(3),C(3);for(;19>f;f++)n[H[f]]=
0;y=7;f=new b(n,19,19,null,null,y);if(0!=f.status)return-1;x=f.root;y=f.m;h=q+m;for(e=k=0;e<h;)if(B(y),l=x.list[G(y)],f=l.b,C(f),f=l.n,16>f)n[e++]=k=f;else if(16==f){B(2);f=3+G(2);C(2);if(e+f>h)return-1;for(;0<f--;)n[e++]=k}else{17==f?(B(3),f=3+G(3),C(3)):(B(7),f=11+G(7),C(7));if(e+f>h)return-1;for(;0<f--;)n[e++]=0;k=0}y=9;f=new b(n,q,257,A,g,y);0==y&&(f.status=1);if(0!=f.status&&1==f.status)return-1;x=f.root;y=f.m;for(e=0;e<m;e++)n[e]=n[e+q];F=6;f=new b(n,m,0,z,Q,F);p=f.root;F=f.m;return 0==F&&257<
q||0!=f.status?-1:O(a,c,d)},V=function(a,c,f){var q,E;for(q=0;q<f&&(!u||-1!=n);){if(0<t){if(0!=n)for(;0<t&&q<f;)t--,v&=32767,e&=32767,a[c+q++]=d[e++]=d[v++];else{for(;0<t&&q<f;)t--,e&=32767,B(8),a[c+q++]=d[e++]=G(8),C(8);0==t&&(n=-1)}if(q==f)break}if(-1==n){if(u)break;B(1);0!=G(1)&&(u=!0);C(1);B(2);n=G(2);C(2);x=null;t=0}switch(n){case 0:E=a;var I=c+q,H=f-q,J=void 0,J=w&7;C(J);B(16);J=G(16);C(16);B(16);if(J!=(~m&65535))E=-1;else{C(16);t=J;for(J=0;0<t&&J<H;)t--,e&=32767,B(8),E[I+J++]=d[e++]=G(8),C(8);
0==t&&(n=-1);E=J}break;case 1:if(null!=x)E=O(a,c+q,f-q);else a:{E=a;I=c+q;H=f-q;if(null==k){for(var D=void 0,J=Array(288),D=void 0,D=0;144>D;D++)J[D]=8;for(;256>D;D++)J[D]=9;for(;280>D;D++)J[D]=7;for(;288>D;D++)J[D]=8;h=7;D=new b(J,288,257,A,g,h);if(0!=D.status){alert("HufBuild error: "+D.status);E=-1;break a}k=D.root;h=D.m;for(D=0;30>D;D++)J[D]=5;l=5;D=new b(J,30,0,z,Q,l);if(1<D.status){k=null;alert("HufBuild error: "+D.status);E=-1;break a}r=D.root;l=D.m}x=k;p=r;y=h;F=l;E=O(E,I,H)}break;case 2:E=
null!=x?O(a,c+q,f-q):R(a,c+q,f-q);break;default:E=-1}if(-1==E)return u?0:-1;q+=E}return q};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.inflate=function(a){var b;null==d&&(d=Array(65536));w=m=e=0;n=-1;u=!1;t=v=0;x=null;K=a;L=0;for(var c=Array(1024),g=[];0<(a=V(c,0,c.length));){var f=Array(a);for(b=0;b<a;b++)f[b]=String.fromCharCode(c[b]);g[g.length]=f.join("")}K=null;return g.join("")}})(this);
(function(a){var d,e,k,r,h=null,l,m,w,n,u,t,v,x,p,y,F,K,L,q,A,g,z,Q,H,c,f,b,B,G,C,O,R,V,M,S,T,N,E,I,W,J,D,da,aa,qa,ia,ja,X,ka,ra,ba,ea,Y,ca,la,sa,fa=function(){this.dl=this.fc=0},ta=function(){this.extra_bits=this.static_tree=this.dyn_tree=null;this.max_code=this.max_length=this.elems=this.extra_base=0},U=function(a,b,c,d){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d},La=function(){this.next=null;this.len=0;this.ptr=Array(8192);this.off=0},ua=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,
2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ga=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ma=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],za=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],va=[new U(0,0,0,0),new U(4,4,8,4),new U(4,5,16,8),new U(4,6,32,32),new U(4,4,16,16),new U(8,16,32,32),new U(8,16,128,128),new U(8,32,128,256),new U(32,128,258,1024),new U(32,258,258,4096)],ma=function(a){h[m+l++]=a;if(8192==m+l&&0!=l){var b;null!=d?(a=d,d=d.next):a=new La;a.next=null;a.len=a.off=0;null==
e?e=k=a:k=k.next=a;a.len=l-m;for(b=0;b<a.len;b++)a.ptr[b]=h[m+b];l=m=0}},na=function(a){a&=65535;8190>m+l?(h[m+l++]=a&255,h[m+l++]=a>>>8):(ma(a&255),ma(a>>>8))},oa=function(){F=(F<<5^n[z+3-1]&255)&8191;K=v[32768+F];v[z&32767]=K;v[32768+F]=z},Z=function(a,b){P(b[a].fc,b[a].dl)},Aa=function(a,b,c){return a[b].fc<a[c].fc||a[b].fc==a[c].fc&&D[b]<=D[c]},Ba=function(a,b,c){var d;for(d=0;d<c&&sa<la.length;d++)a[b+d]=la.charCodeAt(sa++)&255;return d},Ca=function(a){var b=f,c=z,d,e=g,k=32506<z?z-32506:0,h=
z+258,l=n[c+e-1],q=n[c+e];g>=G&&(b>>=2);do if(d=a,n[d+e]==q&&n[d+e-1]==l&&n[d]==n[c]&&n[++d]==n[c+1]){c+=2;for(d++;n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&n[++c]==n[++d]&&c<h;);d=258-(h-c);c=h-258;if(d>e){Q=a;e=d;if(258<=d)break;l=n[c+e-1];q=n[c+e]}}while((a=v[a&32767])>k&&0!=--b);return e},wa=function(){var a,b,d=65536-c-z;if(-1==d)d--;else if(65274<=z){for(a=0;32768>a;a++)n[a]=n[a+32768];Q-=32768;z-=32768;y-=32768;for(a=0;8192>
a;a++)b=v[32768+a],v[32768+a]=32768<=b?b-32768:0;for(a=0;32768>a;a++)b=v[a],v[a]=32768<=b?b-32768:0;d+=32768}H||(a=Ba(n,z+c,d),0>=a?H=!0:c+=a)},Na=function(a,d,k){var h;if(!r){if(!H){p=x=0;var t,u;if(0==V[0].dl){S.dyn_tree=C;S.static_tree=R;S.extra_bits=ua;S.extra_base=257;S.elems=286;S.max_length=15;S.max_code=0;T.dyn_tree=O;T.static_tree=V;T.extra_bits=ga;T.extra_base=0;T.elems=30;T.max_length=15;T.max_code=0;N.dyn_tree=M;N.static_tree=null;N.extra_bits=Ma;N.extra_base=0;N.elems=19;N.max_length=
7;for(u=t=N.max_code=0;28>u;u++)for(qa[u]=t,h=0;h<1<<ua[u];h++)da[t++]=u;da[t-1]=u;for(u=t=0;16>u;u++)for(ia[u]=t,h=0;h<1<<ga[u];h++)aa[t++]=u;for(t>>=7;30>u;u++)for(ia[u]=t<<7,h=0;h<1<<ga[u]-7;h++)aa[256+t++]=u;for(h=0;15>=h;h++)E[h]=0;for(h=0;143>=h;)R[h++].dl=8,E[8]++;for(;255>=h;)R[h++].dl=9,E[9]++;for(;279>=h;)R[h++].dl=7,E[7]++;for(;287>=h;)R[h++].dl=8,E[8]++;Da(R,287);for(h=0;30>h;h++)V[h].dl=5,V[h].fc=Ea(h,5);Fa()}for(h=0;8192>h;h++)v[32768+h]=0;b=va[B].max_lazy;G=va[B].good_length;f=va[B].max_chain;
y=z=0;c=Ba(n,0,65536);if(0>=c)H=!0,c=0;else{for(H=!1;262>c&&!H;)wa();for(h=F=0;2>h;h++)F=(F<<5^n[h]&255)&8191}e=null;q=m=l=0;3>=B?(g=2,A=0):(A=2,q=q=0);w=!1}r=!0;if(0==c)return w=!0,0}if((h=Ga(a,d,k))==k)return k;if(w)return h;if(3>=B)for(;0!=c&&null==e;){oa();0!=K&&32506>=z-K&&(A=Ca(K),A>c&&(A=c));if(3<=A)if(u=ha(z-Q,A-3),c-=A,A<=b){A--;do z++,oa();while(0!=--A);z++}else z+=A,A=0,F=n[z]&255,F=(F<<5^n[z+1]&255)&8191;else u=ha(0,n[z]&255),c--,z++;u&&(pa(0),y=z);for(;262>c&&!H;)wa()}else for(;0!=c&&
null==e;){oa();g=A;L=Q;A=2;0!=K&&g<b&&32506>=z-K&&(A=Ca(K),A>c&&(A=c),3==A&&4096<z-Q&&A--);if(3<=g&&A<=g){u=ha(z-1-L,g-3);c-=g-1;g-=2;do z++,oa();while(0!=--g);q=0;A=2;z++;u&&(pa(0),y=z)}else 0!=q?ha(0,n[z-1]&255)&&(pa(0),y=z):q=1,z++,c--;for(;262>c&&!H;)wa()}0==c&&(0!=q&&ha(0,n[z-1]&255),pa(1),w=!0);return h+Ga(a,h+d,k-h)},Ga=function(a,b,c){var g,f,k;for(g=0;null!=e&&g<c;){f=c-g;f>e.len&&(f=e.len);for(k=0;k<f;k++)a[b+g+k]=e.ptr[e.off+k];e.off+=f;e.len-=f;g+=f;0==e.len&&(f=e,e=e.next,f.next=d,d=
f)}if(g==c)return g;if(m<l){f=c-g;f>l-m&&(f=l-m);for(k=0;k<f;k++)a[b+g+k]=h[m+k];m+=f;g+=f;l==m&&(l=m=0)}return g},Fa=function(){var a;for(a=0;286>a;a++)C[a].fc=0;for(a=0;30>a;a++)O[a].fc=0;for(a=0;19>a;a++)M[a].fc=0;C[256].fc=1;ba=X=ka=ra=Y=ca=0;ea=1},xa=function(a,b){for(var c=I[b],d=b<<1;d<=W;){d<W&&Aa(a,I[d+1],I[d])&&d++;if(Aa(a,c,I[d]))break;I[b]=I[d];b=d;d<<=1}I[b]=c},Da=function(a,b){var c=Array(16),d=0,e;for(e=1;15>=e;e++)d=d+E[e-1]<<1,c[e]=d;for(d=0;d<=b;d++)e=a[d].dl,0!=e&&(a[d].fc=Ea(c[e]++,
e))},ya=function(a){var b=a.dyn_tree,c=a.static_tree,d=a.elems,e,g=-1,f=d;W=0;J=573;for(e=0;e<d;e++)0!=b[e].fc?(I[++W]=g=e,D[e]=0):b[e].dl=0;for(;2>W;)e=I[++W]=2>g?++g:0,b[e].fc=1,D[e]=0,Y--,null!=c&&(ca-=c[e].dl);a.max_code=g;for(e=W>>1;1<=e;e--)xa(b,e);do e=I[1],I[1]=I[W--],xa(b,1),c=I[1],I[--J]=e,I[--J]=c,b[f].fc=b[e].fc+b[c].fc,D[f]=D[e]>D[c]+1?D[e]:D[c]+1,b[e].dl=b[c].dl=f,I[1]=f++,xa(b,1);while(2<=W);I[--J]=I[1];f=a.dyn_tree;e=a.extra_bits;var d=a.extra_base,c=a.max_code,h=a.max_length,k=a.static_tree,
l,q,m,n,p=0;for(q=0;15>=q;q++)E[q]=0;f[I[J]].dl=0;for(a=J+1;573>a;a++)l=I[a],q=f[f[l].dl].dl+1,q>h&&(q=h,p++),f[l].dl=q,l>c||(E[q]++,m=0,l>=d&&(m=e[l-d]),n=f[l].fc,Y+=n*(q+m),null!=k&&(ca+=n*(k[l].dl+m)));if(0!=p){do{for(q=h-1;0==E[q];)q--;E[q]--;E[q+1]+=2;E[h]--;p-=2}while(0<p);for(q=h;0!=q;q--)for(l=E[q];0!=l;)e=I[--a],e>c||(f[e].dl!=q&&(Y+=(q-f[e].dl)*f[e].fc,f[e].fc=q),l--)}Da(b,g)},Ha=function(a,b){var c,d=-1,e,g=a[0].dl,f=0,h=7,k=4;0==g&&(h=138,k=3);a[b+1].dl=65535;for(c=0;c<=b;c++)e=g,g=a[c+
1].dl,++f<h&&e==g||(f<k?M[e].fc+=f:0!=e?(e!=d&&M[e].fc++,M[16].fc++):10>=f?M[17].fc++:M[18].fc++,f=0,d=e,0==g?(h=138,k=3):e==g?(h=6,k=3):(h=7,k=4))},Ia=function(a,b){var c,d=-1,e,g=a[0].dl,f=0,h=7,k=4;0==g&&(h=138,k=3);for(c=0;c<=b;c++)if(e=g,g=a[c+1].dl,!(++f<h&&e==g)){if(f<k){do Z(e,M);while(0!=--f)}else 0!=e?(e!=d&&(Z(e,M),f--),Z(16,M),P(f-3,2)):10>=f?(Z(17,M),P(f-3,3)):(Z(18,M),P(f-11,7));f=0;d=e;0==g?(h=138,k=3):e==g?(h=6,k=3):(h=7,k=4)}},pa=function(a){var b,c,d,e;e=z-y;ja[ra]=ba;ya(S);ya(T);
Ha(C,S.max_code);Ha(O,T.max_code);ya(N);for(d=18;3<=d&&0==M[za[d]].dl;d--);Y+=3*(d+1)+14;b=Y+3+7>>3;c=ca+3+7>>3;c<=b&&(b=c);if(e+4<=b&&0<=y)for(P(0+a,3),Ja(),na(e),na(~e),d=0;d<e;d++)ma(n[y+d]);else if(c==b)P(2+a,3),Ka(R,V);else{P(4+a,3);e=S.max_code+1;b=T.max_code+1;d+=1;P(e-257,5);P(b-1,5);P(d-4,4);for(c=0;c<d;c++)P(M[za[c]].dl,3);Ia(C,e-1);Ia(O,b-1);Ka(C,O)}Fa();0!=a&&Ja()},ha=function(a,b){t[X++]=b;0==a?C[b].fc++:(a--,C[da[b]+256+1].fc++,O[(256>a?aa[a]:aa[256+(a>>7)])&255].fc++,u[ka++]=a,ba|=
ea);ea<<=1;0==(X&7)&&(ja[ra++]=ba,ba=0,ea=1);if(2<B&&0==(X&4095)){var c=8*X,d=z-y,e;for(e=0;30>e;e++)c+=O[e].fc*(5+ga[e]);c>>=3;if(ka<parseInt(X/2)&&c<parseInt(d/2))return!0}return 8191==X||8192==ka},Ka=function(a,b){var c,d=0,e=0,g=0,f=0,h,k;if(0!=X){do 0==(d&7)&&(f=ja[g++]),c=t[d++]&255,0==(f&1)?Z(c,a):(h=da[c],Z(h+256+1,a),k=ua[h],0!=k&&(c-=qa[h],P(c,k)),c=u[e++],h=(256>c?aa[c]:aa[256+(c>>7)])&255,Z(h,b),k=ga[h],0!=k&&(c-=ia[h],P(c,k))),f>>=1;while(d<X)}Z(256,a)},P=function(a,b){p>16-b?(x|=a<<
p,na(x),x=a>>16-p,p+=b-16):(x|=a<<p,p+=b)},Ea=function(a,b){var c=0;do c|=a&1,a>>=1,c<<=1;while(0<--b);return c>>1},Ja=function(){8<p?na(x):0<p&&ma(x);p=x=0};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.deflate=function(a,b){var c,g;la=a;sa=0;"undefined"==typeof b&&(b=6);(c=b)?1>c?c=1:9<c&&(c=9):c=6;B=c;H=r=!1;if(null==h){d=e=k=null;h=Array(8192);n=Array(65536);u=Array(8192);t=Array(32832);v=Array(65536);C=Array(573);for(c=0;573>c;c++)C[c]=new fa;O=Array(61);for(c=0;61>c;c++)O[c]=new fa;R=Array(288);
for(c=0;288>c;c++)R[c]=new fa;V=Array(30);for(c=0;30>c;c++)V[c]=new fa;M=Array(39);for(c=0;39>c;c++)M[c]=new fa;S=new ta;T=new ta;N=new ta;E=Array(16);I=Array(573);D=Array(573);da=Array(256);aa=Array(512);qa=Array(29);ia=Array(30);ja=Array(1024)}for(var f=Array(1024),l=[];0<(c=Na(f,0,f.length));){var q=Array(c);for(g=0;g<c;g++)q[g]=String.fromCharCode(f[g]);l[l.length]=q.join("")}la=null;return l.join("")}})(this);
(function(a){if(!a.Base64){var d;"undefined"!==typeof module&&module.exports&&(d=require("buffer").Buffer);var e=function(a){for(var d={},e=0,h=a.length;e<h;e++)d[a.charAt(e)]=e;return d}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),k=String.fromCharCode,r=function(a){if(2>a.length){var d=a.charCodeAt(0);return 128>d?a:2048>d?k(192|d>>>6)+k(128|d&63):k(224|d>>>12&15)+k(128|d>>>6&63)+k(128|d&63)}d=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return k(240|d>>>18&
7)+k(128|d>>>12&63)+k(128|d>>>6&63)+k(128|d&63)},h=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(a){return a.replace(h,r)},m=function(a){var d=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>
6&63),1<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},w=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,m)},n=d?function(a){return(new d(a)).toString("base64")}:function(a){return w(l(a))},u=function(a,d){return d?n(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):n(a)},t=/[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}/g,v=function(a){switch(a.length){case 4:return a=
((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-65536,k((a>>>10)+55296)+k((a&1023)+56320);case 3:return k((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return k((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},x=function(a){return a.replace(t,v)},p=function(a){var d=a.length,g=d%4;a=(0<d?e[a.charAt(0)]<<18:0)|(1<d?e[a.charAt(1)]<<12:0)|(2<d?e[a.charAt(2)]<<6:0)|(3<d?e[a.charAt(3)]:0);a=[k(a>>>16),k(a>>>8&255),k(a&255)];a.length-=
[0,0,2,1][g];return a.join("")},y=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,p)},F=d?function(a){return(new d(a,"base64")).toString()}:function(a){return x(y(a))},K=function(a){return F(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};a.Base64={VERSION:"2.1.1",atob:y,btoa:w,fromBase64:K,toBase64:u,utob:l,encode:u,encodeURI:function(a){return u(a,!0)},btou:x,decode:K};if("function"===typeof Object.defineProperty){var L=function(a){return{value:a,enumerable:!1,
writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",L(function(){return K(this)}));Object.defineProperty(String.prototype,"toBase64",L(function(a){return u(this,a)}));Object.defineProperty(String.prototype,"toBase64URI",L(function(){return u(this,!0)}))}}}})(this);function importSTL(a,d){for(var e=!0,k=0;k<a.length;k++)if(0==a[k].charCodeAt(0)){e=!1;break}console.log("STL file is ascii: ",e);return e?importAsciiSTL(a,d):importBinarySTL(a,d)}
function importBinarySTL(a,d){var e=[],k=new BinaryReader(a);k.seek(80);for(var r=k.readUInt32(),h=[1E4,1E4,1E4],l=[-1E4,-1E4,-1E4],m=0;m<r;m++){k.readFloat();k.readFloat();k.readFloat();var w=[];w.push(k.readFloat());w.push(k.readFloat());w.push(k.readFloat());var n=[];n.push(k.readFloat());n.push(k.readFloat());n.push(k.readFloat());var u=[];u.push(k.readFloat());u.push(k.readFloat());u.push(k.readFloat());for(var t=0,v=0;3>v;v++)isNaN(w[v])&&t++,isNaN(n[v])&&t++,isNaN(u[v])&&t++;0<t&&console.log("this many bad vertices: ",
t);k.readUInt16();if(!t)for(e.push(w),e.push(n),e.push(u),v=0;3>v;v++)h[v]=Math.min(h[v],w[v]),h[v]=Math.min(h[v],n[v]),h[v]=Math.min(h[v],u[v]),l[v]=Math.max(l[v],w[v]),l[v]=Math.max(l[v],n[v]),l[v]=Math.max(l[v],u[v])}t&&console.log("WARNING: import errors: expect some missing or bad triangles\n");k=[Math.round(l[0]-(l[0]-h[0])/2),Math.round(l[1]-(l[1]-h[1])/2),Math.round(l[2]-(l[2]-h[2])/2)];return[vt2csg(e),k]}
function importAsciiSTL(a,d){for(var e="",k=[],r=0,h=0,l=[1E4,1E4,1E4],m=[-1E4,-1E4,-1E4],w=a.split("\n"),n=0;n<w.length;n++)if(!w[n].match(/facet/)&&!w[n].match(/endloop/))if(w[n].match(/outer/))var r=h=0,u=[[],[],[]];else if(w[n].match(/vertex/)){w[n]=w[n].replace(/^\s+|\s+$/g,"");var t=w[n].split(" ");u[h].push(parseFloat(t[1]));u[h].push(parseFloat(t[2]));u[h].push(parseFloat(t[3]));isNaN(u[h][0])&&r++;isNaN(u[h][1])&&r++;isNaN(u[h][2])&&r++;0<r&&(console.log("this many bad vertices: ",r),console.log("things are:",
t));if(!r&&3==++h)for(k.push(u[0]),k.push(u[1]),k.push(u[2]),t=0;3>t;t++)l[t]=Math.min(l[t],u[0][t]),l[t]=Math.min(l[t],u[1][t]),l[t]=Math.min(l[t],u[2][t]),m[t]=Math.max(m[t],u[0][t]),m[t]=Math.max(m[t],u[1][t]),m[t]=Math.max(m[t],u[2][t])}r=[Math.round(m[0]-(m[0]-l[0])/2),Math.round(m[1]-(m[1]-l[1])/2),Math.round(m[2]-(m[2]-l[2])/2)];e+=vt2csg(k);return[e,r]}
function vt2csg(a){var d;d="CSG.fromPolygons([";for(var e=0;e<a.length/3;e++){d+="new CSG.Polygon([";for(var k=0;3>k;k++)d+="new CSG.Vertex(new CSG.Vector3D([",d+=a[3*e+k]+"]))",2>k&&(d+=",");d+="])";e<a.length/3-1&&(d+=",")}return d+"])"}var BinaryReader=function(a){this._buffer=a;this._pos=0};
BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(a){this._checkSize(8*
a);var d=this._buffer.substr(this._pos,a);this._pos+=a;return d},seek:function(a){this._pos=a;this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(a,d){var e=a+d+1,k=e>>3;this._checkSize(e);var e=Math.pow(2,d-1)-1,r=this._readBits(a+d,1,k),h=this._readBits(a,d,k),l=0,m=2,w=0;do for(var n=this._readByte(++w,k),u=a%8||8,t=1<<u;t>>=1;)n&t&&(l+=1/m),m*=2;while(a-=u);this._pos+=k;return h==(e<<1)+1?l?NaN:r?-Infinity:Infinity:
(1+-2*r)*(h||l?h?Math.pow(2,h-e)*(1+l):Math.pow(2,-e+1)*l:0)},_decodeInt:function(a,d){var e=this._readBits(0,a,a/8),k=Math.pow(2,a);this._pos+=a/8;return d&&e>=k/2?e-k:e},_shl:function(a,d){for(++d;--d;a=1073741824==((a%=2147483648)&1073741824)?2*a:2*(a-1073741824)+2147483648);return a},_readByte:function(a,d){return this._buffer.charCodeAt(this._pos+d-a-1)&255},_readBits:function(a,d,e){var k=(a+d)%8,r=a%8,h=e-(a>>3)-1;a=e+(-(a+d)>>3);var l=h-a;d=this._readByte(h,e)>>r&(1<<(l?8-r:d))-1;for(l&&k&&
(d+=(this._readByte(a++,e)&(1<<k)-1)<<(l--<<3)-r);l;)d+=this._shl(this._readByte(a++,e),(l--<<3)-r);return d},_checkSize:function(a){}};